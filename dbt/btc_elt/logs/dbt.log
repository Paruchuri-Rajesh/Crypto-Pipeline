[0m22:06:57.390978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f07d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f07c50>]}


============================== 22:06:57.393600 | f7e363d8-21e4-4e29-a11a-f378ae49ba54 ==============================
[0m22:06:57.393600 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:06:57.393892 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'debug': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'empty': 'False', 'log_path': 'logs', 'version_check': 'True', 'static_parser': 'True', 'write_json': 'True', 'target_path': 'None', 'printer_width': '80', 'introspect': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'quiet': 'False'}
[0m22:06:57.394209 [error] [MainThread]: Encountered an error:
Runtime Error
  No dbt_project.yml found at expected path /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
  Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml
  
[0m22:06:57.395794 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.01891071, "process_in_blocks": "0", "process_kernel_time": 0.136564, "process_mem_max_rss": "114573312", "process_out_blocks": "0", "process_user_time": 0.564068}
[0m22:06:57.395995 [debug] [MainThread]: Command `dbt run` failed at 22:06:57.395949 after 0.02 seconds
[0m22:06:57.396131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d01810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f48050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cae580>]}
[0m22:06:57.396266 [debug] [MainThread]: Flushing usage events
[0m22:06:57.774121 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:30:31.110150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10878e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a123b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1239d0>]}


============================== 22:30:31.112504 | e31aa181-a4d5-4bed-8075-e306e072a311 ==============================
[0m22:30:31.112504 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:30:31.112739 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'invocation_command': 'dbt compile', 'version_check': 'True', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'introspect': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'target_path': 'None', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False'}
[0m22:30:31.114970 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m22:30:31.116045 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 0.033001166, "process_in_blocks": "0", "process_kernel_time": 0.098034, "process_mem_max_rss": "114294784", "process_out_blocks": "0", "process_user_time": 0.507925}
[0m22:30:31.116212 [debug] [MainThread]: Command `dbt compile` failed at 22:30:31.116174 after 0.03 seconds
[0m22:30:31.116326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1b03e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1529f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fae9c0>]}
[0m22:30:31.116436 [debug] [MainThread]: Flushing usage events
[0m22:30:31.523965 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:34:20.499399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581a7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9bb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9b9d0>]}


============================== 22:34:20.501747 | 035930e6-020f-40a0-a98e-bbfa03644809 ==============================
[0m22:34:20.501747 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:34:20.502011 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'use_colors': 'True', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'no_print': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'cache_selected_only': 'False', 'fail_fast': 'False', 'quiet': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'version_check': 'True', 'write_json': 'True', 'introspect': 'True'}
[0m22:34:20.510427 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:34:20.510644 [info ] [MainThread]: python version: 3.13.5
[0m22:34:20.510747 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:34:20.510843 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:34:20.514169 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.snowflake'
[0m22:34:20.514402 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt
[0m22:34:20.514511 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/profiles.yml
[0m22:34:20.514601 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:34:20.549696 [info ] [MainThread]: Configuration:
[0m22:34:20.549924 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:34:20.550043 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:34:20.550138 [info ] [MainThread]: Required dependencies:
[0m22:34:20.550292 [debug] [MainThread]: Executing "git --help"
[0m22:34:20.572660 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:34:20.573046 [debug] [MainThread]: STDERR: "b''"
[0m22:34:20.573174 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:34:20.573293 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:34:20.573391 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:34:20.573478 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "btc_elt", target "dev" invalid: Runtime Error
    Could not find adapter type snowflake!


[0m22:34:20.574773 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.10223671, "process_in_blocks": "0", "process_kernel_time": 0.10807, "process_mem_max_rss": "117653504", "process_out_blocks": "0", "process_user_time": 0.540593}
[0m22:34:20.574943 [debug] [MainThread]: Command `dbt debug` failed at 22:34:20.574906 after 0.10 seconds
[0m22:34:20.575113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa28b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e039b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b2b130>]}
[0m22:34:20.575265 [debug] [MainThread]: Flushing usage events
[0m22:34:20.956625 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:35:41.373764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037be7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c3fb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c3f9d0>]}


============================== 22:35:41.376230 | be378b60-a72a-4cff-bfca-5548f0ff61cb ==============================
[0m22:35:41.376230 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:35:41.376471 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'invocation_command': 'dbt debug', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'fail_fast': 'False', 'target_path': 'None', 'static_parser': 'True', 'no_print': 'None', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'debug': 'False'}
[0m22:35:41.384527 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:35:41.384721 [info ] [MainThread]: python version: 3.13.5
[0m22:35:41.384828 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:35:41.384920 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:35:41.388324 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.snowflake'
[0m22:35:41.388575 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:35:41.388682 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:35:41.388773 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:35:41.425903 [info ] [MainThread]: Configuration:
[0m22:35:41.426344 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:35:41.426513 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:35:41.426618 [info ] [MainThread]: Required dependencies:
[0m22:35:41.426797 [debug] [MainThread]: Executing "git --help"
[0m22:35:41.447723 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:35:41.448150 [debug] [MainThread]: STDERR: "b''"
[0m22:35:41.448278 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:35:41.448407 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:35:41.448512 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:35:41.448604 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "btc_elt", target "dev" invalid: Runtime Error
    Could not find adapter type snowflake!


[0m22:35:41.450044 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.10382275, "process_in_blocks": "0", "process_kernel_time": 0.106828, "process_mem_max_rss": "117506048", "process_out_blocks": "0", "process_user_time": 0.535448}
[0m22:35:41.450241 [debug] [MainThread]: Command `dbt debug` failed at 22:35:41.450200 after 0.10 seconds
[0m22:35:41.450434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f468b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da79b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104acf130>]}
[0m22:35:41.450595 [debug] [MainThread]: Flushing usage events
[0m22:35:41.876724 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:38:19.506792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107caa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119227c50>]}


============================== 22:38:19.509395 | cbcbb43e-404c-4e83-bfd2-e6632507c03f ==============================
[0m22:38:19.509395 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:38:19.509677 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'static_parser': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error': 'None', 'introspect': 'True', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m22:38:19.517568 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:38:19.517727 [info ] [MainThread]: python version: 3.13.5
[0m22:38:19.517830 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:38:19.517924 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:38:20.468569 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:38:20.468830 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:38:20.468959 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:38:20.502579 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:38:20.502855 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:38:20.503008 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:38:20.503331 [info ] [MainThread]: adapter type: snowflake
[0m22:38:20.503468 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:38:20.541984 [info ] [MainThread]: Configuration:
[0m22:38:20.542219 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:38:20.542387 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:38:20.542544 [info ] [MainThread]: Required dependencies:
[0m22:38:20.542723 [debug] [MainThread]: Executing "git --help"
[0m22:38:20.563866 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:38:20.564279 [debug] [MainThread]: STDERR: "b''"
[0m22:38:20.564416 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:38:20.564542 [info ] [MainThread]: Connection:
[0m22:38:20.564666 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:38:20.564760 [info ] [MainThread]:   user: RACCOON
[0m22:38:20.564844 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:38:20.564930 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:38:20.565009 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:38:20.565091 [info ] [MainThread]:   schema: analytics
[0m22:38:20.565170 [info ] [MainThread]:   authenticator: None
[0m22:38:20.565247 [info ] [MainThread]:   oauth_client_id: None
[0m22:38:20.565326 [info ] [MainThread]:   query_tag: None
[0m22:38:20.565406 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:38:20.565486 [info ] [MainThread]:   host: None
[0m22:38:20.565563 [info ] [MainThread]:   port: None
[0m22:38:20.565639 [info ] [MainThread]:   proxy_host: None
[0m22:38:20.565718 [info ] [MainThread]:   proxy_port: None
[0m22:38:20.565791 [info ] [MainThread]:   protocol: None
[0m22:38:20.565869 [info ] [MainThread]:   connect_retries: 1
[0m22:38:20.565945 [info ] [MainThread]:   connect_timeout: None
[0m22:38:20.566020 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:38:20.566098 [info ] [MainThread]:   retry_all: False
[0m22:38:20.566173 [info ] [MainThread]:   insecure_mode: False
[0m22:38:20.566247 [info ] [MainThread]:   reuse_connections: True
[0m22:38:20.566326 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:38:20.566407 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:38:20.566680 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:38:20.610104 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:38:20.655304 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:38:20.655478 [debug] [MainThread]: On debug: select 1 as id
[0m22:38:20.655582 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:38:21.277148 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m22:38:21.277742 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m22:38:21.278218 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:38:21.278565 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:38:21.278821 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001 (08001): Failed to connect to DB: SFEDU02-LVB17920.snowflakecomputing.com:443. Incorrect username or password was specified.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:38:21.286178 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 1.8078579, "process_in_blocks": "0", "process_kernel_time": 0.910785, "process_mem_max_rss": "223526912", "process_out_blocks": "0", "process_user_time": 2.649875}
[0m22:38:21.286725 [debug] [MainThread]: Command `dbt debug` failed at 22:38:21.286614 after 1.81 seconds
[0m22:38:21.287073 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:38:21.287308 [debug] [MainThread]: On debug: No close available on handle
[0m22:38:21.287596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14acd3ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14af69c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab4b680>]}
[0m22:38:21.287944 [debug] [MainThread]: Flushing usage events
[0m22:38:21.692043 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:39:33.791136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dbe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107827c50>]}


============================== 22:39:33.793600 | dd92a66d-27df-4675-ad13-6491fbbd0030 ==============================
[0m22:39:33.793600 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:39:33.793833 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'no_print': 'None', 'use_colors': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'invocation_command': 'dbt debug'}
[0m22:39:33.801852 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:39:33.802035 [info ] [MainThread]: python version: 3.13.5
[0m22:39:33.802144 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:39:33.802237 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:39:34.355046 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:39:34.355319 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:39:34.355443 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:39:34.383585 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:39:34.383825 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:39:34.384104 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:39:34.384459 [info ] [MainThread]: adapter type: snowflake
[0m22:39:34.384603 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:39:34.424757 [info ] [MainThread]: Configuration:
[0m22:39:34.424979 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:39:34.425178 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:39:34.425299 [info ] [MainThread]: Required dependencies:
[0m22:39:34.425457 [debug] [MainThread]: Executing "git --help"
[0m22:39:34.448730 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:39:34.449201 [debug] [MainThread]: STDERR: "b''"
[0m22:39:34.449358 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:39:34.449491 [info ] [MainThread]: Connection:
[0m22:39:34.449617 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:39:34.449715 [info ] [MainThread]:   user: YOUR_SNOWFLAKE_USERNAME
[0m22:39:34.449804 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:39:34.449893 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:39:34.450048 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:39:34.450198 [info ] [MainThread]:   schema: analytics
[0m22:39:34.450300 [info ] [MainThread]:   authenticator: None
[0m22:39:34.450387 [info ] [MainThread]:   oauth_client_id: None
[0m22:39:34.450474 [info ] [MainThread]:   query_tag: None
[0m22:39:34.450558 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:39:34.450647 [info ] [MainThread]:   host: None
[0m22:39:34.450728 [info ] [MainThread]:   port: None
[0m22:39:34.450809 [info ] [MainThread]:   proxy_host: None
[0m22:39:34.450891 [info ] [MainThread]:   proxy_port: None
[0m22:39:34.450990 [info ] [MainThread]:   protocol: None
[0m22:39:34.451092 [info ] [MainThread]:   connect_retries: 1
[0m22:39:34.451178 [info ] [MainThread]:   connect_timeout: None
[0m22:39:34.451259 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:39:34.451343 [info ] [MainThread]:   retry_all: False
[0m22:39:34.451422 [info ] [MainThread]:   insecure_mode: False
[0m22:39:34.451501 [info ] [MainThread]:   reuse_connections: True
[0m22:39:34.451582 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:39:34.451664 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:39:34.451920 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:39:34.499106 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:39:34.550431 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:39:34.550662 [debug] [MainThread]: On debug: select 1 as id
[0m22:39:34.550797 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:39:34.803793 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m22:39:34.804138 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m22:39:34.804438 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:39:34.804709 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:39:34.804934 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001 (08001): Failed to connect to DB: SFEDU02-LVB17920.snowflakecomputing.com:443. Incorrect username or password was specified.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:39:34.810031 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 1.0461591, "process_in_blocks": "0", "process_kernel_time": 1.234617, "process_mem_max_rss": "220823552", "process_out_blocks": "0", "process_user_time": 2.255936}
[0m22:39:34.810444 [debug] [MainThread]: Command `dbt debug` failed at 22:39:34.810352 after 1.05 seconds
[0m22:39:34.810739 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:39:34.811028 [debug] [MainThread]: On debug: No close available on handle
[0m22:39:34.811288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d3d3ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d521c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d24b680>]}
[0m22:39:34.811593 [debug] [MainThread]: Flushing usage events
[0m22:39:35.247126 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:29.408051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052da900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a27c50>]}


============================== 22:41:29.410883 | addfd518-5712-462a-b0a2-f486d52f4919 ==============================
[0m22:41:29.410883 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:41:29.411134 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'invocation_command': 'dbt debug', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'static_parser': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'use_experimental_parser': 'False', 'no_print': 'None', 'partial_parse': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_cache_events': 'False', 'target_path': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m22:41:29.421782 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:41:29.422065 [info ] [MainThread]: python version: 3.13.5
[0m22:41:29.422281 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:41:29.422497 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:41:30.078448 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:41:30.078679 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:41:30.078793 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:41:30.102180 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:41:30.102391 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:41:30.102501 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:41:30.102871 [info ] [MainThread]: adapter type: snowflake
[0m22:41:30.103015 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:41:30.137354 [info ] [MainThread]: Configuration:
[0m22:41:30.137577 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:41:30.137698 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:41:30.137828 [info ] [MainThread]: Required dependencies:
[0m22:41:30.138000 [debug] [MainThread]: Executing "git --help"
[0m22:41:30.167334 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:41:30.167945 [debug] [MainThread]: STDERR: "b''"
[0m22:41:30.168121 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:41:30.168261 [info ] [MainThread]: Connection:
[0m22:41:30.168391 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:41:30.168501 [info ] [MainThread]:   user: PEACOCK
[0m22:41:30.168589 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:41:30.168675 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:41:30.168753 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:41:30.168835 [info ] [MainThread]:   schema: analytics
[0m22:41:30.168912 [info ] [MainThread]:   authenticator: None
[0m22:41:30.168994 [info ] [MainThread]:   oauth_client_id: None
[0m22:41:30.169072 [info ] [MainThread]:   query_tag: None
[0m22:41:30.169164 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:41:30.169249 [info ] [MainThread]:   host: None
[0m22:41:30.169325 [info ] [MainThread]:   port: None
[0m22:41:30.169403 [info ] [MainThread]:   proxy_host: None
[0m22:41:30.169481 [info ] [MainThread]:   proxy_port: None
[0m22:41:30.169557 [info ] [MainThread]:   protocol: None
[0m22:41:30.169638 [info ] [MainThread]:   connect_retries: 1
[0m22:41:30.169714 [info ] [MainThread]:   connect_timeout: None
[0m22:41:30.169793 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:41:30.169871 [info ] [MainThread]:   retry_all: False
[0m22:41:30.169947 [info ] [MainThread]:   insecure_mode: False
[0m22:41:30.170026 [info ] [MainThread]:   reuse_connections: True
[0m22:41:30.170104 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:41:30.170186 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:41:30.170506 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:41:30.235622 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:41:30.290078 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:41:30.290296 [debug] [MainThread]: On debug: select 1 as id
[0m22:41:30.290413 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:41:30.727976 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.437 seconds
[0m22:41:30.729631 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m22:41:30.730044 [info ] [MainThread]: [32mAll checks passed![0m
[0m22:41:30.736601 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.3680593, "process_in_blocks": "0", "process_kernel_time": 1.765843, "process_mem_max_rss": "208486400", "process_out_blocks": "0", "process_user_time": 1.467025}
[0m22:41:30.737155 [debug] [MainThread]: Command `dbt debug` succeeded at 22:41:30.737042 after 1.37 seconds
[0m22:41:30.737496 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:41:30.737799 [debug] [MainThread]: On debug: Close
[0m22:41:30.886715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1641fbe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164502450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163fe78a0>]}
[0m22:41:30.887354 [debug] [MainThread]: Flushing usage events
[0m22:41:31.296746 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:42.543860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ec6900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105327c50>]}


============================== 22:41:42.546108 | 0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc ==============================
[0m22:41:42.546108 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:41:42.546349 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'empty': 'False', 'static_parser': 'True', 'write_json': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'target_path': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'introspect': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt compile', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_colors': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m22:41:43.040963 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:41:43.041181 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:41:43.041289 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:41:43.182729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046b9f30>]}
[0m22:41:43.202096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc7ff00>]}
[0m22:41:43.202575 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:41:43.247729 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m22:41:43.248098 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:41:43.248246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd35350>]}
[0m22:41:43.640599 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.btc_elt.output
[0m22:41:43.643604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd4f020>]}
[0m22:41:43.667016 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:41:43.668166 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:41:43.676138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b409fd0>]}
[0m22:41:43.676318 [info ] [MainThread]: Found 2 models, 3 sources, 516 macros
[0m22:41:43.676439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a22a1a0>]}
[0m22:41:43.677310 [info ] [MainThread]: 
[0m22:41:43.677435 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:41:43.677529 [info ] [MainThread]: 
[0m22:41:43.677709 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:41:43.677836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3396d0>]}
[0m22:41:43.679246 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m22:41:43.679397 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.btc_elt.stg_btc_market'
[0m22:41:43.679498 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m22:41:43.682129 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m22:41:43.682725 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m22:41:43.682918 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m22:41:43.683095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m22:41:43.683218 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m22:41:43.684709 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m22:41:43.685127 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m22:41:43.685570 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:41:43.685703 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_ohlc' was properly closed.
[0m22:41:43.685888 [debug] [MainThread]: Command end result
[0m22:41:43.693569 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:41:43.694197 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:41:43.695276 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:41:43.697697 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.1824161, "process_in_blocks": "0", "process_kernel_time": 2.00493, "process_mem_max_rss": "223051776", "process_out_blocks": "0", "process_user_time": 1.784642}
[0m22:41:43.697850 [debug] [MainThread]: Command `dbt compile` succeeded at 22:41:43.697812 after 1.18 seconds
[0m22:41:43.697991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b31ef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b49ce10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b49e990>]}
[0m22:41:43.698107 [debug] [MainThread]: Flushing usage events
[0m22:41:44.063714 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:24:39.470811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f9f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f9fc50>]}


============================== 23:24:39.473278 | d637efcb-4e8a-45ba-bd6a-a19aa49ee29f ==============================
[0m23:24:39.473278 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:24:39.473546 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'write_json': 'True', 'log_format': 'default', 'version_check': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'empty': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'cache_selected_only': 'False', 'warn_error': 'None', 'static_parser': 'True'}
[0m23:24:40.003859 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:24:40.004064 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:24:40.004173 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:24:40.120255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10832df30>]}
[0m23:24:40.138852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe7ff00>]}
[0m23:24:40.139310 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:24:40.191420 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:24:40.262789 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:24:40.263039 [debug] [MainThread]: Partial parsing: added file: btc_elt://models/output/fct_btc_indicators.sql
[0m23:24:40.356439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e92cd50>]}
[0m23:24:40.380824 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:24:40.382055 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:24:40.393410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ff4d310>]}
[0m23:24:40.393633 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:24:40.393802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ee91470>]}
[0m23:24:40.394576 [info ] [MainThread]: 
[0m23:24:40.394721 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:24:40.394827 [info ] [MainThread]: 
[0m23:24:40.395017 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:24:40.395358 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:24:40.449061 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:24:40.449252 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:24:40.449352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:24:41.031734 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.582 seconds
[0m23:24:41.035519 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:24:41.049392 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:24:41.049843 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:24:41.185894 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.136 seconds
[0m23:24:41.189108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4c120>]}
[0m23:24:41.193881 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:24:41.195002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:24:41.195356 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:24:41.202165 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:24:41.203591 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:24:41.203931 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:24:41.204277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:24:41.204589 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:24:41.206680 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:24:41.207607 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:24:41.208152 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:24:41.208524 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:24:41.208805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:24:41.208994 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:24:41.226251 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:24:41.226942 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:24:41.241858 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:24:41.243580 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:24:41.243840 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.
-- Columns are named in plain English for your report & dashboard.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:24:41.350388 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0833c-0307-153c-000f-c0df0084e7f2
[0m23:24:41.350860 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 22 at position 143 unexpected ';'.
[0m23:24:41.354909 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.356207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150b72c90>]}
[0m23:24:41.356753 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.15s]
[0m23:24:41.357187 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:24:41.357616 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:24:41.358897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:24:41.359093 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:24:41.359282 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:24:41.479755 [info ] [MainThread]: 
[0m23:24:41.480395 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.08 seconds (1.08s).
[0m23:24:41.481262 [debug] [MainThread]: Command end result
[0m23:24:41.505405 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:24:41.507138 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:24:41.511854 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:24:41.512083 [info ] [MainThread]: 
[0m23:24:41.512339 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:24:41.512524 [info ] [MainThread]: 
[0m23:24:41.512759 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:24:41.512963 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.513107 [info ] [MainThread]: 
[0m23:24:41.513282 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.513421 [info ] [MainThread]: 
[0m23:24:41.513596 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:24:41.518308 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0745935, "process_in_blocks": "0", "process_kernel_time": 1.48311, "process_mem_max_rss": "230457344", "process_out_blocks": "0", "process_user_time": 2.354057}
[0m23:24:41.518614 [debug] [MainThread]: Command `dbt run` failed at 23:24:41.518559 after 2.08 seconds
[0m23:24:41.518949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150e7b280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4b7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4bcf0>]}
[0m23:24:41.519222 [debug] [MainThread]: Flushing usage events
[0m23:24:41.911071 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:26:38.762735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11232f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11232fc50>]}


============================== 23:26:38.765151 | 2d4d66ff-6779-43fc-8879-581543c3e5ed ==============================
[0m23:26:38.765151 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:26:38.765423 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'version_check': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'no_print': 'None', 'target_path': 'None', 'quiet': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:26:39.299161 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:26:39.299381 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:26:39.299486 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:26:39.413780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113bdf30>]}
[0m23:26:39.433409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e27ff00>]}
[0m23:26:39.433880 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:26:39.480214 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:26:39.535373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:26:39.535606 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/output/fct_btc_indicators.sql
[0m23:26:39.624910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14eb48d50>]}
[0m23:26:39.648401 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:26:39.649335 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:26:39.658687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e34d310>]}
[0m23:26:39.658856 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:26:39.658982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ed991d0>]}
[0m23:26:39.659619 [info ] [MainThread]: 
[0m23:26:39.659751 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:26:39.659849 [info ] [MainThread]: 
[0m23:26:39.660018 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:26:39.660323 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:26:39.710975 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:26:39.711150 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:26:39.711249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:26:40.272971 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.562 seconds
[0m23:26:40.276531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:26:40.288328 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:26:40.288738 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:26:40.469317 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.180 seconds
[0m23:26:40.473472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd40120>]}
[0m23:26:40.476427 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:26:40.477534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:26:40.477889 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:26:40.484691 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:26:40.485648 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:26:40.485824 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:26:40.486017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:26:40.486172 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:26:40.487141 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:26:40.487468 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:26:40.487755 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:26:40.488017 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:26:40.488216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:26:40.488338 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:26:40.502799 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:26:40.503433 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:26:40.516130 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:26:40.517771 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:26:40.517924 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:26:40.625796 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0833e-0307-153f-000f-c0df00849656
[0m23:26:40.626195 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:26:40.631359 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.632875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa6ec90>]}
[0m23:26:40.633383 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.14s]
[0m23:26:40.633801 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:26:40.634215 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:26:40.635519 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:26:40.635785 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:26:40.635990 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:26:40.756375 [info ] [MainThread]: 
[0m23:26:40.757015 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m23:26:40.757739 [debug] [MainThread]: Command end result
[0m23:26:40.779894 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:26:40.781345 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:26:40.785553 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:26:40.785777 [info ] [MainThread]: 
[0m23:26:40.786027 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:26:40.786217 [info ] [MainThread]: 
[0m23:26:40.786453 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:26:40.786656 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.786803 [info ] [MainThread]: 
[0m23:26:40.786977 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.787118 [info ] [MainThread]: 
[0m23:26:40.787288 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:26:40.792493 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.055735, "process_in_blocks": "0", "process_kernel_time": 1.316128, "process_mem_max_rss": "230309888", "process_out_blocks": "0", "process_user_time": 2.458278}
[0m23:26:40.793383 [debug] [MainThread]: Command `dbt run` failed at 23:26:40.793299 after 2.06 seconds
[0m23:26:40.793669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc76fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd3efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd3edf0>]}
[0m23:26:40.793902 [debug] [MainThread]: Flushing usage events
[0m23:26:41.204224 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:28:34.445407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cee900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632fc50>]}


============================== 23:28:34.447862 | e844ccca-faaf-4fe0-8f77-a0e57bc3fd23 ==============================
[0m23:28:34.447862 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:28:34.448122 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'write_json': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'empty': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error': 'None'}
[0m23:28:35.027058 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:28:35.027264 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:28:35.027413 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:28:35.142866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b1f30>]}
[0m23:28:35.161450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b07ff00>]}
[0m23:28:35.161910 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:28:35.206923 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:28:35.262046 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:28:35.262288 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/input/stg_btc_ohlc.sql
[0m23:28:35.353692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba48b50>]}
[0m23:28:35.375982 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:28:35.377117 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:28:35.386541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b14d310>]}
[0m23:28:35.386724 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:28:35.386852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bbd5a90>]}
[0m23:28:35.387479 [info ] [MainThread]: 
[0m23:28:35.387611 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:28:35.387705 [info ] [MainThread]: 
[0m23:28:35.387881 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:28:35.388199 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:28:35.438391 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:28:35.438570 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:28:35.438666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:28:36.017001 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.578 seconds
[0m23:28:36.021985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:28:36.031439 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:28:36.031740 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:28:36.156301 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.124 seconds
[0m23:28:36.160911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb7f860>]}
[0m23:28:36.165427 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:28:36.165987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:28:36.166360 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:28:36.173668 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:28:36.174901 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:28:36.175233 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:28:36.175572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:28:36.175833 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:28:36.178175 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:28:36.178889 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:28:36.179393 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:28:36.179738 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:28:36.180491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:28:36.180743 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:28:36.202226 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:28:36.202948 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:28:36.217027 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:28:36.218786 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:28:36.218956 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:28:36.352261 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08340-0307-1540-000f-c0df0084774e
[0m23:28:36.352782 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:28:36.358346 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.359893 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c872ed0>]}
[0m23:28:36.360421 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.18s]
[0m23:28:36.360904 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:28:36.361419 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:28:36.362742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:28:36.362947 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:28:36.363130 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:28:36.547200 [info ] [MainThread]: 
[0m23:28:36.548007 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m23:28:36.548945 [debug] [MainThread]: Command end result
[0m23:28:36.576806 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:28:36.578349 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:28:36.582516 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:28:36.582693 [info ] [MainThread]: 
[0m23:28:36.582906 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:28:36.583067 [info ] [MainThread]: 
[0m23:28:36.583266 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:28:36.583441 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.583579 [info ] [MainThread]: 
[0m23:28:36.583737 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.583874 [info ] [MainThread]: 
[0m23:28:36.584033 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:28:36.588395 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1703696, "process_in_blocks": "0", "process_kernel_time": 0.786676, "process_mem_max_rss": "233816064", "process_out_blocks": "0", "process_user_time": 2.904135}
[0m23:28:36.588671 [debug] [MainThread]: Command `dbt run` failed at 23:28:36.588616 after 2.17 seconds
[0m23:28:36.588918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb731d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc0d810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc0c050>]}
[0m23:28:36.589145 [debug] [MainThread]: Flushing usage events
[0m23:28:36.995115 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:05.438881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba179d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba17c50>]}


============================== 23:29:05.441906 | d0fc5d6f-56eb-48ac-ae5b-c5b49b1b1642 ==============================
[0m23:29:05.441906 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:05.442188 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'indirect_selection': 'eager', 'partial_parse': 'True', 'no_print': 'None', 'write_json': 'True', 'warn_error': 'None', 'printer_width': '80', 'empty': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True', 'quiet': 'False', 'target_path': 'None', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:29:05.497999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0fc5d6f-56eb-48ac-ae5b-c5b49b1b1642', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10805df30>]}
[0m23:29:05.507787 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.10025488, "process_in_blocks": "0", "process_kernel_time": 0.124872, "process_mem_max_rss": "116326400", "process_out_blocks": "0", "process_user_time": 0.568777}
[0m23:29:05.507988 [debug] [MainThread]: Command `dbt clean` succeeded at 23:29:05.507946 after 0.10 seconds
[0m23:29:05.508127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8b3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8b2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bce2450>]}
[0m23:29:05.508255 [debug] [MainThread]: Flushing usage events
[0m23:29:05.857241 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:21.374069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ebe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113937c50>]}


============================== 23:29:21.376394 | c93d3797-aaf5-4b39-8bd8-437e8abdd7b8 ==============================
[0m23:29:21.376394 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:21.376626 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'introspect': 'True', 'target_path': 'None', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'fail_fast': 'False', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt compile', 'printer_width': '80', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'static_parser': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:29:21.891430 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:29:21.891640 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:29:21.891747 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:29:21.962984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117bdf30>]}
[0m23:29:21.982706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e47ff00>]}
[0m23:29:21.983727 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:29:22.028438 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:29:22.028788 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:29:22.028935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e535350>]}
[0m23:29:22.427425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f8e8a0>]}
[0m23:29:22.450262 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:22.451872 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:22.459940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f48d550>]}
[0m23:29:22.460111 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:29:22.460231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509624e0>]}
[0m23:29:22.460871 [info ] [MainThread]: 
[0m23:29:22.461000 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:29:22.461094 [info ] [MainThread]: 
[0m23:29:22.461261 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:29:22.461559 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:29:22.512133 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:29:22.512331 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:29:22.512438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:29:23.095740 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.583 seconds
[0m23:29:23.098861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f672ed0>]}
[0m23:29:23.102390 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:29:23.102879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:29:23.103195 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:29:23.112975 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:29:23.114055 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:29:23.114301 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:29:23.114546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:29:23.114812 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:29:23.116686 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:29:23.117192 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:29:23.117592 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:29:23.117870 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:29:23.118091 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:29:23.136750 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:29:23.137243 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:29:23.137487 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:29:23.137880 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:29:23.138017 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:29:23.138139 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:29:23.281445 [debug] [MainThread]: Command end result
[0m23:29:23.304610 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:23.305996 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:23.310481 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:29:23.315170 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9681581, "process_in_blocks": "0", "process_kernel_time": 0.933403, "process_mem_max_rss": "235077632", "process_out_blocks": "0", "process_user_time": 3.118434}
[0m23:29:23.315429 [debug] [MainThread]: Command `dbt compile` succeeded at 23:29:23.315376 after 1.97 seconds
[0m23:29:23.315665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1560e5390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509b7570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509b6530>]}
[0m23:29:23.315867 [debug] [MainThread]: Flushing usage events
[0m23:29:23.691324 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:28.735444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063ba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792fc50>]}


============================== 23:29:28.737558 | afa245bd-71d0-47e6-b3ae-88959ceb378b ==============================
[0m23:29:28.737558 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:28.737791 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_format': 'default', 'use_colors': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/snehasingh/.dbt', 'static_parser': 'True', 'empty': 'False', 'fail_fast': 'False', 'introspect': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'debug': 'False', 'log_cache_events': 'False'}
[0m23:29:29.176269 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:29:29.176489 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:29:29.176597 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:29:29.246669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068bdf30>]}
[0m23:29:29.265499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15167ff00>]}
[0m23:29:29.266018 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:29:29.309617 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:29:29.362757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:29:29.362919 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:29:29.373796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151837950>]}
[0m23:29:29.398611 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:29.399341 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:29.407613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15184d310>]}
[0m23:29:29.407778 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:29:29.407899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1518f3310>]}
[0m23:29:29.408530 [info ] [MainThread]: 
[0m23:29:29.408654 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:29:29.408749 [info ] [MainThread]: 
[0m23:29:29.408918 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:29:29.409241 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:29:29.431969 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:29:29.432153 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:29:29.432261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:29:29.966580 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.534 seconds
[0m23:29:29.969553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:29:29.980279 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:29:29.980550 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:29:30.120181 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.139 seconds
[0m23:29:30.124333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154c806d0>]}
[0m23:29:30.128545 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:29:30.129065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:29:30.129411 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:29:30.136967 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:29:30.137912 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:29:30.138222 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:29:30.138637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:29:30.139018 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:29:30.141411 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:29:30.142037 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:29:30.142542 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:29:30.143001 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:29:30.143378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:29:30.143606 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:29:30.167217 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:29:30.167716 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:29:30.181549 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:29:30.183328 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:29:30.183496 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:29:30.308699 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08341-0307-153c-000f-c0df0084e802
[0m23:29:30.309053 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:29:30.313844 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.315237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154bf1c10>]}
[0m23:29:30.315729 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.17s]
[0m23:29:30.316121 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:29:30.316428 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:29:30.317639 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:29:30.317844 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:29:30.318029 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:29:30.458967 [info ] [MainThread]: 
[0m23:29:30.459638 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m23:29:30.460476 [debug] [MainThread]: Command end result
[0m23:29:30.483260 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:30.484687 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:30.489007 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:29:30.489213 [info ] [MainThread]: 
[0m23:29:30.489458 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:29:30.489640 [info ] [MainThread]: 
[0m23:29:30.489875 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:29:30.490177 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.490405 [info ] [MainThread]: 
[0m23:29:30.490626 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.490786 [info ] [MainThread]: 
[0m23:29:30.490985 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:29:30.495828 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7846107, "process_in_blocks": "0", "process_kernel_time": 0.959001, "process_mem_max_rss": "231882752", "process_out_blocks": "0", "process_user_time": 2.793759}
[0m23:29:30.496174 [debug] [MainThread]: Command `dbt run` failed at 23:29:30.496103 after 1.79 seconds
[0m23:29:30.496491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154c066d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153c83b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153c83bb0>]}
[0m23:29:30.496740 [debug] [MainThread]: Flushing usage events
[0m23:29:30.866960 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:17.246305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046d2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b479d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b47c50>]}


============================== 23:34:17.248760 | 74ad5f41-9090-40e4-bd15-5233bad8e684 ==============================
[0m23:34:17.248760 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:17.248987 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'debug': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt clean', 'indirect_selection': 'eager', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'quiet': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True'}
[0m23:34:17.348988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74ad5f41-9090-40e4-bd15-5233bad8e684', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eddf30>]}
[0m23:34:17.359703 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1405172, "process_in_blocks": "0", "process_kernel_time": 0.113138, "process_mem_max_rss": "115687424", "process_out_blocks": "0", "process_user_time": 0.518426}
[0m23:34:17.359899 [debug] [MainThread]: Command `dbt clean` succeeded at 23:34:17.359858 after 0.14 seconds
[0m23:34:17.360046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf6450>]}
[0m23:34:17.360182 [debug] [MainThread]: Flushing usage events
[0m23:34:17.801483 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:23.492967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613bc50>]}


============================== 23:34:23.495611 | f860eaf5-f2a1-42ff-908e-2f588a28be03 ==============================
[0m23:34:23.495611 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:23.495870 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'profiles_dir': '/Users/snehasingh/.dbt', 'partial_parse': 'True', 'invocation_command': 'dbt compile', 'warn_error': 'None', 'no_print': 'None', 'version_check': 'True', 'fail_fast': 'False'}
[0m23:34:24.047104 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:34:24.047313 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:34:24.047417 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:34:24.116260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051bdf30>]}
[0m23:34:24.134966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14397ff00>]}
[0m23:34:24.135481 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:34:24.179657 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:34:24.180002 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:34:24.180153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143b35350>]}
[0m23:34:24.565210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f8e8a0>]}
[0m23:34:24.588121 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:24.589143 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:24.597341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144115550>]}
[0m23:34:24.597517 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:34:24.597638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1443ea4e0>]}
[0m23:34:24.598301 [info ] [MainThread]: 
[0m23:34:24.598427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:34:24.598526 [info ] [MainThread]: 
[0m23:34:24.598699 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:34:24.598997 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:34:24.650365 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:34:24.650538 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:34:24.650636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:25.185554 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.535 seconds
[0m23:34:25.187884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1441faed0>]}
[0m23:34:25.191292 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:34:25.191720 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:34:25.191991 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:34:25.202208 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:34:25.203535 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:34:25.203788 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:34:25.204113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:34:25.204374 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:34:25.206484 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:34:25.207016 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:34:25.207523 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:34:25.207789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:34:25.207999 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:34:25.226276 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:34:25.226849 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:34:25.227134 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:34:25.227533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:25.227659 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:34:25.227775 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:34:25.377475 [debug] [MainThread]: Command end result
[0m23:34:25.397727 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:25.399072 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:25.403715 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:34:25.408055 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9429365, "process_in_blocks": "0", "process_kernel_time": 1.516712, "process_mem_max_rss": "232767488", "process_out_blocks": "0", "process_user_time": 2.302742}
[0m23:34:25.408336 [debug] [MainThread]: Command `dbt compile` succeeded at 23:34:25.408275 after 1.94 seconds
[0m23:34:25.408573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145be1390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14443e530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14443e5d0>]}
[0m23:34:25.408769 [debug] [MainThread]: Flushing usage events
[0m23:34:25.771919 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:35.723683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c2b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c2bc50>]}


============================== 23:34:35.725832 | 1f078f10-a476-42ee-94c3-186acfb1f08f ==============================
[0m23:34:35.725832 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:35.726070 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'empty': 'False', 'log_cache_events': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'invocation_command': 'dbt run', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'quiet': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'debug': 'False'}
[0m23:34:36.176499 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:34:36.176711 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:34:36.176819 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:34:36.245348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fb1f30>]}
[0m23:34:36.264027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149f7ff00>]}
[0m23:34:36.264523 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:34:36.310252 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:34:36.362117 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:34:36.362276 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:34:36.373156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a037950>]}
[0m23:34:36.398551 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:36.399517 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:36.408196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a04d310>]}
[0m23:34:36.408368 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:34:36.408490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a0f34d0>]}
[0m23:34:36.409134 [info ] [MainThread]: 
[0m23:34:36.409263 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:34:36.409362 [info ] [MainThread]: 
[0m23:34:36.409544 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:34:36.409863 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:34:36.433539 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:34:36.433723 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:34:36.433827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:36.939485 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.505 seconds
[0m23:34:36.943330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:34:36.957462 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:34:36.957925 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:34:37.068344 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.110 seconds
[0m23:34:37.072275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b57c6d0>]}
[0m23:34:37.077692 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:34:37.078215 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:34:37.078552 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:34:37.086478 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:34:37.087583 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:34:37.087928 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:34:37.088307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:34:37.088615 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:34:37.091282 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:34:37.091900 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:34:37.092416 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:34:37.092907 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:34:37.093275 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:34:37.093517 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:34:37.117966 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:34:37.118644 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:34:37.132989 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:34:37.134927 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:34:37.135173 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (price, market cap, volume)
    SELECT * FROM __dbt__cte__stg_btc_market
), ohlc_data AS (
    -- Staging: BTC daily candlestick inputs (open, high, low, close)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
), joined_data AS (
    -- Join trend + candles on date → one row per date with all fields
    SELECT
        m.date              AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open              AS open_price,
        o.high              AS high_price,
        o.low               AS low_price,
        o.close             AS close_price
    FROM market_data m
    LEFT JOIN ohlc_data o
      ON m.date = o.date
), moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
), rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
), gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
), rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
), momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
), final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:34:39.032725 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.897 seconds
[0m23:34:39.047089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4ee2d0>]}
[0m23:34:39.047432 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.95s]
[0m23:34:39.047698 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:34:39.048340 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:39.048525 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:34:39.048668 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:34:39.181355 [info ] [MainThread]: 
[0m23:34:39.182019 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.77 seconds (2.77s).
[0m23:34:39.182807 [debug] [MainThread]: Command end result
[0m23:34:39.203206 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:39.204380 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:39.207121 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:34:39.207312 [info ] [MainThread]: 
[0m23:34:39.207514 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:34:39.207661 [info ] [MainThread]: 
[0m23:34:39.207824 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:34:39.211556 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5121827, "process_in_blocks": "0", "process_kernel_time": 0.962504, "process_mem_max_rss": "231702528", "process_out_blocks": "0", "process_user_time": 2.779631}
[0m23:34:39.211805 [debug] [MainThread]: Command `dbt run` succeeded at 23:34:39.211751 after 3.51 seconds
[0m23:34:39.212008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b502a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a5bbcf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a5bbd90>]}
[0m23:34:39.212196 [debug] [MainThread]: Flushing usage events
[0m23:34:39.577968 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:38:24.161429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108737c50>]}


============================== 23:38:24.163832 | d165260b-062a-451b-bf38-2578b43c4844 ==============================
[0m23:38:24.163832 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:38:24.164075 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt test', 'use_experimental_parser': 'False', 'warn_error': 'None', 'printer_width': '80', 'write_json': 'True', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'no_print': 'None', 'debug': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'log_format': 'default', 'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'empty': 'None', 'partial_parse': 'True'}
[0m23:38:24.725440 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:38:24.725666 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:38:24.725781 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:38:24.838005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077bdf30>]}
[0m23:38:24.856604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f97ff00>]}
[0m23:38:24.857052 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:38:24.907343 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:38:24.965650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:38:24.965897 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/schema.yml
[0m23:38:25.055876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c840d50>]}
[0m23:38:25.084759 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:38:25.085738 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:38:25.101876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc08aa0>]}
[0m23:38:25.102063 [info ] [MainThread]: Found 3 models, 3 data tests, 3 sources, 516 macros
[0m23:38:25.102194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb1e350>]}
[0m23:38:25.102869 [info ] [MainThread]: 
[0m23:38:25.102999 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:38:25.103098 [info ] [MainThread]: 
[0m23:38:25.103273 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:38:25.103617 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:38:25.154962 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:38:25.155153 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:38:25.155261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:25.810435 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.655 seconds
[0m23:38:25.815548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d199090>]}
[0m23:38:25.818918 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.819287 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m23:38:25.819665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:38:25.819935 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.832112 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.832818 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.843998 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.844859 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.845062 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m23:38:26.090350 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.245 seconds
[0m23:38:26.102111 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.28s]
[0m23:38:26.102762 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:26.103136 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.103536 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m23:38:26.103940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:38:26.104237 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.108262 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.109168 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.111482 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.112372 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.112672 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m23:38:26.466955 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.354 seconds
[0m23:38:26.470669 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.37s]
[0m23:38:26.471429 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.471873 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.472370 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m23:38:26.472903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:38:26.473291 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.481628 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.482770 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.485130 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.486162 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.486445 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m23:38:26.709828 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.223 seconds
[0m23:38:26.713847 [error] [Thread-1 (]: 3 of 3 FAIL 1 unique_fct_btc_indicators_date ................................... [[31mFAIL 1[0m in 0.24s]
[0m23:38:26.714450 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.715504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:38:26.715773 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:38:26.715998 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:38:26.872126 [info ] [MainThread]: 
[0m23:38:26.872842 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 1.77 seconds (1.77s).
[0m23:38:26.873840 [debug] [MainThread]: Command end result
[0m23:38:26.897122 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:38:26.898121 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:38:26.902212 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:38:26.902419 [info ] [MainThread]: 
[0m23:38:26.902619 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:38:26.902771 [info ] [MainThread]: 
[0m23:38:26.902951 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m23:38:26.903114 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m23:38:26.903233 [info ] [MainThread]: 
[0m23:38:26.903385 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m23:38:26.903511 [info ] [MainThread]: 
[0m23:38:26.903657 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:38:26.907159 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.7729714, "process_in_blocks": "0", "process_kernel_time": 1.410598, "process_mem_max_rss": "234389504", "process_out_blocks": "0", "process_user_time": 2.410128}
[0m23:38:26.907386 [debug] [MainThread]: Command `dbt test` failed at 23:38:26.907333 after 2.77 seconds
[0m23:38:26.907578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086f0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d4936a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d4933e0>]}
[0m23:38:26.907818 [debug] [MainThread]: Flushing usage events
[0m23:38:27.292090 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:39.895662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d9e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092039d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109203c50>]}


============================== 23:46:39.898186 | 8a31aa3c-15c9-40ba-ba35-01cb047d40f5 ==============================
[0m23:46:39.898186 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:39.898443 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'introspect': 'True', 'printer_width': '80', 'quiet': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'debug': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'version_check': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'static_parser': 'True', 'warn_error': 'None', 'no_print': 'None', 'log_format': 'default', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False'}
[0m23:46:39.997990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a31aa3c-15c9-40ba-ba35-01cb047d40f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108591f30>]}
[0m23:46:40.007998 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.14048725, "process_in_blocks": "0", "process_kernel_time": 0.117092, "process_mem_max_rss": "115654656", "process_out_blocks": "0", "process_user_time": 0.523906}
[0m23:46:40.008158 [debug] [MainThread]: Command `dbt clean` succeeded at 23:46:40.008117 after 0.14 seconds
[0m23:46:40.008283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109087130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109086cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093ae450>]}
[0m23:46:40.008403 [debug] [MainThread]: Flushing usage events
[0m23:46:40.416970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:46.225361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104442900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058bf9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058bfc50>]}


============================== 23:46:46.227611 | 4a1dddbf-734a-4e0e-ab38-d4cc50350021 ==============================
[0m23:46:46.227611 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:46.227853 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt compile', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'version_check': 'True', 'log_format': 'default', 'quiet': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'printer_width': '80', 'no_print': 'None', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False'}
[0m23:46:46.828398 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:46:46.828602 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:46:46.828706 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:46:46.899965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c4df30>]}
[0m23:46:46.919759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124de7f00>]}
[0m23:46:46.920181 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:46:46.965012 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:46:46.965368 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:46:46.965518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124e9d350>]}
[0m23:46:47.351735 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:46:47.354296 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 1.1543303, "process_in_blocks": "0", "process_kernel_time": 1.348889, "process_mem_max_rss": "221167616", "process_out_blocks": "0", "process_user_time": 2.348112}
[0m23:46:47.354478 [debug] [MainThread]: Command `dbt compile` failed at 23:46:47.354436 after 1.15 seconds
[0m23:46:47.354629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124eb45f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12540e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058abe70>]}
[0m23:46:47.354747 [debug] [MainThread]: Flushing usage events
[0m23:46:47.726206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:52.751453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c56900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c3c50>]}


============================== 23:46:52.753612 | 7bbf5fc2-2c43-462b-9373-e884e3ae7aca ==============================
[0m23:46:52.753612 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:52.753855 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'log_format': 'default', 'version_check': 'True', 'fail_fast': 'False', 'warn_error': 'None'}
[0m23:46:53.210459 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:46:53.210688 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:46:53.210809 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:46:53.279974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108449f30>]}
[0m23:46:53.299532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146c7ff00>]}
[0m23:46:53.300047 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:46:53.344064 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:46:53.344439 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:46:53.344601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146d35350>]}
[0m23:46:53.728406 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:46:53.730961 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.0038918, "process_in_blocks": "0", "process_kernel_time": 1.061105, "process_mem_max_rss": "223002624", "process_out_blocks": "0", "process_user_time": 2.735523}
[0m23:46:53.731143 [debug] [MainThread]: Command `dbt run` failed at 23:46:53.731100 after 1.00 seconds
[0m23:46:53.731287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146d4c5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147212300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090a3e70>]}
[0m23:46:53.731404 [debug] [MainThread]: Flushing usage events
[0m23:46:54.148081 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:50:48.574486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d8a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071eb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071ebc50>]}


============================== 23:50:48.576931 | 337e2aa6-422b-4019-a19b-cd4fc431cf5a ==============================
[0m23:50:48.576931 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:50:48.577175 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'partial_parse': 'True', 'no_print': 'None', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'version_check': 'True', 'invocation_command': 'dbt snapshot', 'empty': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'quiet': 'False'}
[0m23:50:49.162977 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:50:49.163224 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:50:49.163339 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:50:49.280333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10657df30>]}
[0m23:50:49.299942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13307ff00>]}
[0m23:50:49.300392 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:50:49.347782 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:50:49.348152 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:50:49.348300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133135350>]}
[0m23:50:49.749400 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:50:49.752725 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": false, "command_wall_clock_time": 1.2064234, "process_in_blocks": "0", "process_kernel_time": 1.779903, "process_mem_max_rss": "220102656", "process_out_blocks": "0", "process_user_time": 1.866237}
[0m23:50:49.752946 [debug] [MainThread]: Command `dbt snapshot` failed at 23:50:49.752897 after 1.21 seconds
[0m23:50:49.753115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13314c5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1337ce300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071dbd90>]}
[0m23:50:49.753239 [debug] [MainThread]: Flushing usage events
[0m23:50:50.238047 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:14.102679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103afe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5bc50>]}


============================== 23:53:14.105114 | 0650e2bd-3c23-46d6-87fe-e350889f138b ==============================
[0m23:53:14.105114 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:53:14.105394 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt clean', 'introspect': 'True', 'partial_parse': 'True', 'printer_width': '80', 'static_parser': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:53:14.204887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0650e2bd-3c23-46d6-87fe-e350889f138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042f1f30>]}
[0m23:53:14.213886 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1382515, "process_in_blocks": "0", "process_kernel_time": 0.121303, "process_mem_max_rss": "115851264", "process_out_blocks": "0", "process_user_time": 0.535413}
[0m23:53:14.214167 [debug] [MainThread]: Command `dbt clean` succeeded at 23:53:14.214102 after 0.14 seconds
[0m23:53:14.214452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de7130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de6cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050fa450>]}
[0m23:53:14.214603 [debug] [MainThread]: Flushing usage events
[0m23:53:14.604679 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:30.994753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c2b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c2bc50>]}


============================== 23:53:30.996936 | 1937b573-09d0-4976-bf35-e8e1ba50d392 ==============================
[0m23:53:30.996936 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:53:30.997172 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'no_print': 'None', 'log_format': 'default', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'write_json': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'printer_width': '80', 'profiles_dir': '/Users/snehasingh/.dbt', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt snapshot', 'indirect_selection': 'eager', 'target_path': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'debug': 'False', 'static_parser': 'True'}
[0m23:53:31.510143 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:53:31.510352 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:53:31.510464 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:53:31.579676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cbdf30>]}
[0m23:53:31.598829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e27ff00>]}
[0m23:53:31.599339 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:53:31.646450 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:53:31.646842 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:53:31.646997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e335350>]}
[0m23:53:32.173316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e88a210>]}
[0m23:53:32.206710 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:32.207777 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:32.217633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ee3dfd0>]}
[0m23:53:32.217839 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:53:32.217969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150087e10>]}
[0m23:53:32.218666 [info ] [MainThread]: 
[0m23:53:32.218797 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:53:32.218895 [info ] [MainThread]: 
[0m23:53:32.219075 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:53:32.220528 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:53:32.269647 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:53:32.269829 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:53:32.269931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:32.708103 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.438 seconds
[0m23:53:32.712542 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:53:32.726936 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:53:32.727365 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:53:32.882493 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.155 seconds
[0m23:53:32.885614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:53:32.889027 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:53:32.889466 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:53:33.037733 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.148 seconds
[0m23:53:33.042088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1501e7f50>]}
[0m23:53:33.046305 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m23:53:33.046973 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m23:53:33.047438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m23:53:33.047756 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m23:53:33.058773 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m23:53:33.100194 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:33.100443 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:53:33.942067 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.841 seconds
[0m23:53:33.947481 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:33.947987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:53:34.045247 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.097 seconds
[0m23:53:34.046742 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m23:53:34.049358 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:34.049899 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_market
    
    
    
    as (
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m23:53:35.169979 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.119 seconds
[0m23:53:35.194929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155a305d0>]}
[0m23:53:35.195772 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 2.15s]
[0m23:53:35.196206 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m23:53:35.196484 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.196845 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m23:53:35.197145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m23:53:35.197367 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.200386 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.203329 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.203624 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:53:35.462727 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.258 seconds
[0m23:53:35.465442 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.465955 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:53:35.557398 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.091 seconds
[0m23:53:35.558989 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.562176 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.562616 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_ohlc
    
    
    
    as (
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m23:53:36.444139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.881 seconds
[0m23:53:36.447143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155aa1270>]}
[0m23:53:36.448008 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.25s]
[0m23:53:36.448573 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:36.449742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:36.450062 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was left open.
[0m23:53:36.450308 [debug] [MainThread]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m23:53:36.593833 [info ] [MainThread]: 
[0m23:53:36.594436 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.37 seconds (4.37s).
[0m23:53:36.595350 [debug] [MainThread]: Command end result
[0m23:53:36.619431 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:36.620984 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:36.624946 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:53:36.625158 [info ] [MainThread]: 
[0m23:53:36.625418 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:53:36.625585 [info ] [MainThread]: 
[0m23:53:36.625779 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:53:36.630479 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 5.66549, "process_in_blocks": "0", "process_kernel_time": 1.348495, "process_mem_max_rss": "240959488", "process_out_blocks": "0", "process_user_time": 2.948727}
[0m23:53:36.630796 [debug] [MainThread]: Command `dbt snapshot` succeeded at 23:53:36.630731 after 5.67 seconds
[0m23:53:36.631050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150058f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c5e9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c43d90>]}
[0m23:53:36.631270 [debug] [MainThread]: Flushing usage events
[0m23:53:36.996452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:54:16.288965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c52900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050af9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050afc50>]}


============================== 23:54:16.291966 | 76cd56db-842d-4e5f-a692-edcb785050fa ==============================
[0m23:54:16.291966 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:54:16.292258 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'use_colors': 'True', 'invocation_command': 'dbt test', 'debug': 'False', 'log_cache_events': 'False', 'empty': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'fail_fast': 'False'}
[0m23:54:16.894991 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:54:16.895229 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:54:16.895346 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:54:17.012913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104441f30>]}
[0m23:54:17.048376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12557ff00>]}
[0m23:54:17.048965 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:54:17.101759 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:54:17.174691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:54:17.174881 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:54:17.196392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e36150>]}
[0m23:54:17.231312 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:54:17.232681 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:54:17.249718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320423f0>]}
[0m23:54:17.250000 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:54:17.250153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320ae0b0>]}
[0m23:54:17.250979 [info ] [MainThread]: 
[0m23:54:17.251134 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:54:17.251234 [info ] [MainThread]: 
[0m23:54:17.251444 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:54:17.253177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m23:54:17.306631 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:54:17.306841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:54:17.306956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:17.899484 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.592 seconds
[0m23:54:17.901969 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:54:17.904705 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:54:17.905055 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:54:18.012738 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.107 seconds
[0m23:54:18.017593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13250db20>]}
[0m23:54:18.024130 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.024614 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m23:54:18.025075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:54:18.025403 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.038505 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.039430 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.052641 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.053415 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.053617 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m23:54:18.199327 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.145 seconds
[0m23:54:18.209572 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.18s]
[0m23:54:18.210261 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.210591 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.211007 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m23:54:18.211502 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:54:18.211821 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.215205 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.216023 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.218367 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.219252 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.219520 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m23:54:18.792097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.572 seconds
[0m23:54:18.795169 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.58s]
[0m23:54:18.795822 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.796180 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.796580 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m23:54:18.797031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:54:18.797364 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.803395 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.804181 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.806740 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.807848 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.808170 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m23:54:18.939384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.131 seconds
[0m23:54:18.942584 [error] [Thread-1 (]: 3 of 3 FAIL 1 unique_fct_btc_indicators_date ................................... [[31mFAIL 1[0m in 0.15s]
[0m23:54:18.943247 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.944437 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:54:18.944770 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:54:18.945050 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:54:19.076267 [info ] [MainThread]: 
[0m23:54:19.076786 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 1.82 seconds (1.82s).
[0m23:54:19.077800 [debug] [MainThread]: Command end result
[0m23:54:19.096372 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:54:19.097162 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:54:19.099663 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:54:19.099787 [info ] [MainThread]: 
[0m23:54:19.099925 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:54:19.100036 [info ] [MainThread]: 
[0m23:54:19.100166 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m23:54:19.100283 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m23:54:19.100370 [info ] [MainThread]: 
[0m23:54:19.100475 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m23:54:19.100570 [info ] [MainThread]: 
[0m23:54:19.100711 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:54:19.103499 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.844331, "process_in_blocks": "0", "process_kernel_time": 2.042544, "process_mem_max_rss": "227950592", "process_out_blocks": "0", "process_user_time": 1.569935}
[0m23:54:19.103671 [debug] [MainThread]: Command `dbt test` failed at 23:54:19.103638 after 2.84 seconds
[0m23:54:19.103810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105074950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132723540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132723800>]}
[0m23:54:19.103933 [debug] [MainThread]: Flushing usage events
[0m23:54:19.460701 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:57:46.188421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111abe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113427c50>]}


============================== 23:57:46.190824 | d3c8c781-d817-4ae2-9aff-6b796d56927a ==============================
[0m23:57:46.190824 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:57:46.191091 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'printer_width': '80', 'write_json': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'empty': 'None', 'invocation_command': 'dbt clean', 'cache_selected_only': 'False', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'no_print': 'None', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'version_check': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:57:46.297303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3c8c781-d817-4ae2-9aff-6b796d56927a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124bdf30>]}
[0m23:57:46.307745 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.14667341, "process_in_blocks": "0", "process_kernel_time": 0.112888, "process_mem_max_rss": "115703808", "process_out_blocks": "0", "process_user_time": 0.526976}
[0m23:57:46.307906 [debug] [MainThread]: Command `dbt clean` succeeded at 23:57:46.307870 after 0.15 seconds
[0m23:57:46.308043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136de450>]}
[0m23:57:46.308164 [debug] [MainThread]: Flushing usage events
[0m23:57:46.976142 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:58:04.358366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10470a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7bc50>]}


============================== 23:58:04.360693 | ac5f7ecf-abc8-4dff-8457-4b222ab20c01 ==============================
[0m23:58:04.360693 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:58:04.360941 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'use_colors': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'no_print': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'introspect': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt compile'}
[0m23:58:04.955535 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:58:04.955777 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:58:04.955902 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:58:05.040999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104efdf30>]}
[0m23:58:05.061581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14087ff00>]}
[0m23:58:05.063075 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:58:05.112122 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:58:05.112546 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:58:05.112726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140a35350>]}
[0m23:58:05.644545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142abe210>]}
[0m23:58:05.680691 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:05.681922 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:05.691020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b8eeb0>]}
[0m23:58:05.691235 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:58:05.691360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14430f380>]}
[0m23:58:05.692184 [info ] [MainThread]: 
[0m23:58:05.692368 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:58:05.692480 [info ] [MainThread]: 
[0m23:58:05.692672 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:58:05.694266 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:58:05.746445 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:58:05.746636 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:58:05.746741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:06.261537 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.515 seconds
[0m23:58:06.264132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:58:06.267333 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:58:06.267777 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:58:06.416165 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.148 seconds
[0m23:58:06.420090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442d9fd0>]}
[0m23:58:06.423887 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:58:06.425635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m23:58:06.426133 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:58:06.434437 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:58:06.435961 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:58:06.436344 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:58:06.436810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:58:06.437207 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:58:06.439843 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:58:06.440599 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:58:06.440907 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m23:58:06.441225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m23:58:06.441510 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447067 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447494 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447721 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.447972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m23:58:06.448173 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.449939 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.450372 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.450626 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:58:06.450875 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:58:06.451095 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:58:06.461491 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:58:06.461922 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:58:06.462212 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:58:06.462575 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.462761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:58:06.462911 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.468541 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:58:06.468891 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.469135 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.469283 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.469441 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:58:06.469574 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471084 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:58:06.471323 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471563 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471712 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.471862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:58:06.471996 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.474252 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:58:06.474490 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.474706 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.475168 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:06.475295 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:58:06.475409 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:58:06.610720 [debug] [MainThread]: Command end result
[0m23:58:06.632754 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:06.634100 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:06.638432 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:58:06.642605 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.3102677, "process_in_blocks": "0", "process_kernel_time": 1.893109, "process_mem_max_rss": "238239744", "process_out_blocks": "0", "process_user_time": 2.147471}
[0m23:58:06.642879 [debug] [MainThread]: Command `dbt compile` succeeded at 23:58:06.642817 after 2.31 seconds
[0m23:58:06.643114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144b4c100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144af3bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144af2c10>]}
[0m23:58:06.643315 [debug] [MainThread]: Flushing usage events
[0m23:58:07.020175 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:58:30.039716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072fc50>]}


============================== 23:58:30.042549 | e9a08186-764c-4fd6-a269-4182344caa2b ==============================
[0m23:58:30.042549 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:58:30.042904 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'introspect': 'True', 'static_parser': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'version_check': 'True', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:58:30.648791 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:58:30.649032 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:58:30.649140 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:58:30.723903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052bdf30>]}
[0m23:58:30.743989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b17ff00>]}
[0m23:58:30.744392 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:58:30.788953 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:58:30.853125 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:58:30.853318 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:58:30.874643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b235450>]}
[0m23:58:30.907347 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:30.908310 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:30.917158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b24d310>]}
[0m23:58:30.917344 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:58:30.917467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b293150>]}
[0m23:58:30.918164 [info ] [MainThread]: 
[0m23:58:30.918294 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:58:30.918391 [info ] [MainThread]: 
[0m23:58:30.918574 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:58:30.918888 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:58:30.942255 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:58:30.942412 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:58:30.942503 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:31.451811 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.509 seconds
[0m23:58:31.458043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m23:58:31.468578 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:58:31.468776 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:58:31.603501 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.132 seconds
[0m23:58:31.606933 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:58:31.610364 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:58:31.610754 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:58:31.731411 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.120 seconds
[0m23:58:31.735510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c539570>]}
[0m23:58:31.738960 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:58:31.739528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:58:31.739906 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:58:31.749003 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:58:31.750216 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:58:31.750571 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:58:31.750982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:58:31.751340 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:58:31.754193 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:58:31.755299 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:58:31.756068 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:58:31.756589 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:58:31.756932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:58:31.757169 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:58:31.769499 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:58:31.770197 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:58:31.786780 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:58:31.788187 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:58:31.788413 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql (top section with de-dup for BOTH sides)

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → exactly one row per date
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    LEFT JOIN ohlc_daily o
      ON m.date = o.date
)
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:58:31.909685 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0835e-0307-15a3-000f-c0df0084281a
[0m23:58:31.910135 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 105 at position 4 unexpected ')'.
[0m23:58:31.915434 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:31.916963 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c54ee10>]}
[0m23:58:31.917465 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.16s]
[0m23:58:31.917847 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:58:31.918172 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:58:31.919484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:31.919744 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:58:31.919947 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:58:32.074743 [info ] [MainThread]: 
[0m23:58:32.075300 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m23:58:32.076042 [debug] [MainThread]: Command end result
[0m23:58:32.099378 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:32.100496 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:32.103637 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:58:32.103812 [info ] [MainThread]: 
[0m23:58:32.104006 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:58:32.104156 [info ] [MainThread]: 
[0m23:58:32.104330 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:58:32.104519 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:32.104689 [info ] [MainThread]: 
[0m23:58:32.104888 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:32.105011 [info ] [MainThread]: 
[0m23:58:32.105158 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:58:32.108340 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1018443, "process_in_blocks": "0", "process_kernel_time": 1.614929, "process_mem_max_rss": "227885056", "process_out_blocks": "0", "process_user_time": 1.867314}
[0m23:58:32.108567 [debug] [MainThread]: Command `dbt run` failed at 23:58:32.108510 after 2.10 seconds
[0m23:58:32.108796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c8ed700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c91fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c91e170>]}
[0m23:58:32.108989 [debug] [MainThread]: Flushing usage events
[0m23:58:32.479217 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:14:56.784303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f12900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10936f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10936fc50>]}


============================== 00:14:56.786743 | 72c52a52-e838-4d54-9a46-2535bfedab52 ==============================
[0m00:14:56.786743 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:14:56.786999 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'log_format': 'default', 'target_path': 'None', 'debug': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error': 'None'}
[0m00:14:56.886662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72c52a52-e838-4d54-9a46-2535bfedab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108705f30>]}
[0m00:14:56.896614 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1396353, "process_in_blocks": "0", "process_kernel_time": 0.110314, "process_mem_max_rss": "115752960", "process_out_blocks": "0", "process_user_time": 0.520723}
[0m00:14:56.896758 [debug] [MainThread]: Command `dbt clean` succeeded at 00:14:56.896725 after 0.14 seconds
[0m00:14:56.896880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091fb130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091facf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109522450>]}
[0m00:14:56.896985 [debug] [MainThread]: Flushing usage events
[0m00:14:57.292247 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:10.260305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11192f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11192fc50>]}


============================== 00:15:10.262491 | 5c00358c-ab1a-40f9-b828-10589faecc49 ==============================
[0m00:15:10.262491 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:10.262727 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/snehasingh/.dbt', 'no_print': 'None', 'invocation_command': 'dbt compile', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'target_path': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'debug': 'False', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'static_parser': 'True'}
[0m00:15:10.789556 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:10.789770 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:10.789877 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:10.860039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108bdf30>]}
[0m00:15:10.879442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a67ff00>]}
[0m00:15:10.879838 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:10.924644 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:10.925002 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:15:10.925145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a735350>]}
[0m00:15:11.435517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14adce210>]}
[0m00:15:11.469477 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:11.470585 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:11.479109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ae8eeb0>]}
[0m00:15:11.479310 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:11.479436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b507380>]}
[0m00:15:11.480168 [info ] [MainThread]: 
[0m00:15:11.480299 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:11.480393 [info ] [MainThread]: 
[0m00:15:11.480572 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:11.482069 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:15:11.533380 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:11.533562 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:11.533662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:12.242499 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.709 seconds
[0m00:15:12.245667 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:12.249478 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:12.249903 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:12.528401 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.278 seconds
[0m00:15:12.531919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4b9fd0>]}
[0m00:15:12.536502 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m00:15:12.537949 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m00:15:12.538367 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m00:15:12.546176 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m00:15:12.547601 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m00:15:12.547919 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m00:15:12.548340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m00:15:12.548747 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m00:15:12.551365 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m00:15:12.552106 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m00:15:12.552421 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m00:15:12.552748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m00:15:12.553021 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m00:15:12.558428 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m00:15:12.558842 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m00:15:12.559051 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.559264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m00:15:12.559450 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561281 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561623 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561823 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m00:15:12.562026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m00:15:12.562208 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m00:15:12.585885 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m00:15:12.586354 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m00:15:12.586613 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m00:15:12.586933 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.587086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:15:12.587257 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.591949 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:12.592273 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.592516 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.592657 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.592806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m00:15:12.592934 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594319 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:12.594562 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594770 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594895 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.595024 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m00:15:12.595140 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.597333 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:12.597556 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.597765 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.598160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:12.598275 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m00:15:12.598381 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m00:15:12.790398 [debug] [MainThread]: Command end result
[0m00:15:12.810601 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:12.811987 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:12.816226 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:12.820490 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.5846174, "process_in_blocks": "0", "process_kernel_time": 1.145698, "process_mem_max_rss": "239173632", "process_out_blocks": "0", "process_user_time": 3.065501}
[0m00:15:12.820782 [debug] [MainThread]: Command `dbt compile` succeeded at 00:15:12.820721 after 2.58 seconds
[0m00:15:12.821014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb58260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf2490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf2350>]}
[0m00:15:12.821218 [debug] [MainThread]: Flushing usage events
[0m00:15:13.182547 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:30.864521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152fc50>]}


============================== 00:15:30.866699 | 759980d6-dbd3-42ec-8225-85c24559ece6 ==============================
[0m00:15:30.866699 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:30.866940 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'debug': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_colors': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'version_check': 'True', 'target_path': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_format': 'default', 'static_parser': 'True', 'log_cache_events': 'False', 'no_print': 'None'}
[0m00:15:31.327567 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:31.327783 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:31.327890 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:31.399841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104bdf30>]}
[0m00:15:31.419749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13727ff00>]}
[0m00:15:31.420149 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:31.465727 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:31.531739 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:31.531932 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:31.552066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137335450>]}
[0m00:15:31.586536 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:31.587418 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:31.596102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13734d310>]}
[0m00:15:31.596273 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:31.596403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137393150>]}
[0m00:15:31.597083 [info ] [MainThread]: 
[0m00:15:31.597214 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:31.597313 [info ] [MainThread]: 
[0m00:15:31.597492 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:31.597804 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m00:15:31.621271 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m00:15:31.621453 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m00:15:31.621550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:32.162350 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.541 seconds
[0m00:15:32.170400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:32.183324 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:32.183698 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:32.395106 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.207 seconds
[0m00:15:32.397249 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m00:15:32.400143 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:32.400495 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:32.563761 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.163 seconds
[0m00:15:32.567156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144939570>]}
[0m00:15:32.571628 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m00:15:32.572233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m00:15:32.572606 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m00:15:32.584138 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m00:15:32.585373 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m00:15:32.585701 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m00:15:32.586017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m00:15:32.586411 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m00:15:32.589320 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m00:15:32.590099 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m00:15:32.590700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m00:15:32.591200 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m00:15:32.591539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m00:15:32.591757 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m00:15:32.619353 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m00:15:32.620208 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m00:15:32.634153 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m00:15:32.636176 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m00:15:32.636483 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → exactly one row per date
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    LEFT JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m00:15:34.968180 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.331 seconds
[0m00:15:34.993980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14494f1d0>]}
[0m00:15:34.994606 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.40s]
[0m00:15:34.995016 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m00:15:34.996160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:34.996449 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m00:15:34.996679 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m00:15:35.107243 [info ] [MainThread]: 
[0m00:15:35.107959 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.51 seconds (3.51s).
[0m00:15:35.108735 [debug] [MainThread]: Command end result
[0m00:15:35.128942 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:35.130161 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:35.133478 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:35.133657 [info ] [MainThread]: 
[0m00:15:35.133863 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:15:35.134010 [info ] [MainThread]: 
[0m00:15:35.134180 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:15:35.137759 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.300075, "process_in_blocks": "0", "process_kernel_time": 1.134432, "process_mem_max_rss": "232587264", "process_out_blocks": "0", "process_user_time": 2.705874}
[0m00:15:35.138004 [debug] [MainThread]: Command `dbt run` succeeded at 00:15:35.137955 after 4.30 seconds
[0m00:15:35.138198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144bed180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137526df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1170165d0>]}
[0m00:15:35.138380 [debug] [MainThread]: Flushing usage events
[0m00:15:35.498077 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:54.214541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e26900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092879d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109287c50>]}


============================== 00:15:54.216679 | 1f3f0664-87cf-43a1-ad5b-ceaccd015f14 ==============================
[0m00:15:54.216679 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:54.216912 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error': 'None', 'version_check': 'True', 'target_path': 'None', 'fail_fast': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'printer_width': '80', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False'}
[0m00:15:54.680302 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:54.680510 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:54.680616 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:54.756653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108619f30>]}
[0m00:15:54.776109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ce7ff00>]}
[0m00:15:54.776659 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:54.823428 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:54.889124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:54.889334 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:54.911225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d036150>]}
[0m00:15:54.949326 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:54.950332 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:54.963235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13da423f0>]}
[0m00:15:54.963439 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:54.963572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13daae0b0>]}
[0m00:15:54.964268 [info ] [MainThread]: 
[0m00:15:54.964399 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:54.964494 [info ] [MainThread]: 
[0m00:15:54.964673 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:54.966211 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:15:54.993602 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:54.993788 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:54.993900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:55.591515 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.597 seconds
[0m00:15:55.595103 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:55.598755 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:55.599169 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:55.752672 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.153 seconds
[0m00:15:55.756271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e80db20>]}
[0m00:15:55.759266 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.759693 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m00:15:55.760102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:15:55.760412 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.773503 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.774288 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.787659 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.788434 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.788658 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m00:15:56.121259 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.332 seconds
[0m00:15:56.132996 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.37s]
[0m00:15:56.133739 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:56.134126 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.134604 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m00:15:56.135163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m00:15:56.135502 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.138913 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.139686 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.142121 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.142947 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.143203 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m00:15:56.667121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.523 seconds
[0m00:15:56.670140 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.53s]
[0m00:15:56.670845 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.671258 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.671718 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m00:15:56.672228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m00:15:56.672593 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.679458 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.680340 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.682928 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.683743 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.683878 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m00:15:56.970656 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.286 seconds
[0m00:15:56.974013 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.30s]
[0m00:15:56.974700 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.976425 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:56.976823 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m00:15:56.977122 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m00:15:57.123971 [info ] [MainThread]: 
[0m00:15:57.124974 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m00:15:57.126251 [debug] [MainThread]: Command end result
[0m00:15:57.149754 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:57.151469 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:57.156404 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:57.156625 [info ] [MainThread]: 
[0m00:15:57.156874 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:15:57.157048 [info ] [MainThread]: 
[0m00:15:57.157237 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:15:57.162129 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.9714067, "process_in_blocks": "0", "process_kernel_time": 1.571596, "process_mem_max_rss": "234209280", "process_out_blocks": "0", "process_user_time": 2.248268}
[0m00:15:57.162397 [debug] [MainThread]: Command `dbt test` succeeded at 00:15:57.162344 after 2.97 seconds
[0m00:15:57.162627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10924c950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb275f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb27540>]}
[0m00:15:57.162825 [debug] [MainThread]: Flushing usage events
[0m00:15:57.523580 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:42.899526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10611e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075839d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107583c50>]}


============================== 01:17:42.902102 | 3d3c8c27-17f9-4e4b-b558-3a95274f5d21 ==============================
[0m01:17:42.902102 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m01:17:42.902366 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'empty': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'warn_error': 'None', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'fail_fast': 'False', 'no_print': 'None', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt run'}
[0m01:17:43.600664 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:17:43.600923 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:17:43.601047 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:17:43.724675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106911f30>]}
[0m01:17:43.745643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131b7ff00>]}
[0m01:17:43.746270 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m01:17:43.798941 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m01:17:43.873470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:17:43.873797 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/output/fct_btc_indicators.sql
[0m01:17:44.028819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1333d1450>]}
[0m01:17:44.063682 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:44.065515 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:44.076011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131e4d310>]}
[0m01:17:44.076248 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m01:17:44.076388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133420910>]}
[0m01:17:44.077154 [info ] [MainThread]: 
[0m01:17:44.077306 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:17:44.077407 [info ] [MainThread]: 
[0m01:17:44.077596 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:17:44.077928 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:17:44.130139 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:17:44.130350 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m01:17:44.130470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:44.644899 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.514 seconds
[0m01:17:44.652694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m01:17:44.668563 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:17:44.668909 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m01:17:44.912176 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.243 seconds
[0m01:17:44.915903 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:17:44.919136 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:17:44.919507 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m01:17:45.094356 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.174 seconds
[0m01:17:45.097075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133b5c6d0>]}
[0m01:17:45.101280 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m01:17:45.101723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m01:17:45.102011 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m01:17:45.109805 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m01:17:45.111346 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m01:17:45.111771 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m01:17:45.112212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m01:17:45.112579 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m01:17:45.115262 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m01:17:45.116093 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m01:17:45.116700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m01:17:45.117105 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m01:17:45.117411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m01:17:45.117655 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m01:17:45.146158 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m01:17:45.146720 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m01:17:45.161088 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m01:17:45.163427 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m01:17:45.163698 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m01:17:47.385674 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.221 seconds
[0m01:17:47.412792 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13406c290>]}
[0m01:17:47.413399 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.29s]
[0m01:17:47.413818 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m01:17:47.414800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:17:47.415094 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m01:17:47.415315 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m01:17:47.540160 [info ] [MainThread]: 
[0m01:17:47.540572 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.46 seconds (3.46s).
[0m01:17:47.541081 [debug] [MainThread]: Command end result
[0m01:17:47.556272 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:47.557448 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:47.561200 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m01:17:47.561376 [info ] [MainThread]: 
[0m01:17:47.561566 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:17:47.561703 [info ] [MainThread]: 
[0m01:17:47.561858 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m01:17:47.565668 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6966414, "process_in_blocks": "0", "process_kernel_time": 2.063432, "process_mem_max_rss": "231653376", "process_out_blocks": "0", "process_user_time": 1.878705}
[0m01:17:47.565866 [debug] [MainThread]: Command `dbt run` succeeded at 01:17:47.565824 after 4.70 seconds
[0m01:17:47.566049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f56830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13400f070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13400c0f0>]}
[0m01:17:47.566212 [debug] [MainThread]: Flushing usage events
[0m01:17:47.941375 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:54.452814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f8e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124339d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112433c50>]}


============================== 01:17:54.454460 | dcbe13ed-514d-4f94-ab1c-cd723e1462ea ==============================
[0m01:17:54.454460 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m01:17:54.454705 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'printer_width': '80', 'log_format': 'default', 'debug': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'invocation_command': 'dbt test', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'target_path': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m01:17:54.922020 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:17:54.922236 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:17:54.922347 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:17:54.992372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113bdf30>]}
[0m01:17:55.012029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13657ff00>]}
[0m01:17:55.012597 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m01:17:55.059342 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m01:17:55.124616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:17:55.124772 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:17:55.145225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136736150>]}
[0m01:17:55.177768 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:55.178474 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:55.191261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a463f0>]}
[0m01:17:55.191474 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m01:17:55.191606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146aae0b0>]}
[0m01:17:55.192312 [info ] [MainThread]: 
[0m01:17:55.192447 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:17:55.192546 [info ] [MainThread]: 
[0m01:17:55.192736 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:17:55.194290 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m01:17:55.220739 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:17:55.220933 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m01:17:55.221037 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:55.859754 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.638 seconds
[0m01:17:55.863359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:17:55.867032 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:17:55.867420 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m01:17:56.007701 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.140 seconds
[0m01:17:56.012444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f09b20>]}
[0m01:17:56.016654 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.017174 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m01:17:56.017652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m01:17:56.017994 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.034293 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.035354 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.049400 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.050256 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.050474 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m01:17:56.679642 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.629 seconds
[0m01:17:56.691619 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.67s]
[0m01:17:56.692327 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.692728 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.693164 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m01:17:56.693622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m01:17:56.693949 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.698529 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.699594 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.702368 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.703251 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.703737 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m01:17:56.970361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.266 seconds
[0m01:17:56.973886 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.28s]
[0m01:17:56.974657 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.975111 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.975683 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m01:17:56.976300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m01:17:56.976744 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.984621 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.986023 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.990795 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.991939 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.992253 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m01:17:57.197156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.204 seconds
[0m01:17:57.200731 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.22s]
[0m01:17:57.201541 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:57.203066 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:17:57.203473 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m01:17:57.203814 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m01:17:57.986486 [info ] [MainThread]: 
[0m01:17:57.987619 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 2.79 seconds (2.79s).
[0m01:17:57.989016 [debug] [MainThread]: Command end result
[0m01:17:58.014582 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:58.016418 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:58.021837 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m01:17:58.022117 [info ] [MainThread]: 
[0m01:17:58.022400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:17:58.022590 [info ] [MainThread]: 
[0m01:17:58.022815 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m01:17:58.029722 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5999541, "process_in_blocks": "0", "process_kernel_time": 1.156772, "process_mem_max_rss": "233865216", "process_out_blocks": "0", "process_user_time": 2.681446}
[0m01:17:58.030085 [debug] [MainThread]: Command `dbt test` succeeded at 01:17:58.030016 after 3.60 seconds
[0m01:17:58.030422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123f0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479235f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147923540>]}
[0m01:17:58.030696 [debug] [MainThread]: Flushing usage events
[0m01:17:58.399945 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:52.808626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e13d0>]}


============================== 22:09:52.811235 | 2281c320-7d32-4335-b301-642812f7a0e6 ==============================
[0m22:09:52.811235 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:09:52.811521 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'target_path': 'None', 'no_print': 'None', 'invocation_command': 'dbt ', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error': 'None', 'indirect_selection': 'eager', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m22:09:52.864650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2281c320-7d32-4335-b301-642812f7a0e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115bc5e0>]}
[0m22:09:52.870376 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:09:52.870785 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:09:52.872262 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.10019721, "process_in_blocks": "0", "process_kernel_time": 0.058007, "process_mem_max_rss": "100237312", "process_out_blocks": "0", "process_user_time": 0.591329}
[0m22:09:52.872479 [debug] [MainThread]: Command `cli deps` succeeded at 22:09:52.872431 after 0.10 seconds
[0m22:09:52.872647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111833790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a86dc0>]}
[0m22:09:52.872820 [debug] [MainThread]: Flushing usage events
[0m22:09:53.272150 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:45:54.344311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1d9ca70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3a24cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb29dd160>]}


============================== 06:45:54.347266 | 79e5be18-aacf-43de-9c3c-f45767e7f785 ==============================
[0m06:45:54.347266 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:45:54.347596 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:45:54.397313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79e5be18-aacf-43de-9c3c-f45767e7f785', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1af7b30>]}
[0m06:45:54.397713 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:45:54.398817 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:45:54.399295 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.07549, "process_user_time": 1.045017, "process_kernel_time": 0.093001, "process_mem_max_rss": "107216", "process_out_blocks": "1339", "process_in_blocks": "0"}
[0m06:45:54.399533 [debug] [MainThread]: Command `dbt deps` succeeded at 06:45:54.399472 after 0.08 seconds
[0m06:45:54.399718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1df7b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1df4710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1d5af30>]}
[0m06:45:54.399888 [debug] [MainThread]: Flushing usage events
[0m06:46:20.854856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4161ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2e1b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2e1b530>]}


============================== 06:46:20.862170 | 03509dfe-c700-44cf-9bcb-b84a4c763336 ==============================
[0m06:46:20.862170 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:46:20.862711 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt ls -s stg_btc_market stg_btc_ohlc', 'send_anonymous_usage_stats': 'True'}
[0m06:46:20.864466 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'btc_elt'
[0m06:46:20.865152 [debug] [MainThread]: Resource report: {"command_name": "list", "command_wall_clock_time": 0.038131375, "process_user_time": 0.982625, "process_kernel_time": 0.109069, "process_mem_max_rss": "106136", "process_out_blocks": "2", "command_success": false, "process_in_blocks": "0"}
[0m06:46:20.865422 [debug] [MainThread]: Command `dbt ls` failed at 06:46:20.865351 after 0.04 seconds
[0m06:46:20.865639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3356d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb394d880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2cc6ff0>]}
[0m06:46:20.866078 [debug] [MainThread]: Flushing usage events
[0m06:48:06.619355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb81e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8de8da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8cdcbf0>]}


============================== 06:48:06.623889 | 9c290639-b7f4-42cb-a11f-ac33e399dc26 ==============================
[0m06:48:06.623889 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:48:06.624336 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:48:06.624891 [info ] [MainThread]: dbt version: 1.7.19
[0m06:48:06.625098 [info ] [MainThread]: python version: 3.12.5
[0m06:48:06.625288 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:48:06.625473 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:48:06.625807 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m06:48:06.625968 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m06:48:06.626116 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m06:48:06.667542 [info ] [MainThread]: Configuration:
[0m06:48:06.667899 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m06:48:06.668134 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m06:48:06.668361 [info ] [MainThread]: Required dependencies:
[0m06:48:06.668617 [debug] [MainThread]: Executing "git --help"
[0m06:48:06.669188 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m06:48:06.669409 [info ] [MainThread]: Connection test skipped since no profile was found
[0m06:48:06.669647 [info ] [MainThread]: [31m2 checks failed:[0m
[0m06:48:06.669915 [info ] [MainThread]: dbt looked for a profiles.yml file in /opt/airflow/dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m06:48:06.670120 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m06:48:06.670647 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.077999584, "process_user_time": 1.083041, "process_kernel_time": 0.085397, "process_mem_max_rss": "106772", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m06:48:06.670900 [debug] [MainThread]: Command `dbt debug` failed at 06:48:06.670843 after 0.08 seconds
[0m06:48:06.671090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8c9ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8c9b530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb81e7b0>]}
[0m06:48:06.671275 [debug] [MainThread]: Flushing usage events
[0m06:50:22.772738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c1a47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c606900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c606d20>]}


============================== 06:50:22.776174 | 01f699aa-bedb-42ec-972d-8e9e3976bba2 ==============================
[0m06:50:22.776174 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:50:22.776560 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m06:50:22.776841 [info ] [MainThread]: dbt version: 1.7.19
[0m06:50:22.777008 [info ] [MainThread]: python version: 3.12.5
[0m06:50:22.777236 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:50:22.777451 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:50:22.780207 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m06:50:22.780711 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.031558376, "process_user_time": 0.958144, "process_kernel_time": 0.079845, "process_mem_max_rss": "106640", "process_out_blocks": "19", "command_success": false, "process_in_blocks": "0"}
[0m06:50:22.780977 [debug] [MainThread]: Command `dbt debug` failed at 06:50:22.780919 after 0.03 seconds
[0m06:50:22.781140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c1a3170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cee4560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c15e780>]}
[0m06:50:22.781291 [debug] [MainThread]: Flushing usage events
[0m06:53:02.754341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bd130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bc890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bc290>]}


============================== 06:53:02.757641 | 46260245-9459-4e17-8a69-aecb76fc4e3c ==============================
[0m06:53:02.757641 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:53:02.757986 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:53:02.758274 [info ] [MainThread]: dbt version: 1.7.19
[0m06:53:02.758482 [info ] [MainThread]: python version: 3.12.5
[0m06:53:02.758724 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:53:02.758947 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:53:03.074019 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m06:53:03.074329 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m06:53:03.074645 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m06:53:03.074971 [info ] [MainThread]: adapter type: snowflake
[0m06:53:03.075194 [info ] [MainThread]: adapter version: 1.7.0
[0m06:53:03.111769 [info ] [MainThread]: Configuration:
[0m06:53:03.111998 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m06:53:03.112258 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m06:53:03.112500 [info ] [MainThread]: Required dependencies:
[0m06:53:03.112722 [debug] [MainThread]: Executing "git --help"
[0m06:53:03.113216 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m06:53:03.113456 [info ] [MainThread]: Connection:
[0m06:53:03.113695 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m06:53:03.113916 [info ] [MainThread]:   user: PEACOCK
[0m06:53:03.114115 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m06:53:03.114362 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m06:53:03.114550 [info ] [MainThread]:   role: TRAINING_ROLE
[0m06:53:03.114781 [info ] [MainThread]:   schema: analytics
[0m06:53:03.115005 [info ] [MainThread]:   authenticator: None
[0m06:53:03.115218 [info ] [MainThread]:   private_key_path: None
[0m06:53:03.115428 [info ] [MainThread]:   token: None
[0m06:53:03.115624 [info ] [MainThread]:   oauth_client_id: None
[0m06:53:03.115820 [info ] [MainThread]:   query_tag: None
[0m06:53:03.116035 [info ] [MainThread]:   client_session_keep_alive: False
[0m06:53:03.116226 [info ] [MainThread]:   host: None
[0m06:53:03.116460 [info ] [MainThread]:   port: None
[0m06:53:03.116664 [info ] [MainThread]:   proxy_host: None
[0m06:53:03.116863 [info ] [MainThread]:   proxy_port: None
[0m06:53:03.117043 [info ] [MainThread]:   protocol: None
[0m06:53:03.117233 [info ] [MainThread]:   connect_retries: 1
[0m06:53:03.117430 [info ] [MainThread]:   connect_timeout: None
[0m06:53:03.117661 [info ] [MainThread]:   retry_on_database_errors: False
[0m06:53:03.117875 [info ] [MainThread]:   retry_all: False
[0m06:53:03.118071 [info ] [MainThread]:   insecure_mode: False
[0m06:53:03.118264 [info ] [MainThread]:   reuse_connections: None
[0m06:53:03.118530 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:53:03.118852 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m06:53:03.119132 [debug] [MainThread]: Using snowflake connection "debug"
[0m06:53:03.119279 [debug] [MainThread]: On debug: select 1 as id
[0m06:53:03.119434 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:53:03.618782 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:53:03.619384 [debug] [MainThread]: On debug: Close
[0m06:53:03.749578 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m06:53:03.749871 [info ] [MainThread]: [31m1 check failed:[0m
[0m06:53:03.750132 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m06:53:03.750673 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.0171638, "process_user_time": 2.159201, "process_kernel_time": 0.121384, "process_mem_max_rss": "205944", "process_out_blocks": "121", "command_success": false, "process_in_blocks": "0"}
[0m06:53:03.750909 [debug] [MainThread]: Command `dbt debug` failed at 06:53:03.750855 after 1.02 seconds
[0m06:53:03.751072 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m06:53:03.751233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78d47530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff994605f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff795ba8a0>]}
[0m06:53:03.751419 [debug] [MainThread]: Flushing usage events
[0m06:53:47.506771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa23dfd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa272b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c9d1f0>]}


============================== 06:53:47.509936 | 8413d120-8f4e-4d32-9acc-bf1fca687390 ==============================
[0m06:53:47.509936 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:53:47.510279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:53:47.889790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81433dd0>]}
[0m06:53:47.920315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91597d70>]}
[0m06:53:47.920678 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:53:47.924137 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:53:47.930753 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m06:53:47.931039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80ec7380>]}
[0m06:53:48.297412 [error] [MainThread]: Encountered an error:
Parsing Error
  at path ['unique_key']: ['coin_id', 'timestamp'] is not valid under any of the given schemas
[0m06:53:48.298095 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8117203, "process_user_time": 2.477201, "process_kernel_time": 0.175003, "process_mem_max_rss": "210004", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m06:53:48.298366 [debug] [MainThread]: Command `dbt run` failed at 06:53:48.298300 after 0.81 seconds
[0m06:53:48.298588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c9d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fd47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fd4800>]}
[0m06:53:48.298816 [debug] [MainThread]: Flushing usage events
[0m07:22:10.180610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d51a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff869402c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8615a180>]}


============================== 07:22:10.183932 | ca30c85e-4ac7-4f89-bda7-b6c51d4853ce ==============================
[0m07:22:10.183932 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:22:10.184240 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt parse', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:22:10.560983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d4e9c0>]}
[0m07:22:10.592514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64efbf20>]}
[0m07:22:10.592928 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:22:10.596469 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:22:10.602349 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m07:22:10.602596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff650345c0>]}
[0m07:22:11.120658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff643a8e90>]}
[0m07:22:11.121517 [info ] [MainThread]: Performance info: /opt/airflow/dbt/btc_elt/target/perf_info.json
[0m07:22:11.126011 [debug] [MainThread]: Resource report: {"command_name": "parse", "command_success": true, "command_wall_clock_time": 0.96761096, "process_user_time": 2.630774, "process_kernel_time": 0.12123, "process_mem_max_rss": "217268", "process_out_blocks": "1741", "process_in_blocks": "0"}
[0m07:22:11.126280 [debug] [MainThread]: Command `dbt parse` succeeded at 07:22:11.126222 after 0.97 seconds
[0m07:22:11.126457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d8f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff650aab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64658560>]}
[0m07:22:11.126621 [debug] [MainThread]: Flushing usage events
[0m07:23:47.883180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d06150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8b52180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb80ecfb0>]}


============================== 07:23:47.887148 | 338fa384-2c68-4b85-af1c-af5a1f9a869e ==============================
[0m07:23:47.887148 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:23:47.887643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt parse', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:23:48.329277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92b36780>]}
[0m07:23:48.360799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8049b50>]}
[0m07:23:48.361262 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:23:48.365386 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:23:48.380085 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:23:48.380352 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:23:48.382749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9396a030>]}
[0m07:23:48.383439 [info ] [MainThread]: Performance info: /opt/airflow/dbt/btc_elt/target/perf_info.json
[0m07:23:48.388122 [debug] [MainThread]: Resource report: {"command_name": "parse", "command_success": true, "command_wall_clock_time": 0.53204143, "process_user_time": 2.320016, "process_kernel_time": 0.189725, "process_mem_max_rss": "204524", "process_out_blocks": "866", "process_in_blocks": "0"}
[0m07:23:48.388411 [debug] [MainThread]: Command `dbt parse` succeeded at 07:23:48.388346 after 0.53 seconds
[0m07:23:48.388606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d018b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9300b5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d9c260>]}
[0m07:23:48.388793 [debug] [MainThread]: Flushing usage events
[0m07:24:00.044260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa6139e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac5d520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa610410>]}


============================== 07:24:00.047124 | ce0d95b2-93d7-401b-a541-1dc993c7087b ==============================
[0m07:24:00.047124 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:24:00.047466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:24:00.395356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff898bf170>]}
[0m07:24:00.424468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8acb2b10>]}
[0m07:24:00.424813 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:24:00.427893 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:24:00.439666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:24:00.439865 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:24:00.442056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8915d6d0>]}
[0m07:24:00.447191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89115310>]}
[0m07:24:00.447417 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:24:00.447613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89114f20>]}
[0m07:24:00.448416 [info ] [MainThread]: 
[0m07:24:00.448827 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:24:00.449430 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:24:00.454509 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:24:00.454692 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:24:00.454825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:01.081157 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:24:01.084388 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:24:01.727177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:24:01.733842 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:24:01.734244 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:24:01.734650 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:02.345072 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:24:02.348335 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:24:02.547105 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:24:02.552004 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:24:02.552678 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:24:02.553731 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:24:03.050965 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:24:03.054890 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:24:03.218357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8873dd60>]}
[0m07:24:03.219078 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:24:03.219536 [info ] [MainThread]: 
[0m07:24:03.225159 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:24:03.225554 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:24:03.226076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:24:03.226373 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:24:03.230793 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:24:03.226541 => 07:24:03.230661
[0m07:24:03.231031 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:24:03.252215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:24:03.252461 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:24:03.252661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:24:03.811358 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 1.0 seconds
[0m07:24:03.846877 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:24:03.847356 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:24:04.049072 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e7c-0307-19fd-000f-c0df008a114a
[0m07:24:04.050073 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:24:04.051055 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:24:03.231187 => 07:24:04.050716
[0m07:24:04.051746 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:24:04.430723 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:04.432058 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885f4920>]}
[0m07:24:04.433439 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.21s]
[0m07:24:04.434503 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:24:04.435132 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.436767 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:24:04.437747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:24:04.438262 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.441947 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:24:04.438584 => 07:24:04.441739
[0m07:24:04.442332 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.446321 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:24:04.446641 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:24:04.446949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:24:04.966923 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m07:24:04.977178 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:24:04.977999 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:24:05.307376 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e7c-0307-19b7-000f-c0df0089d66a
[0m07:24:05.308578 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:24:05.309750 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:24:04.442580 => 07:24:05.309410
[0m07:24:05.310532 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:24:05.467665 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.469064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa49cef90>]}
[0m07:24:05.470520 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.03s]
[0m07:24:05.471464 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:05.474751 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:24:05.475340 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:24:05.475948 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:24:05.476666 [info ] [MainThread]: 
[0m07:24:05.477394 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 5.03 seconds (5.03s).
[0m07:24:05.478718 [debug] [MainThread]: Command end result
[0m07:24:05.489786 [info ] [MainThread]: 
[0m07:24:05.490451 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:24:05.490824 [info ] [MainThread]: 
[0m07:24:05.491241 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.491693 [info ] [MainThread]: 
[0m07:24:05.492040 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.492358 [info ] [MainThread]: 
[0m07:24:05.492790 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:24:05.494004 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.4777417, "process_user_time": 2.540753, "process_kernel_time": 0.135253, "process_mem_max_rss": "215232", "process_out_blocks": "1803", "command_success": false, "process_in_blocks": "0"}
[0m07:24:05.494580 [debug] [MainThread]: Command `dbt snapshot` failed at 07:24:05.494473 after 5.48 seconds
[0m07:24:05.494976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa613650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa5ca2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff893777a0>]}
[0m07:24:05.495346 [debug] [MainThread]: Flushing usage events
[0m07:24:10.045849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c68470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5caa150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5cabcb0>]}


============================== 07:24:10.048548 | 8272badb-ecc8-4abc-b8a6-c081da5f51fe ==============================
[0m07:24:10.048548 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:24:10.048883 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run -s stg_* fct_*', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:24:10.402933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84a9ede0>]}
[0m07:24:10.432653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d71a00>]}
[0m07:24:10.433004 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:24:10.436183 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:24:10.448735 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:24:10.448901 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:24:10.451066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92de3110>]}
[0m07:24:10.455714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8483d2b0>]}
[0m07:24:10.455922 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:24:10.456185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8496da60>]}
[0m07:24:10.456601 [warn ] [MainThread]: The selection criterion 'stg_*' does not match any nodes
[0m07:24:10.456862 [warn ] [MainThread]: The selection criterion 'fct_*' does not match any nodes
[0m07:24:10.457394 [info ] [MainThread]: 
[0m07:24:10.457589 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m07:24:10.457921 [debug] [MainThread]: Command end result
[0m07:24:10.461203 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.43612117, "process_user_time": 2.092118, "process_kernel_time": 0.107645, "process_mem_max_rss": "204944", "process_out_blocks": "1762", "process_in_blocks": "0"}
[0m07:24:10.461434 [debug] [MainThread]: Command `dbt run` succeeded at 07:24:10.461383 after 0.44 seconds
[0m07:24:10.461618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa61251f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5b642c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c692e0>]}
[0m07:24:10.461778 [debug] [MainThread]: Flushing usage events
[0m07:26:01.783407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb277f7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b690d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2ac5b50>]}


============================== 07:26:01.786418 | 229b622a-da63-4246-bf1d-42e8b9a4e8de ==============================
[0m07:26:01.786418 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:26:01.786816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt ls --resource-type model', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:26:02.153491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91612ff0>]}
[0m07:26:02.184202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97866e10>]}
[0m07:26:02.184548 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:26:02.188479 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:26:02.192985 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m07:26:02.193257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91830e90>]}
[0m07:26:02.732623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90509940>]}
[0m07:26:02.737732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90508740>]}
[0m07:26:02.737977 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:26:02.738206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d36e40>]}
[0m07:26:02.739080 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.9780157, "process_user_time": 2.697954, "process_kernel_time": 0.154767, "process_mem_max_rss": "216388", "process_out_blocks": "1769", "process_in_blocks": "0"}
[0m07:26:02.739336 [debug] [MainThread]: Command `dbt ls` succeeded at 07:26:02.739275 after 0.98 seconds
[0m07:26:02.739522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb273a330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b690d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff914e07a0>]}
[0m07:26:02.739684 [debug] [MainThread]: Flushing usage events
[0m07:26:52.836546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eabf710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eea5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee086e0>]}


============================== 07:26:52.839446 | 15a7952e-682a-467c-b92e-7b2fe101fc75 ==============================
[0m07:26:52.839446 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:26:52.839782 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -s +fct_btc_indicators', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:26:53.238203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d9431a0>]}
[0m07:26:53.269439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e1e2d80>]}
[0m07:26:53.269783 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:26:53.273881 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:26:53.286956 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:26:53.287134 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:26:53.289431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d99c620>]}
[0m07:26:53.295035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d6e0dd0>]}
[0m07:26:53.295239 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:26:53.295439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d9cb7a0>]}
[0m07:26:53.296333 [info ] [MainThread]: 
[0m07:26:53.296734 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:26:53.297275 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:26:53.302595 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:26:53.302760 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:26:53.302911 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:26:53.844511 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:26:53.847827 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:26:53.992447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:26:54.001407 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:26:54.002129 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:26:54.002624 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:26:54.509946 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:26:54.512262 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:26:54.657706 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:26:54.661953 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:26:54.662533 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:26:54.663493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:26:55.212571 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:26:55.219593 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:26:55.355093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d678e30>]}
[0m07:26:55.355707 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:26:55.356011 [info ] [MainThread]: 
[0m07:26:55.360972 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:26:55.361422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m07:26:55.361660 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:26:55.366063 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:26:55.367361 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:26:55.361844 => 07:26:55.367207
[0m07:26:55.368081 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:26:55.368366 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:26:55.368990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:26:55.369234 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:26:55.371137 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:26:55.371757 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:26:55.369405 => 07:26:55.371657
[0m07:26:55.372229 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:26:55.372700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:26:55.373017 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:26:55.373578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:26:55.373767 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:26:55.394536 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:26:55.395574 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:26:55.373919 => 07:26:55.395460
[0m07:26:55.395807 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:26:55.409182 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:26:55.411814 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:26:55.412131 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m07:26:55.412461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:26:57.854353 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:26:57.878532 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:26:55.395946 => 07:26:57.878257
[0m07:26:57.879105 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:26:58.029694 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d5bc380>]}
[0m07:26:58.031252 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.66s]
[0m07:26:58.032647 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:26:58.035884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:26:58.036493 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:26:58.037000 [info ] [MainThread]: 
[0m07:26:58.037549 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.74 seconds (4.74s).
[0m07:26:58.038829 [debug] [MainThread]: Command end result
[0m07:26:58.053359 [info ] [MainThread]: 
[0m07:26:58.053957 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:26:58.054471 [info ] [MainThread]: 
[0m07:26:58.054973 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:26:58.056168 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.2412987, "process_user_time": 2.420644, "process_kernel_time": 0.237714, "process_mem_max_rss": "212900", "process_out_blocks": "1851", "process_in_blocks": "0"}
[0m07:26:58.056710 [debug] [MainThread]: Command `dbt run` succeeded at 07:26:58.056594 after 5.24 seconds
[0m07:26:58.057152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ef79280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eabbf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ea76d50>]}
[0m07:26:58.057504 [debug] [MainThread]: Flushing usage events
[0m07:28:21.496563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb621d970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb626e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb626d220>]}


============================== 07:28:21.499543 | a378f3d9-60d5-4602-82f8-0c9effb84194 ==============================
[0m07:28:21.499543 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:28:21.499854 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test -s fct_btc_indicators', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:28:21.916463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95045520>]}
[0m07:28:21.947812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955b45c0>]}
[0m07:28:21.948166 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:28:21.952096 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:28:21.965122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:28:21.965302 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:28:21.967585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94f63170>]}
[0m07:28:21.973302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94e14b30>]}
[0m07:28:21.973522 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:28:21.973724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff950d5280>]}
[0m07:28:21.974407 [info ] [MainThread]: 
[0m07:28:21.974834 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:28:21.975464 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:28:21.981295 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:28:21.981485 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:28:21.981656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:28:22.574602 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:28:22.578075 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:28:22.752326 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:28:22.758129 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:28:22.758813 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:28:22.759353 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:28:23.198831 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:28:23.202725 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:28:23.360850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94d7e8a0>]}
[0m07:28:23.362356 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:28:23.363017 [info ] [MainThread]: 
[0m07:28:23.374937 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.375733 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:28:23.377013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:28:23.377587 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.391140 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.393625 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:28:23.377980 => 07:28:23.393284
[0m07:28:23.394465 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.412862 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.414259 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.414555 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:28:23.414848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:23.973504 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:23.985590 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:28:23.395111 => 07:28:23.985151
[0m07:28:23.986366 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:28:24.123311 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.75s]
[0m07:28:24.125088 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:24.126044 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.126792 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:28:24.128022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:28:24.128672 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.136263 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.139140 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:28:24.129139 => 07:28:24.138723
[0m07:28:24.139937 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.142916 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.144568 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.145291 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:28:24.145733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:24.802653 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:24.807062 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:28:24.140197 => 07:28:24.806668
[0m07:28:24.807805 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:28:24.964380 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.84s]
[0m07:28:24.965867 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.966651 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.967315 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:28:24.968519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:28:24.969206 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.982491 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.984599 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:28:24.969605 => 07:28:24.984125
[0m07:28:24.985191 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.988100 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.989524 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.989971 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:28:24.990323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:25.568394 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:25.572054 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:28:24.985500 => 07:28:25.571666
[0m07:28:25.572818 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:28:25.713842 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.75s]
[0m07:28:25.715357 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:25.718557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:28:25.719203 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:28:25.719830 [info ] [MainThread]: 
[0m07:28:25.720417 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m07:28:25.721863 [debug] [MainThread]: Command end result
[0m07:28:25.737562 [info ] [MainThread]: 
[0m07:28:25.738227 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:28:25.738819 [info ] [MainThread]: 
[0m07:28:25.739322 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:28:25.740571 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.2661686, "process_user_time": 2.53369, "process_kernel_time": 0.200975, "process_mem_max_rss": "212776", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m07:28:25.741201 [debug] [MainThread]: Command `dbt test` succeeded at 07:28:25.741073 after 4.27 seconds
[0m07:28:25.741606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6561d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6567e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955461b0>]}
[0m07:28:25.742003 [debug] [MainThread]: Flushing usage events
[0m07:29:05.932375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e7920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e74d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e6a20>]}


============================== 07:29:05.935584 | aac2b118-8676-419f-b4e2-1f3e66bb15c7 ==============================
[0m07:29:05.935584 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:29:05.935958 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:29:06.346816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e1e27b0>]}
[0m07:29:06.381778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee492e0>]}
[0m07:29:06.382263 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:29:06.386620 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:29:06.399941 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:29:06.400169 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:29:06.402560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e0ceed0>]}
[0m07:29:06.409858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e184800>]}
[0m07:29:06.410141 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:29:06.410388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb342c170>]}
[0m07:29:06.411269 [info ] [MainThread]: 
[0m07:29:06.411774 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:29:06.412427 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:29:06.417888 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:29:06.418081 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:29:06.418251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:06.882620 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:29:06.883573 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:29:06.991639 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:29:06.995389 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:29:06.995644 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:29:06.995833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:07.406648 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:29:07.409802 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:29:07.568206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:29:07.572976 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:29:07.573515 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:29:07.574448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:08.054472 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:29:08.056753 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:29:08.181263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df89cd0>]}
[0m07:29:08.182935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:29:08.183614 [info ] [MainThread]: 
[0m07:29:08.196789 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:29:08.197880 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:29:08.199138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:29:08.199692 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:29:08.207358 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:29:08.200061 => 07:29:08.207134
[0m07:29:08.207760 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:29:08.237466 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:29:08.237834 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:29:08.238093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:08.660887 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:29:08.683138 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:29:08.683599 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:29:08.932918 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e81-0307-1ab7-000f-c0df0089e50a
[0m07:29:08.935259 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:29:08.935641 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:29:08.208033 => 07:29:08.935521
[0m07:29:08.936346 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:29:09.063683 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.064260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb255b0>]}
[0m07:29:09.065004 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 0.87s]
[0m07:29:09.065774 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:29:09.066200 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.067078 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:29:09.067750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:29:09.068041 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.070585 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:29:09.068252 => 07:29:09.070430
[0m07:29:09.070874 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.073994 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:29:09.074275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:29:09.074528 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:09.461878 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:29:09.470674 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:29:09.471381 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:29:09.658277 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e81-0307-19b7-000f-c0df0089d752
[0m07:29:09.659391 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:29:09.660408 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:29:09.071072 => 07:29:09.660046
[0m07:29:09.661052 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:29:09.820239 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.821586 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb259a0>]}
[0m07:29:09.822917 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 0.75s]
[0m07:29:09.823923 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.826691 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:29:09.827229 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:29:09.827595 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:29:09.828016 [info ] [MainThread]: 
[0m07:29:09.828482 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 3.42 seconds (3.42s).
[0m07:29:09.829736 [debug] [MainThread]: Command end result
[0m07:29:09.841047 [info ] [MainThread]: 
[0m07:29:09.841574 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:29:09.842048 [info ] [MainThread]: 
[0m07:29:09.842546 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.842893 [info ] [MainThread]: 
[0m07:29:09.843284 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.843652 [info ] [MainThread]: 
[0m07:29:09.844106 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:29:09.845180 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.9430404, "process_user_time": 2.437832, "process_kernel_time": 0.197634, "process_mem_max_rss": "215260", "process_out_blocks": "1803", "command_success": false, "process_in_blocks": "0"}
[0m07:29:09.845679 [debug] [MainThread]: Command `dbt snapshot` failed at 07:29:09.845567 after 3.94 seconds
[0m07:29:09.846044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34c7a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e76e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb591ac60>]}
[0m07:29:09.846401 [debug] [MainThread]: Flushing usage events
[0m07:32:59.762152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2656990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2a11970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb347e240>]}


============================== 07:32:59.765287 | a724b5dc-49cc-42a7-a060-7185fcb0f4c0 ==============================
[0m07:32:59.765287 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:32:59.765709 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:33:00.156310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91589f10>]}
[0m07:33:00.188068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff917a1700>]}
[0m07:33:00.188510 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:33:00.192599 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:33:00.205213 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:33:00.205465 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:33:00.205636 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:33:00.285155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9101b2f0>]}
[0m07:33:00.290961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff910ae0c0>]}
[0m07:33:00.291174 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:33:00.291381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff910ac530>]}
[0m07:33:00.292271 [info ] [MainThread]: 
[0m07:33:00.292721 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:33:00.293351 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:33:00.299075 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:33:00.299269 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:33:00.299413 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:01.186487 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:33:01.190012 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:33:01.317532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:33:01.330897 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:33:01.331786 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:33:01.332262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:01.814610 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:33:01.815619 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:33:01.945321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:33:01.946806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:33:01.946994 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:33:01.947336 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:02.394088 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:33:02.396372 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:33:02.540499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9111a060>]}
[0m07:33:02.541685 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:33:02.542260 [info ] [MainThread]: 
[0m07:33:02.552530 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:33:02.553411 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:33:02.554179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:33:02.554451 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:33:02.558138 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:33:02.554621 => 07:33:02.558007
[0m07:33:02.558394 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:33:02.586681 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:02.587186 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:02.587470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:03.111197 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:03.122844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.123604 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:03.202165 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:03.216404 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.217322 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:03.339942 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:03.362450 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.362859 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:03.521577 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-18e5-000f-c0df00897cde
[0m07:33:03.522278 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:03.523101 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:33:02.558557 => 07:33:03.522777
[0m07:33:03.523689 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:33:03.665210 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:03.666182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9054cbc0>]}
[0m07:33:03.667405 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.11s]
[0m07:33:03.668603 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:33:03.669321 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.670720 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:33:03.671698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:33:03.672194 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.675904 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:33:03.672492 => 07:33:03.675744
[0m07:33:03.676184 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.678281 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:03.678511 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:03.678744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:04.247965 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:04.252613 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.253409 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:04.333857 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:04.335938 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.336179 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:04.426492 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:04.430628 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.431051 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:04.606149 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-1a0c-000f-c0df008a3182
[0m07:33:04.606944 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:04.607934 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:33:03.676331 => 07:33:04.607539
[0m07:33:04.608578 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:33:04.793428 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.794279 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90402600>]}
[0m07:33:04.795349 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.12s]
[0m07:33:04.796395 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:04.799152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:33:04.799582 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:33:04.800043 [info ] [MainThread]: 
[0m07:33:04.800553 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.51 seconds (4.51s).
[0m07:33:04.801655 [debug] [MainThread]: Command end result
[0m07:33:04.809813 [info ] [MainThread]: 
[0m07:33:04.810136 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:33:04.810416 [info ] [MainThread]: 
[0m07:33:04.810676 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.810892 [info ] [MainThread]: 
[0m07:33:04.811120 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.811341 [info ] [MainThread]: 
[0m07:33:04.811569 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:33:04.812396 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.0724964, "process_user_time": 2.669033, "process_kernel_time": 0.206932, "process_mem_max_rss": "218284", "process_out_blocks": "2693", "command_success": false, "process_in_blocks": "0"}
[0m07:33:04.812737 [debug] [MainThread]: Command `dbt snapshot` failed at 07:33:04.812659 after 5.07 seconds
[0m07:33:04.813073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb760b170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff905fd4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb27ab2f0>]}
[0m07:33:04.813267 [debug] [MainThread]: Flushing usage events
[0m07:33:47.062273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a22c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b13d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b13e240>]}


============================== 07:33:47.065455 | bc3d5677-aea9-476f-bfe1-b5b181ab99eb ==============================
[0m07:33:47.065455 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:33:47.065785 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:33:47.448941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff691f7e90>]}
[0m07:33:47.480278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a33ac60>]}
[0m07:33:47.480739 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:33:47.484137 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:33:47.497388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:33:47.497589 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:33:47.499822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff845d5ee0>]}
[0m07:33:47.504939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f9d370>]}
[0m07:33:47.505166 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:33:47.505373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69002de0>]}
[0m07:33:47.506217 [info ] [MainThread]: 
[0m07:33:47.506623 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:33:47.507231 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:33:47.512364 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:33:47.512544 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:33:47.512689 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:48.356846 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:33:48.358881 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:33:48.485226 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:33:48.494666 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:33:48.495145 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:33:48.495534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:49.008457 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:33:49.010805 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:33:49.166065 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:33:49.170537 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:33:49.171169 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:33:49.172199 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:49.652690 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:33:49.655763 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:33:49.874531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a22aa80>]}
[0m07:33:49.876526 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:33:49.877188 [info ] [MainThread]: 
[0m07:33:49.890480 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:33:49.891235 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:33:49.892144 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:33:49.892668 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:33:49.900050 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:33:49.893006 => 07:33:49.899823
[0m07:33:49.900461 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:33:49.932387 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:49.932731 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:49.932966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:50.449737 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:50.463675 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.464939 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:50.545226 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:50.548398 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.548606 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:50.650010 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:50.667298 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.667663 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:50.867090 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-1a01-000f-c0df008a21ca
[0m07:33:50.867802 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:50.868648 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:33:49.900706 => 07:33:50.868318
[0m07:33:50.869206 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:33:51.009824 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:51.010597 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68217ce0>]}
[0m07:33:51.011627 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.12s]
[0m07:33:51.012670 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:33:51.013277 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.014561 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:33:51.015496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:33:51.015941 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.019801 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:33:51.016253 => 07:33:51.019609
[0m07:33:51.020166 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.023997 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.024350 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:51.024687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:51.443949 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:33:51.450488 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.451370 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:51.532710 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:51.540222 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.541057 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:51.646304 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:51.659229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.660180 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:51.808194 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-19fd-000f-c0df008a127a
[0m07:33:51.808577 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:51.808999 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:33:51.020412 => 07:33:51.808847
[0m07:33:51.809275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:33:51.986146 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:51.986883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6815fe90>]}
[0m07:33:51.987742 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 0.97s]
[0m07:33:51.988506 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.990446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:33:51.990828 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:33:51.991150 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:33:51.991499 [info ] [MainThread]: 
[0m07:33:51.991870 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.49 seconds (4.49s).
[0m07:33:51.992659 [debug] [MainThread]: Command end result
[0m07:33:52.002194 [info ] [MainThread]: 
[0m07:33:52.002592 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:33:52.002992 [info ] [MainThread]: 
[0m07:33:52.003350 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:52.003664 [info ] [MainThread]: 
[0m07:33:52.004049 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:52.004341 [info ] [MainThread]: 
[0m07:33:52.004668 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:33:52.005457 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.9640093, "process_user_time": 2.50896, "process_kernel_time": 0.20575, "process_mem_max_rss": "215620", "process_out_blocks": "1819", "command_success": false, "process_in_blocks": "0"}
[0m07:33:52.005863 [debug] [MainThread]: Command `dbt snapshot` failed at 07:33:52.005776 after 4.96 seconds
[0m07:33:52.006159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a75fa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff697cb230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69e51a30>]}
[0m07:33:52.006453 [debug] [MainThread]: Flushing usage events
[0m07:36:26.860089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e836b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa36cde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ebf1b50>]}


============================== 07:36:26.863572 | 808149ce-d352-4e4a-918c-344a708cb5ea ==============================
[0m07:36:26.863572 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:36:26.863941 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:36:27.325981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee4eea0>]}
[0m07:36:27.359375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d79f7d0>]}
[0m07:36:27.359831 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:36:27.363454 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:36:27.377243 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:36:27.377542 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:36:27.377735 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:36:27.457967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d127e00>]}
[0m07:36:27.464928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d0bc620>]}
[0m07:36:27.465169 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:36:27.465357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d37ffe0>]}
[0m07:36:27.466218 [info ] [MainThread]: 
[0m07:36:27.466681 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:36:27.467396 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:36:27.472828 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:36:27.473025 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:36:27.473172 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:27.954212 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:36:27.956791 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:36:28.137058 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:36:28.148767 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:36:28.149286 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:36:28.149717 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:28.669413 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:36:28.671088 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:36:28.812674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:36:28.817801 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:36:28.818550 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:36:28.819890 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:29.293839 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:36:29.296369 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:36:29.441883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3abec0>]}
[0m07:36:29.443652 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:36:29.444372 [info ] [MainThread]: 
[0m07:36:29.455307 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:36:29.455910 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:36:29.457075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:36:29.457582 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:36:29.464951 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:36:29.457873 => 07:36:29.464662
[0m07:36:29.465493 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:36:29.497389 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:29.497753 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:29.497990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:30.175707 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:36:30.189449 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.190603 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:30.300941 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:30.313582 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.314547 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:30.429405 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:30.461615 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.462339 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:30.666738 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-1a0e-000f-c0df008a4106
[0m07:36:30.667828 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:30.668879 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:36:29.465786 => 07:36:30.668555
[0m07:36:30.669537 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:36:30.808547 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:30.809914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c7c8da0>]}
[0m07:36:30.811301 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.35s]
[0m07:36:30.812347 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:36:30.813138 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.814929 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:36:30.816102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:36:30.816666 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.820547 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:36:30.817031 => 07:36:30.820312
[0m07:36:30.821090 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.824849 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:30.825229 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:30.825572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:31.376460 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:36:31.381660 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.382449 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:31.501334 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:31.506720 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.507404 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:31.646880 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:31.658970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.659975 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:31.831985 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-18e5-000f-c0df00897d4a
[0m07:36:31.832835 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:31.833879 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:36:30.821369 => 07:36:31.833648
[0m07:36:31.834492 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:36:31.989404 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.989881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c63a180>]}
[0m07:36:31.990331 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.17s]
[0m07:36:31.990749 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:31.991955 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:36:31.992185 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:36:31.992445 [info ] [MainThread]: 
[0m07:36:31.992706 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.53 seconds (4.53s).
[0m07:36:31.993190 [debug] [MainThread]: Command end result
[0m07:36:31.998238 [info ] [MainThread]: 
[0m07:36:31.998532 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:36:31.998779 [info ] [MainThread]: 
[0m07:36:31.998998 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.999242 [info ] [MainThread]: 
[0m07:36:31.999452 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.999672 [info ] [MainThread]: 
[0m07:36:31.999899 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:36:32.000572 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.1642203, "process_user_time": 2.804799, "process_kernel_time": 0.303323, "process_mem_max_rss": "217676", "process_out_blocks": "2691", "command_success": false, "process_in_blocks": "0"}
[0m07:36:32.000845 [debug] [MainThread]: Command `dbt snapshot` failed at 07:36:32.000785 after 5.16 seconds
[0m07:36:32.001047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e87d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e836b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c75f500>]}
[0m07:36:32.001225 [debug] [MainThread]: Flushing usage events
[0m07:36:49.351688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888fe990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88900440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88a0cb60>]}


============================== 07:36:49.354505 | f2fe64ca-7487-4f55-83c0-60489c30055f ==============================
[0m07:36:49.354505 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:36:49.354758 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:36:49.705492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888fec60>]}
[0m07:36:49.735494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88900440>]}
[0m07:36:49.735836 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:36:49.738995 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:36:49.752367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:36:49.752550 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:36:49.754750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6368a150>]}
[0m07:36:49.759682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff636253d0>]}
[0m07:36:49.759877 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:36:49.760086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63625040>]}
[0m07:36:49.760867 [info ] [MainThread]: 
[0m07:36:49.761287 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:36:49.761869 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:36:49.766893 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:36:49.767058 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:36:49.767223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:50.359060 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:36:50.361952 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:36:50.505344 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:36:50.517713 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:36:50.518490 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:36:50.519034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:51.053660 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:36:51.057488 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:36:51.203818 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:36:51.208936 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:36:51.209590 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:36:51.210481 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:51.712535 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:36:51.716152 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:36:51.857552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff635eddf0>]}
[0m07:36:51.858249 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:36:51.858624 [info ] [MainThread]: 
[0m07:36:51.864986 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:36:51.865387 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:36:51.865863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:36:51.866171 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:36:51.870801 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:36:51.866375 => 07:36:51.870649
[0m07:36:51.871105 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:36:51.905156 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:51.906147 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:51.906394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:52.341931 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:36:52.355621 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.356537 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:52.442861 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:52.456206 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.457070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:52.578722 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:52.609260 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.609842 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:52.787561 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-1ab7-000f-c0df0089e5a2
[0m07:36:52.788484 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:52.789371 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:36:51.871332 => 07:36:52.789057
[0m07:36:52.789927 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:36:52.939438 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:52.940773 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6332bf80>]}
[0m07:36:52.942103 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.07s]
[0m07:36:52.943092 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:36:52.943783 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.945216 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:36:52.946477 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:36:52.947452 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.952297 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:36:52.947801 => 07:36:52.952054
[0m07:36:52.952752 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.957270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:52.957646 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:52.958019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:53.397346 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:36:53.404064 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.405043 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:53.507868 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:53.511948 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.512352 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:53.590236 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:53.594713 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.595045 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:53.778215 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-18e5-000f-c0df00897d52
[0m07:36:53.779434 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:53.780308 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:36:52.953073 => 07:36:53.780001
[0m07:36:53.780907 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:36:53.958755 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.960062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63329850>]}
[0m07:36:53.961385 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.01s]
[0m07:36:53.962281 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:53.965019 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:36:53.965548 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:36:53.965924 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:36:53.966389 [info ] [MainThread]: 
[0m07:36:53.966893 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.21 seconds (4.21s).
[0m07:36:53.968059 [debug] [MainThread]: Command end result
[0m07:36:53.979162 [info ] [MainThread]: 
[0m07:36:53.979607 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:36:53.980075 [info ] [MainThread]: 
[0m07:36:53.980490 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.980931 [info ] [MainThread]: 
[0m07:36:53.981533 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.981999 [info ] [MainThread]: 
[0m07:36:53.982475 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:36:53.983582 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.652883, "process_user_time": 2.57328, "process_kernel_time": 0.171151, "process_mem_max_rss": "215884", "process_out_blocks": "1818", "command_success": false, "process_in_blocks": "0"}
[0m07:36:53.984060 [debug] [MainThread]: Command `dbt snapshot` failed at 07:36:53.983969 after 4.65 seconds
[0m07:36:53.984374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff889ffe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63e4e930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff635eea20>]}
[0m07:36:53.984674 [debug] [MainThread]: Flushing usage events
[0m07:39:12.232753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4edab70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5251970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4f7b560>]}


============================== 07:39:12.235784 | b7db34f5-9216-4d13-8a94-12d0b08139fb ==============================
[0m07:39:12.235784 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:39:12.236076 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:39:12.602227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91f86000>]}
[0m07:39:12.632493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff25eb0>]}
[0m07:39:12.632825 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:39:12.636587 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:39:12.649314 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:39:12.649589 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:39:12.649801 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:39:12.728535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f95e0f0>]}
[0m07:39:12.733725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fbf11c0>]}
[0m07:39:12.733953 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:39:12.734159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fc22a20>]}
[0m07:39:12.735007 [info ] [MainThread]: 
[0m07:39:12.735396 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:39:12.736021 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:39:12.741407 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:39:12.741590 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:39:12.741741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:39:13.305734 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:39:13.309096 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:39:13.452556 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:39:13.464428 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:39:13.465206 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:39:13.465795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:39:13.902777 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:39:13.906120 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:39:14.058287 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:39:14.063793 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:39:14.064497 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:39:14.065522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:39:14.524739 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:39:14.527841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:39:14.698865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f7601a0>]}
[0m07:39:14.700152 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:39:14.700766 [info ] [MainThread]: 
[0m07:39:14.711618 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:39:14.712262 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:39:14.713154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:39:14.713614 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:39:14.722738 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:39:14.713903 => 07:39:14.721981
[0m07:39:14.723507 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:39:14.756629 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:14.756990 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:39:14.757293 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:39:15.237251 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:39:15.249070 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.249818 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:39:15.361191 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:39:15.371712 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.372408 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:39:15.466030 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:39:15.497110 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.497619 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:39:15.633843 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e8b-0307-1ab7-000f-c0df0089e662
[0m07:39:15.634890 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:39:15.635782 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:39:14.724072 => 07:39:15.635485
[0m07:39:15.636338 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:39:15.763777 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:15.765096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9c7020>]}
[0m07:39:15.766312 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.05s]
[0m07:39:15.767159 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:39:15.767897 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.769681 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:39:15.770889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:39:15.771568 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.775860 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:39:15.772123 => 07:39:15.775590
[0m07:39:15.776345 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.780525 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:15.780924 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:39:15.781296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:39:16.335295 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:39:16.341470 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.342339 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:39:16.451442 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:39:16.458970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.459564 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:39:16.535117 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:39:16.547958 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.548804 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:39:16.673924 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e8b-0307-19fd-000f-c0df008a138a
[0m07:39:16.674959 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 27 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:39:16.675845 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:39:15.776676 => 07:39:16.675526
[0m07:39:16.676532 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:39:16.826976 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 27 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.828325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d917cb0>]}
[0m07:39:16.829560 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.06s]
[0m07:39:16.830532 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:16.833626 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:39:16.834155 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:39:16.834519 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:39:16.834951 [info ] [MainThread]: 
[0m07:39:16.835852 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.10 seconds (4.10s).
[0m07:39:16.837474 [debug] [MainThread]: Command end result
[0m07:39:16.851210 [info ] [MainThread]: 
[0m07:39:16.851773 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:39:16.852065 [info ] [MainThread]: 
[0m07:39:16.852626 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.853110 [info ] [MainThread]: 
[0m07:39:16.853515 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 27 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.854058 [info ] [MainThread]: 
[0m07:39:16.854519 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:39:16.855560 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.6450443, "process_user_time": 2.722059, "process_kernel_time": 0.163604, "process_mem_max_rss": "219188", "process_out_blocks": "2692", "command_success": false, "process_in_blocks": "0"}
[0m07:39:16.856128 [debug] [MainThread]: Command `dbt snapshot` failed at 07:39:16.855943 after 4.65 seconds
[0m07:39:16.856596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4e96bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9e5970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5251970>]}
[0m07:39:16.856976 [debug] [MainThread]: Flushing usage events
[0m07:41:23.788643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93edaff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94508b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff943dfe00>]}


============================== 07:41:23.791813 | bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1 ==============================
[0m07:41:23.791813 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:41:23.792122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt compile -s snap_btc_market', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:41:24.146737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f50b410>]}
[0m07:41:24.177364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ed5d6a0>]}
[0m07:41:24.177734 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:41:24.181726 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:41:24.194952 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:41:24.195138 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:41:24.197432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93ed8c50>]}
[0m07:41:24.203326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6eae1430>]}
[0m07:41:24.203538 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:41:24.203745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ec2f320>]}
[0m07:41:24.204482 [info ] [MainThread]: 
[0m07:41:24.204949 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:41:24.205525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:41:24.211361 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:41:24.211528 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:41:24.211660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:24.807669 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:41:24.811149 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:41:24.961494 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:41:24.967055 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:41:24.967752 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:41:24.968295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:25.456704 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:41:25.461442 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:41:25.601770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7465f1d0>]}
[0m07:41:25.604109 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:41:25.605001 [info ] [MainThread]: 
[0m07:41:25.616621 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:41:25.617596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:41:25.618072 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:41:25.625258 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:41:25.618374 => 07:41:25.625034
[0m07:41:25.625671 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:41:25.626127 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:41:25.625964 => 07:41:25.625980
[0m07:41:25.626847 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:41:25.627847 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:41:25.628203 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_market' was properly closed.
[0m07:41:25.628761 [debug] [MainThread]: Command end result
[0m07:41:25.636632 [info ] [MainThread]: Compiled node 'snap_btc_market' is:




select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

[0m07:41:25.637438 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.8710045, "process_user_time": 2.27418, "process_kernel_time": 0.180331, "process_mem_max_rss": "212060", "process_out_blocks": "1779", "process_in_blocks": "0"}
[0m07:41:25.637856 [debug] [MainThread]: Command `dbt compile` succeeded at 07:41:25.637751 after 1.87 seconds
[0m07:41:25.638144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9479dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ea75280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93dd8770>]}
[0m07:41:25.638408 [debug] [MainThread]: Flushing usage events
[0m07:48:12.199985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6097680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa63de030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6095310>]}


============================== 07:48:12.202948 | 73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0 ==============================
[0m07:48:12.202948 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:48:12.203256 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot -s snap_btc_market', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:48:12.569786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff850fb380>]}
[0m07:48:12.599164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86aba330>]}
[0m07:48:12.599547 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:48:12.603385 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:48:12.618192 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:48:12.618360 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:48:12.620600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0df70>]}
[0m07:48:12.625844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d352b0>]}
[0m07:48:12.626047 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:48:12.626253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8515dc40>]}
[0m07:48:12.626928 [info ] [MainThread]: 
[0m07:48:12.627329 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:48:12.627955 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:48:12.632955 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:48:12.633117 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:48:12.633244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:13.199929 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:48:13.202295 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:48:13.381902 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:48:13.393806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:48:13.394371 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:48:13.394888 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:13.948386 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:48:13.951674 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:48:14.119046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:48:14.122806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:48:14.123526 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:48:14.124070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:14.610906 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:48:14.613782 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:48:14.749446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6096540>]}
[0m07:48:14.750533 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:48:14.750899 [info ] [MainThread]: 
[0m07:48:14.758429 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:48:14.758921 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:48:14.759714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:48:14.760075 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:48:14.765794 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:48:14.760296 => 07:48:14.765602
[0m07:48:14.766108 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:48:14.799830 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:48:14.801346 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:48:14.801601 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



        );
[0m07:48:14.801840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:48:16.597839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:48:16.624992 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:48:14.766308 => 07:48:16.624730
[0m07:48:16.625640 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:48:16.777661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f693a0>]}
[0m07:48:16.779354 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 2.02s]
[0m07:48:16.780463 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:48:16.783590 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:48:16.784177 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_market' was properly closed.
[0m07:48:16.784698 [info ] [MainThread]: 
[0m07:48:16.785267 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 4.16 seconds (4.16s).
[0m07:48:16.786673 [debug] [MainThread]: Command end result
[0m07:48:16.800147 [info ] [MainThread]: 
[0m07:48:16.800769 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:48:16.801317 [info ] [MainThread]: 
[0m07:48:16.801895 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:48:16.803347 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.6235895, "process_user_time": 2.456076, "process_kernel_time": 0.181707, "process_mem_max_rss": "212836", "process_out_blocks": "1786", "process_in_blocks": "0"}
[0m07:48:16.804005 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:48:16.803865 after 4.62 seconds
[0m07:48:16.804463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa64a6240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa63de030>]}
[0m07:48:16.804942 [debug] [MainThread]: Flushing usage events
[0m07:49:26.876796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa60426c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6042810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa60427b0>]}


============================== 07:49:26.879909 | ce797d46-84b1-443c-894f-99ecbf1450dc ==============================
[0m07:49:26.879909 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:49:26.880365 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot -s snap_btc_ohlc', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:49:27.223518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85411a30>]}
[0m07:49:27.252983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c323c0>]}
[0m07:49:27.253335 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:49:27.257222 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:49:27.270900 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:49:27.271082 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:49:27.273264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff850cb920>]}
[0m07:49:27.278946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84edce60>]}
[0m07:49:27.279173 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:49:27.279383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0ddf0>]}
[0m07:49:27.280027 [info ] [MainThread]: 
[0m07:49:27.280421 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:49:27.280998 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:49:27.285788 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:49:27.285967 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:49:27.286102 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:49:27.749343 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:49:27.751164 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:49:27.876072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:49:27.884208 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:49:27.885179 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:49:27.885483 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:49:28.293826 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:49:28.297260 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:49:28.440470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:49:28.443951 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:49:28.444466 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:49:28.445193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:49:29.604219 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m07:49:29.608139 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:49:29.736976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84c76c30>]}
[0m07:49:29.738726 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:49:29.739377 [info ] [MainThread]: 
[0m07:49:29.752314 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.753205 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:49:29.754247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:49:29.754729 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.762432 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:49:29.755037 => 07:49:29.762201
[0m07:49:29.762854 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.801811 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:49:29.803109 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:49:29.803337 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



        );
[0m07:49:29.803541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:49:31.255015 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:49:31.278971 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:49:29.763117 => 07:49:31.278749
[0m07:49:31.279504 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:49:31.461157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f9b140>]}
[0m07:49:31.462806 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.71s]
[0m07:49:31.464071 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:31.467144 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:49:31.467673 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:49:31.468147 [info ] [MainThread]: 
[0m07:49:31.468681 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 4.19 seconds (4.19s).
[0m07:49:31.469859 [debug] [MainThread]: Command end result
[0m07:49:31.484992 [info ] [MainThread]: 
[0m07:49:31.485580 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:49:31.486150 [info ] [MainThread]: 
[0m07:49:31.486746 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:49:31.487954 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.632018, "process_user_time": 2.416763, "process_kernel_time": 0.158115, "process_mem_max_rss": "212988", "process_out_blocks": "1786", "process_in_blocks": "0"}
[0m07:49:31.488543 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:49:31.488411 after 4.63 seconds
[0m07:49:31.488909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6088a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f40e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f69970>]}
[0m07:49:31.489269 [debug] [MainThread]: Flushing usage events
[0m07:50:30.363668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625b80>]}


============================== 07:50:30.366576 | 694362e4-900c-4655-a9bd-039771c4d90d ==============================
[0m07:50:30.366576 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:50:30.366840 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:50:30.754920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86517080>]}
[0m07:50:30.785624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87181c70>]}
[0m07:50:30.785971 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:50:30.789834 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:50:30.802537 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:50:30.802707 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:50:30.804902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8648f140>]}
[0m07:50:30.806705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86429430>]}
[0m07:50:30.806900 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:50:30.807119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86379b20>]}
[0m07:50:30.807892 [info ] [MainThread]: 
[0m07:50:30.808290 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:50:30.808804 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:50:30.814931 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:50:30.815109 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:50:30.815251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:31.336192 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:50:31.339866 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:50:31.469199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:50:31.477169 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:50:31.477750 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:50:31.478210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:50:32.093094 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:50:32.094422 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:50:32.239058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8733a9f0>]}
[0m07:50:32.239803 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:50:32.240173 [info ] [MainThread]: 
[0m07:50:32.247479 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:50:32.247981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m07:50:32.248278 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:50:32.253301 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:50:32.254965 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:50:32.248507 => 07:50:32.254818
[0m07:50:32.255530 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:50:32.255809 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:50:32.256258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:50:32.256533 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:50:32.258684 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:50:32.259219 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:50:32.256737 => 07:50:32.259108
[0m07:50:32.259674 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:50:32.259914 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:50:32.260291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m07:50:32.260535 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:50:32.262221 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:50:32.260669 => 07:50:32.262114
[0m07:50:32.262424 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:50:32.262639 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:50:32.262547 => 07:50:32.262553
[0m07:50:32.263061 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:50:32.263272 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.263584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:50:32.263770 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.265356 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:50:32.263891 => 07:50:32.265250
[0m07:50:32.265635 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.265889 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:50:32.265780 => 07:50:32.265786
[0m07:50:32.266377 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.266623 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:50:32.267000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:50:32.267181 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:50:32.286554 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:50:32.287324 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:50:32.267301 => 07:50:32.287235
[0m07:50:32.287502 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:50:32.287717 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:50:32.287633 => 07:50:32.287637
[0m07:50:32.288097 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:50:32.288468 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.288784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:50:32.289000 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.294289 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:50:32.295010 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:50:32.289107 => 07:50:32.294915
[0m07:50:32.295175 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.295348 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:50:32.295275 => 07:50:32.295278
[0m07:50:32.295685 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.295865 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.296143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:50:32.296296 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.297874 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:50:32.298464 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:50:32.296397 => 07:50:32.298381
[0m07:50:32.298621 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.298793 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:50:32.298718 => 07:50:32.298721
[0m07:50:32.299133 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.299429 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.299794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:50:32.299982 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.302597 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:50:32.303038 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:50:32.300090 => 07:50:32.302957
[0m07:50:32.303199 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.303373 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:50:32.303300 => 07:50:32.303303
[0m07:50:32.303696 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.304198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:50:32.304352 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:50:32.304789 [debug] [MainThread]: Command end result
[0m07:50:32.311724 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m07:50:32.311882 [info ] [MainThread]: Building catalog
[0m07:50:32.312951 [debug] [ThreadPool]: Acquiring new snowflake connection 'USER_DB_PEACOCK.information_schema'
[0m07:50:32.317353 [debug] [ThreadPool]: Using snowflake connection "USER_DB_PEACOCK.information_schema"
[0m07:50:32.317575 [debug] [ThreadPool]: On USER_DB_PEACOCK.information_schema: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "USER_DB_PEACOCK.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        coalesce(table_type, 'DYNAMIC TABLE') as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from USER_DB_PEACOCK.INFORMATION_SCHEMA.tables
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_market_daily')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_market')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('fct_btc_indicators')
                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from USER_DB_PEACOCK.INFORMATION_SCHEMA.columns
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_market_daily')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_market')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('fct_btc_indicators')
                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m07:50:32.317765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:35.292517 [debug] [ThreadPool]: SQL status: SUCCESS 50 in 3.0 seconds
[0m07:50:35.304350 [debug] [ThreadPool]: On USER_DB_PEACOCK.information_schema: Close
[0m07:50:35.487272 [info ] [MainThread]: Catalog written to /opt/airflow/dbt/btc_elt/target/catalog.json
[0m07:50:35.488798 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 5.1467156, "process_user_time": 2.40698, "process_kernel_time": 0.16464, "process_mem_max_rss": "212376", "process_out_blocks": "4825", "process_in_blocks": "0"}
[0m07:50:35.489413 [debug] [MainThread]: Command `dbt docs generate` succeeded at 07:50:35.489292 after 5.15 seconds
[0m07:50:35.489759 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m07:50:35.489983 [debug] [MainThread]: Connection 'USER_DB_PEACOCK.information_schema' was properly closed.
[0m07:50:35.490246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff869b3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff861c6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8661ba40>]}
[0m07:50:35.490629 [debug] [MainThread]: Flushing usage events
[0m07:51:55.791133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a77dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cc0f9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aac5730>]}


============================== 07:51:55.794014 | af9fdc08-5c98-4fc2-8a15-04929d5c3a76 ==============================
[0m07:51:55.794014 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:51:55.794349 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:51:56.140954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af9fdc08-5c98-4fc2-8a15-04929d5c3a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff779da930>]}
[0m07:51:56.171627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af9fdc08-5c98-4fc2-8a15-04929d5c3a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69b070b0>]}
[0m07:51:56.174042 [error] [MainThread]: Encountered an error:
[Errno 98] Address already in use
[0m07:51:56.174829 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 91, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 76, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 169, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 198, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 245, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/main.py", line 325, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/task/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socketserver.py", line 457, in __init__
    self.server_bind()
  File "/usr/local/lib/python3.12/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
OSError: [Errno 98] Address already in use

[0m07:51:56.175402 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 0.40570313, "process_user_time": 2.063335, "process_kernel_time": 0.109977, "process_mem_max_rss": "202136", "process_out_blocks": "2938", "command_success": false, "process_in_blocks": "0"}
[0m07:51:56.175670 [debug] [MainThread]: Command `dbt docs serve` failed at 07:51:56.175612 after 0.41 seconds
[0m07:51:56.175857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f80b260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff696107a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ae1f530>]}
[0m07:51:56.176040 [debug] [MainThread]: Flushing usage events


============================== 07:55:21.609537 | 8c70c1bd-5f8f-4bb6-b21e-723291fce54b ==============================
[0m07:55:21.609537 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:55:21.612747 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8081 --host 0.0.0.0', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m08:11:33.018805 [error] [MainThread]: Encountered an error:

[0m08:11:33.040875 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 91, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 76, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 169, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 198, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 245, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/main.py", line 325, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/task/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m08:11:33.055383 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 971.4707, "process_user_time": 2.302042, "process_kernel_time": 0.18237, "process_mem_max_rss": "202240", "process_out_blocks": "2936", "command_success": false, "process_in_blocks": "0"}
[0m08:11:33.059442 [debug] [MainThread]: Command `dbt docs serve` failed at 08:11:33.059004 after 971.48 seconds
[0m08:11:33.061442 [debug] [MainThread]: Flushing usage events
[0m08:12:53.636226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990bc320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9952a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990bcb00>]}


============================== 08:12:53.639189 | 5e2498ad-37a1-40be-84ed-4ac3b3392bdf ==============================
[0m08:12:53.639189 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:12:53.639649 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:12:54.078818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff781f7bc0>]}
[0m08:12:54.111866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78e91160>]}
[0m08:12:54.112224 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:12:54.115863 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:12:54.129795 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:12:54.129967 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:12:54.132245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73ef1f10>]}
[0m08:12:54.139041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73c606b0>]}
[0m08:12:54.139264 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:12:54.139577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990b93a0>]}
[0m08:12:54.140281 [info ] [MainThread]: 
[0m08:12:54.140661 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:12:54.141216 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:12:54.146495 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:12:54.146650 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:12:54.146802 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:12:54.683117 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:12:54.686685 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:12:54.844438 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:12:54.850660 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:12:54.850961 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:12:54.851193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:55.419907 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m08:12:55.421101 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:12:55.572927 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:12:55.574386 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:12:55.574566 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:12:55.574864 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:56.008898 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:12:56.011987 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:12:56.150134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98e0d220>]}
[0m08:12:56.151192 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:12:56.152545 [info ] [MainThread]: 
[0m08:12:56.162132 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:12:56.162721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m08:12:56.162996 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:12:56.169005 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:12:56.171304 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:12:56.163183 => 08:12:56.171101
[0m08:12:56.171993 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:12:56.172304 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:12:56.172953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:12:56.173179 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:12:56.175535 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:12:56.177510 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:12:56.173351 => 08:12:56.177342
[0m08:12:56.178261 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:12:56.178990 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:12:56.179319 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:12:56.180357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:12:56.180611 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:12:56.205249 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:12:56.206269 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:12:56.180816 => 08:12:56.206164
[0m08:12:56.206480 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:12:56.218378 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:12:56.221033 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:12:56.221316 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:12:56.221623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:58.874894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m08:12:58.900502 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:12:56.206619 => 08:12:58.900270
[0m08:12:58.900967 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:12:59.219731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73b3b9e0>]}
[0m08:12:59.221525 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 3.04s]
[0m08:12:59.224105 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:12:59.227111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:12:59.227795 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:12:59.228245 [info ] [MainThread]: 
[0m08:12:59.229240 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.09 seconds (5.09s).
[0m08:12:59.230063 [debug] [MainThread]: Command end result
[0m08:12:59.242381 [info ] [MainThread]: 
[0m08:12:59.243118 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:12:59.243430 [info ] [MainThread]: 
[0m08:12:59.243944 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:12:59.245319 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.632635, "process_user_time": 2.465758, "process_kernel_time": 0.237736, "process_mem_max_rss": "212540", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:12:59.245784 [debug] [MainThread]: Command `dbt run` succeeded at 08:12:59.245693 after 5.63 seconds
[0m08:12:59.246125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99150ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff796ea210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73dbcbf0>]}
[0m08:12:59.246427 [debug] [MainThread]: Flushing usage events
[0m08:13:01.310459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae26a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9fc530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae24ef0>]}


============================== 08:13:01.313171 | 065f39ea-b5d1-4063-90eb-af525c51e40b ==============================
[0m08:13:01.313171 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:01.313879 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:13:01.682125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a98cef0>]}
[0m08:13:01.713559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a3b3830>]}
[0m08:13:01.714003 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:01.717537 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:13:01.730646 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:13:01.730826 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:13:01.733224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89bc0bc0>]}
[0m08:13:01.738912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c2cad0>]}
[0m08:13:01.739152 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:13:01.739473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89b60920>]}
[0m08:13:01.740346 [info ] [MainThread]: 
[0m08:13:01.740808 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:13:01.741440 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:13:01.747351 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:13:01.747539 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:13:01.747682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:13:02.233504 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:13:02.237285 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:13:02.382669 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:13:02.389473 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:13:02.390280 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:13:02.390801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:02.774456 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:13:02.776183 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:13:02.912683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c2ea50>]}
[0m08:13:02.914097 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:13:02.915230 [info ] [MainThread]: 
[0m08:13:02.925578 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.926009 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:13:02.926679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:13:02.927022 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.938701 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.939847 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:13:02.927243 => 08:13:02.939705
[0m08:13:02.940094 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.950382 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.951407 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.951618 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:13:02.951851 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:03.688317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:03.697704 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:13:02.940245 => 08:13:03.697387
[0m08:13:03.698190 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:13:03.882164 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.96s]
[0m08:13:03.883480 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:03.884231 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.884965 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:13:03.886480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:13:03.887137 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.893230 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.895499 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:13:03.887614 => 08:13:03.895093
[0m08:13:03.896219 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.899390 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.900957 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.901413 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:13:03.901786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:04.487805 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:04.492038 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:13:03.896557 => 08:13:04.491676
[0m08:13:04.492758 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:13:04.628652 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.74s]
[0m08:13:04.630542 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:04.631229 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.631843 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:13:04.633529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:13:04.634317 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.646344 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.647952 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:13:04.634959 => 08:13:04.647738
[0m08:13:04.648354 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.650706 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.652188 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.652594 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:13:04.652910 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:05.212608 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:05.216145 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:13:04.648600 => 08:13:05.215799
[0m08:13:05.216837 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:13:05.355026 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.72s]
[0m08:13:05.355769 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:05.357238 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:13:05.357509 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:13:05.357754 [info ] [MainThread]: 
[0m08:13:05.358201 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m08:13:05.358911 [debug] [MainThread]: Command end result
[0m08:13:05.365423 [info ] [MainThread]: 
[0m08:13:05.365800 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:13:05.365975 [info ] [MainThread]: 
[0m08:13:05.366213 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:13:05.367076 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.078525, "process_user_time": 2.467058, "process_kernel_time": 0.11599, "process_mem_max_rss": "212276", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:13:05.367396 [debug] [MainThread]: Command `dbt test` succeeded at 08:13:05.367337 after 4.08 seconds
[0m08:13:05.367611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9fc530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab4412b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab210aa0>]}
[0m08:13:05.367804 [debug] [MainThread]: Flushing usage events
[0m08:13:07.561344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e49760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8611e6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff861701d0>]}


============================== 08:13:07.564165 | 961828e4-15e8-4f8a-9ee0-a24042eca661 ==============================
[0m08:13:07.564165 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:07.565483 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:13:07.971770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64adf3b0>]}
[0m08:13:08.004417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff648173e0>]}
[0m08:13:08.004924 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:08.009119 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:13:08.024367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:13:08.024562 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:13:08.026861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ad04a0>]}
[0m08:13:08.032200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff647ac830>]}
[0m08:13:08.032410 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:13:08.032784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a8e2a0>]}
[0m08:13:08.033552 [info ] [MainThread]: 
[0m08:13:08.033942 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:13:08.034525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:13:08.039679 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:13:08.039841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:13:08.039959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:13:08.475273 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:13:08.477516 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:13:08.600260 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:13:08.610980 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:13:08.611626 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:13:08.612169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:09.045253 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:13:09.048361 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:13:09.210522 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:13:09.215578 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:13:09.216199 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:13:09.217248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:09.703881 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:13:09.706004 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:13:09.857369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff648158b0>]}
[0m08:13:09.858745 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:13:09.860328 [info ] [MainThread]: 
[0m08:13:09.871124 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:13:09.871594 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:13:09.872227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:13:09.872412 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:13:09.876789 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:13:09.872569 => 08:13:09.876657
[0m08:13:09.877018 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:13:09.903225 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:09.903559 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:13:09.903760 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:10.491825 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:10.504414 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.505135 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:10.589112 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:10.600229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.600888 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:10.727890 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:10.751061 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.751958 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:13:11.989116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:11.993837 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:11.994929 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.117637 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.123491 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.124070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:12.235569 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:12.241678 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.242475 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.341754 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.348319 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.349115 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:12.494538 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:12.506566 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.507507 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.613935 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.622885 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.625341 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.625795 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:13:12.754266 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:12.754821 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.755041 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:13:13.334168 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m08:13:13.335167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:13.335508 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:13:13.721542 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:13.749570 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:13:09.877141 => 08:13:13.749213
[0m08:13:13.750143 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:13:13.884116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff642a2570>]}
[0m08:13:13.886575 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.01s]
[0m08:13:13.889349 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:13:13.890542 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.892026 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:13:13.893457 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:13:13.894035 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.899871 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:13:13.894398 => 08:13:13.899598
[0m08:13:13.900386 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.904540 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:13.904887 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:13:13.905229 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:14.561108 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:14.570115 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.571247 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:14.739552 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:14.747243 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.747764 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:14.886847 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:14.900654 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.901951 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:13:16.182128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:16.188576 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.189201 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.320560 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.327428 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.328364 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:16.457748 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:16.460625 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.460987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.602352 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.609170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.610376 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:16.685957 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:16.690375 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.690752 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.780757 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.785459 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.788597 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.789200 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:13:16.942943 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:16.943302 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.943522 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:13:17.611810 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:17.612280 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:17.612525 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:13:18.177691 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:18.180098 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:13:13.900663 => 08:13:18.179885
[0m08:13:18.180411 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:13:18.295978 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64293fe0>]}
[0m08:13:18.298205 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.40s]
[0m08:13:18.299691 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:18.302121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:13:18.302355 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:13:18.302578 [info ] [MainThread]: 
[0m08:13:18.302921 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.27 seconds (10.27s).
[0m08:13:18.303476 [debug] [MainThread]: Command end result
[0m08:13:18.311358 [info ] [MainThread]: 
[0m08:13:18.311827 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:13:18.311976 [info ] [MainThread]: 
[0m08:13:18.312233 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:13:18.313966 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.773754, "process_user_time": 2.897732, "process_kernel_time": 0.254222, "process_mem_max_rss": "213948", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:13:18.314525 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:13:18.314442 after 10.77 seconds
[0m08:13:18.314928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ef3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bee900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6483bef0>]}
[0m08:13:18.315114 [debug] [MainThread]: Flushing usage events


============================== 08:13:43.237381 | fbd3503e-9870-458b-b029-bac14cd59371 ==============================
[0m08:13:43.237381 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:43.240520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt debug --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m08:13:43.240771 [info ] [MainThread]: dbt version: 1.7.19
[0m08:13:43.241043 [info ] [MainThread]: python version: 3.12.5
[0m08:13:43.241286 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m08:13:43.241533 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m08:13:43.557859 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m08:13:43.558234 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m08:13:43.558553 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m08:13:43.558885 [info ] [MainThread]: adapter type: snowflake
[0m08:13:43.559140 [info ] [MainThread]: adapter version: 1.7.0
[0m08:13:43.597558 [info ] [MainThread]: Configuration:
[0m08:13:43.597858 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:13:43.598098 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:13:43.598339 [info ] [MainThread]: Required dependencies:
[0m08:13:43.598575 [debug] [MainThread]: Executing "git --help"
[0m08:13:43.599114 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m08:13:43.599293 [info ] [MainThread]: Connection:
[0m08:13:43.599531 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m08:13:43.599790 [info ] [MainThread]:   user: PEACOCK
[0m08:13:43.600018 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m08:13:43.600188 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m08:13:43.600391 [info ] [MainThread]:   role: TRAINING_ROLE
[0m08:13:43.600590 [info ] [MainThread]:   schema: analytics
[0m08:13:43.600815 [info ] [MainThread]:   authenticator: None
[0m08:13:43.601060 [info ] [MainThread]:   private_key_path: None
[0m08:13:43.601285 [info ] [MainThread]:   token: None
[0m08:13:43.601519 [info ] [MainThread]:   oauth_client_id: None
[0m08:13:43.601726 [info ] [MainThread]:   query_tag: None
[0m08:13:43.601976 [info ] [MainThread]:   client_session_keep_alive: False
[0m08:13:43.602219 [info ] [MainThread]:   host: None
[0m08:13:43.602451 [info ] [MainThread]:   port: None
[0m08:13:43.602634 [info ] [MainThread]:   proxy_host: None
[0m08:13:43.602829 [info ] [MainThread]:   proxy_port: None
[0m08:13:43.603045 [info ] [MainThread]:   protocol: None
[0m08:13:43.603274 [info ] [MainThread]:   connect_retries: 1
[0m08:13:43.603501 [info ] [MainThread]:   connect_timeout: None
[0m08:13:43.603691 [info ] [MainThread]:   retry_on_database_errors: False
[0m08:13:43.603901 [info ] [MainThread]:   retry_all: False
[0m08:13:43.604142 [info ] [MainThread]:   insecure_mode: False
[0m08:13:43.604321 [info ] [MainThread]:   reuse_connections: None
[0m08:13:43.604564 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:43.604905 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m08:13:43.605199 [debug] [MainThread]: Using snowflake connection "debug"
[0m08:13:43.605356 [debug] [MainThread]: On debug: select 1 as id
[0m08:13:43.605502 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:13:44.049099 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:44.050339 [debug] [MainThread]: On debug: Close
[0m08:13:44.186750 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:13:44.187890 [info ] [MainThread]: [31m1 check failed:[0m
[0m08:13:44.188654 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m08:13:44.190741 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.9763269, "process_user_time": 2.187716, "process_kernel_time": 0.164354, "process_mem_max_rss": "205576", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m08:13:44.191657 [debug] [MainThread]: Command `dbt debug` failed at 08:13:44.191459 after 0.98 seconds
[0m08:13:44.192365 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:13:44.192889 [debug] [MainThread]: Flushing usage events
[0m08:45:51.781875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb389d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeee2e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea77fe0>]}


============================== 08:45:51.785605 | bd5e40f1-f207-40c2-8a56-c09ba23332db ==============================
[0m08:45:51.785605 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:45:51.787577 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:45:51.788716 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'btc_elt'
[0m08:45:51.789283 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.030407, "process_user_time": 1.825561, "process_kernel_time": 0.243818, "process_mem_max_rss": "170032", "process_out_blocks": "1338", "command_success": false, "process_in_blocks": "0"}
[0m08:45:51.789484 [debug] [MainThread]: Command `dbt run` failed at 08:45:51.789436 after 0.03 seconds
[0m08:45:51.789620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea32600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf065c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea74860>]}
[0m08:45:51.789789 [debug] [MainThread]: Flushing usage events
[0m09:23:06.903979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8572d670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a36330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8572c800>]}


============================== 09:23:06.907780 | e43712ed-613d-4123-95a5-45a42c580661 ==============================
[0m09:23:06.907780 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:23:06.908085 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:23:06.908363 [info ] [MainThread]: dbt version: 1.7.19
[0m09:23:06.908562 [info ] [MainThread]: python version: 3.12.5
[0m09:23:06.908811 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m09:23:06.908999 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m09:23:06.911826 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m09:23:06.912303 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.031010708, "process_user_time": 1.062564, "process_kernel_time": 0.083965, "process_mem_max_rss": "106460", "process_out_blocks": "1355", "command_success": false, "process_in_blocks": "0"}
[0m09:23:06.912523 [debug] [MainThread]: Command `dbt debug` failed at 09:23:06.912472 after 0.03 seconds
[0m09:23:06.912667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a36330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8578bef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff857cf7a0>]}
[0m09:23:06.912829 [debug] [MainThread]: Flushing usage events
[0m09:38:02.655694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99cfa780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c1836b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99cfb290>]}


============================== 09:38:02.659346 | 1ff6ec02-7cdc-49b1-8be0-74ff6d1dc5f4 ==============================
[0m09:38:02.659346 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:38:02.660255 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:38:02.738846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1ff6ec02-7cdc-49b1-8be0-74ff6d1dc5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99cb73e0>]}
[0m09:38:02.739353 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:38:02.740476 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:38:02.741066 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.108993, "process_user_time": 1.325676, "process_kernel_time": 0.203873, "process_mem_max_rss": "170008", "process_in_blocks": "4776", "process_out_blocks": "1339"}
[0m09:38:02.741292 [debug] [MainThread]: Command `dbt deps` succeeded at 09:38:02.741246 after 0.11 seconds
[0m09:38:02.741471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99cb7ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a3d5f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9aa12600>]}
[0m09:38:02.741662 [debug] [MainThread]: Flushing usage events
[0m09:38:05.848466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6cee330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb84bce30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb68c2180>]}


============================== 09:38:05.851651 | 4ce0ed33-4742-43a0-9547-f88d936b8d9c ==============================
[0m09:38:05.851651 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:38:05.852424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:38:06.280363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff958a5280>]}
[0m09:38:06.312043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b84d280>]}
[0m09:38:06.312412 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:38:06.316007 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:38:06.322996 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m09:38:06.323291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955128a0>]}
[0m09:38:06.866545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94fd2d20>]}
[0m09:38:06.872560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb753dd60>]}
[0m09:38:06.872754 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:38:06.873125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ce0ed33-4742-43a0-9547-f88d936b8d9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94b99520>]}
[0m09:38:06.873887 [info ] [MainThread]: 
[0m09:38:06.874256 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:38:06.874779 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m09:38:06.880028 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m09:38:06.880191 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:38:06.880338 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:38:07.079045 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:38:07.079557 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:38:07.079956 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m09:38:07.080283 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:38:07.080642 [debug] [ThreadPool]: On list_CAR_SALES_DBB: No close available on handle
[0m09:38:07.081718 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:38:07.082020 [debug] [MainThread]: Connection 'list_CAR_SALES_DBB' was properly closed.
[0m09:38:07.082319 [info ] [MainThread]: 
[0m09:38:07.082942 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m09:38:07.083352 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "CAR_SALES_DBB"
  Database Error
    250001 (08001): Failed to connect to DB: sfedu02-lvb17920.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m09:38:07.084285 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.259453, "process_user_time": 3.020683, "process_kernel_time": 0.178637, "process_mem_max_rss": "222080", "process_out_blocks": "1781", "command_success": false, "process_in_blocks": "0"}
[0m09:38:07.084712 [debug] [MainThread]: Command `dbt run` failed at 09:38:07.084611 after 1.26 seconds
[0m09:38:07.085028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6e41520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94b91340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95250950>]}
[0m09:38:07.085362 [debug] [MainThread]: Flushing usage events
[0m09:45:25.135704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae72b0e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea876b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeae96d0>]}


============================== 09:45:25.139435 | f0eece6b-4d18-40a4-9f85-440924ee1a40 ==============================
[0m09:45:25.139435 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:45:25.140139 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug -t dev', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:45:25.140435 [info ] [MainThread]: dbt version: 1.7.19
[0m09:45:25.140648 [info ] [MainThread]: python version: 3.12.5
[0m09:45:25.140921 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m09:45:25.141139 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m09:45:25.483851 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m09:45:25.484165 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m09:45:25.484469 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/dbt_project.yml
[0m09:45:25.484814 [info ] [MainThread]: adapter type: snowflake
[0m09:45:25.485065 [info ] [MainThread]: adapter version: 1.7.0
[0m09:45:25.524350 [info ] [MainThread]: Configuration:
[0m09:45:25.524699 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m09:45:25.524989 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m09:45:25.525238 [info ] [MainThread]: Required dependencies:
[0m09:45:25.525475 [debug] [MainThread]: Executing "git --help"
[0m09:45:25.526170 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m09:45:25.526369 [info ] [MainThread]: Connection:
[0m09:45:25.526593 [info ] [MainThread]:   account: sfedu02-lvb17920
[0m09:45:25.526830 [info ] [MainThread]:   user: RABBIT
[0m09:45:25.527041 [info ] [MainThread]:   database: CAR_SALES_DBB
[0m09:45:25.527258 [info ] [MainThread]:   warehouse: RABBIT_WH
[0m09:45:25.527482 [info ] [MainThread]:   role: TRAINING_ROLE
[0m09:45:25.527702 [info ] [MainThread]:   schema: analytics
[0m09:45:25.527927 [info ] [MainThread]:   authenticator: None
[0m09:45:25.528120 [info ] [MainThread]:   private_key_path: None
[0m09:45:25.528369 [info ] [MainThread]:   token: None
[0m09:45:25.528567 [info ] [MainThread]:   oauth_client_id: None
[0m09:45:25.528779 [info ] [MainThread]:   query_tag: None
[0m09:45:25.529025 [info ] [MainThread]:   client_session_keep_alive: False
[0m09:45:25.529223 [info ] [MainThread]:   host: None
[0m09:45:25.529433 [info ] [MainThread]:   port: None
[0m09:45:25.529658 [info ] [MainThread]:   proxy_host: None
[0m09:45:25.529860 [info ] [MainThread]:   proxy_port: None
[0m09:45:25.530076 [info ] [MainThread]:   protocol: None
[0m09:45:25.530297 [info ] [MainThread]:   connect_retries: 1
[0m09:45:25.530493 [info ] [MainThread]:   connect_timeout: None
[0m09:45:25.530681 [info ] [MainThread]:   retry_on_database_errors: False
[0m09:45:25.530899 [info ] [MainThread]:   retry_all: False
[0m09:45:25.531087 [info ] [MainThread]:   insecure_mode: False
[0m09:45:25.531264 [info ] [MainThread]:   reuse_connections: None
[0m09:45:25.531528 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:45:25.531872 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m09:45:25.532201 [debug] [MainThread]: Using snowflake connection "debug"
[0m09:45:25.532355 [debug] [MainThread]: On debug: select 1 as id
[0m09:45:25.532500 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:45:26.075219 [debug] [MainThread]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:45:26.077908 [debug] [MainThread]: On debug: Close
[0m09:45:26.210730 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m09:45:26.212101 [info ] [MainThread]: [31m1 check failed:[0m
[0m09:45:26.213358 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m09:45:26.217054 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.1040082, "process_user_time": 2.397273, "process_kernel_time": 0.230818, "process_mem_max_rss": "205888", "process_in_blocks": "96", "process_out_blocks": "121", "command_success": false}
[0m09:45:26.217875 [debug] [MainThread]: Command `dbt debug` failed at 09:45:26.217752 after 1.11 seconds
[0m09:45:26.218316 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m09:45:26.218617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaec396a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab2edc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9360f7d0>]}
[0m09:45:26.218966 [debug] [MainThread]: Flushing usage events
[0m09:55:32.674371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ed720c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee6d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ed72f30>]}


============================== 09:55:32.679017 | a855aa98-d324-473b-a261-4b783400ba38 ==============================
[0m09:55:32.679017 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:55:32.679504 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:55:32.742819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a855aa98-d324-473b-a261-4b783400ba38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eef0680>]}
[0m09:55:32.743338 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:55:32.744646 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:55:32.745325 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.09397992, "process_user_time": 1.157132, "process_kernel_time": 0.221408, "process_mem_max_rss": "170100", "process_out_blocks": "1339", "process_in_blocks": "0"}
[0m09:55:32.745558 [debug] [MainThread]: Command `dbt deps` succeeded at 09:55:32.745508 after 0.09 seconds
[0m09:55:32.745724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ef058b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ea6f980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee1ef60>]}
[0m09:55:32.745882 [debug] [MainThread]: Flushing usage events
[0m09:55:35.481594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ae88bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9af21220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9af23470>]}


============================== 09:55:35.484550 | 56f9e0b6-8bd4-426f-b87c-38d65d05ae39 ==============================
[0m09:55:35.484550 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:55:35.485039 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m09:55:35.901400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56f9e0b6-8bd4-426f-b87c-38d65d05ae39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ad77440>]}
[0m09:55:35.932692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56f9e0b6-8bd4-426f-b87c-38d65d05ae39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff68170>]}
[0m09:55:35.933031 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:55:35.936567 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:55:35.951594 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:55:35.951770 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:55:35.954088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56f9e0b6-8bd4-426f-b87c-38d65d05ae39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79d9db20>]}
[0m09:55:35.961504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56f9e0b6-8bd4-426f-b87c-38d65d05ae39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79cd93a0>]}
[0m09:55:35.961691 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:55:35.962033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56f9e0b6-8bd4-426f-b87c-38d65d05ae39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7abf75c0>]}
[0m09:55:35.962780 [info ] [MainThread]: 
[0m09:55:35.963269 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:55:35.963803 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m09:55:35.969087 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m09:55:35.969237 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:55:35.969348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:55:36.138580 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:55:36.138879 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:55:36.139097 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m09:55:36.139250 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:55:36.139427 [debug] [ThreadPool]: On list_CAR_SALES_DBB: No close available on handle
[0m09:55:36.140193 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:55:36.140415 [debug] [MainThread]: Connection 'list_CAR_SALES_DBB' was properly closed.
[0m09:55:36.140646 [info ] [MainThread]: 
[0m09:55:36.141049 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m09:55:36.141301 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "CAR_SALES_DBB"
  Database Error
    250001 (08001): Failed to connect to DB: sfedu02-lvb17920.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m09:55:36.141827 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6818456, "process_user_time": 2.209404, "process_kernel_time": 0.142901, "process_mem_max_rss": "209968", "process_out_blocks": "911", "command_success": false, "process_in_blocks": "0"}
[0m09:55:36.142110 [debug] [MainThread]: Command `dbt run` failed at 09:55:36.142036 after 0.68 seconds
[0m09:55:36.142333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9af23470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79b28410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79c752b0>]}
[0m09:55:36.142565 [debug] [MainThread]: Flushing usage events
[0m09:58:10.403380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ddc4b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9de070e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9de063f0>]}


============================== 09:58:10.412905 | 47a4c7d7-a3e5-40f5-9188-479ac63446ba ==============================
[0m09:58:10.412905 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:58:10.416899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:58:10.490602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47a4c7d7-a3e5-40f5-9188-479ac63446ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c8bf20>]}
[0m09:58:10.491309 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:58:10.493157 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:58:10.494203 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.11769517, "process_user_time": 2.10477, "process_kernel_time": 0.292792, "process_mem_max_rss": "170096", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m09:58:10.494498 [debug] [MainThread]: Command `dbt deps` succeeded at 09:58:10.494443 after 0.12 seconds
[0m09:58:10.494733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e6292b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e2a9460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dcc5fd0>]}
[0m09:58:10.494995 [debug] [MainThread]: Flushing usage events
[0m09:58:13.432982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff908fc680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90ef6420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90dfcbc0>]}


============================== 09:58:13.436224 | 59e52b93-3397-4379-9cbf-1102a9bb16fa ==============================
[0m09:58:13.436224 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:58:13.436501 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:58:13.863607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7104aab0>]}
[0m09:58:13.895968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83beaed0>]}
[0m09:58:13.896401 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:58:13.899873 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:58:13.904666 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m09:58:13.904971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cdcf950>]}
[0m09:58:14.432423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ab2efc0>]}
[0m09:58:14.437793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ab2efc0>]}
[0m09:58:14.437973 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:58:14.438328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59e52b93-3397-4379-9cbf-1102a9bb16fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b614080>]}
[0m09:58:14.439055 [info ] [MainThread]: 
[0m09:58:14.439462 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:58:14.439966 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m09:58:14.445179 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m09:58:14.445338 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:58:14.445456 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:14.596699 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m09:58:14.596954 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:58:14.597156 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m09:58:14.597301 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:58:14.597489 [debug] [ThreadPool]: On list_CAR_SALES_DBB: No close available on handle
[0m09:58:14.598169 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:58:14.598351 [debug] [MainThread]: Connection 'list_CAR_SALES_DBB' was properly closed.
[0m09:58:14.598513 [info ] [MainThread]: 
[0m09:58:14.598922 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m09:58:14.599287 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "CAR_SALES_DBB"
  Database Error
    250003 (08001): 404 Not Found: post https://RABBIT.snowflakecomputing.com:443/session/v1/login-request?request_id=c1d3800c-f060-491b-9bb9-e8a27e86592a&databaseName=CAR_SALES_DBB&schemaName=analytics&warehouse=RABBIT_WH&roleName=TRAINING_ROLE&request_guid=8c9af372-8f9e-4bea-a348-cd266a9de82c
[0m09:58:14.599985 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1891544, "process_user_time": 2.776458, "process_kernel_time": 0.160822, "process_mem_max_rss": "223408", "process_out_blocks": "1781", "command_success": false, "process_in_blocks": "0"}
[0m09:58:14.600480 [debug] [MainThread]: Command `dbt run` failed at 09:58:14.600420 after 1.19 seconds
[0m09:58:14.600657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff908b5f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6abcede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a3baab0>]}
[0m09:58:14.600868 [debug] [MainThread]: Flushing usage events
[0m10:08:09.691547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb07a87a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0afb860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb07aa1e0>]}


============================== 10:08:09.697750 | 40a2b510-cd74-4b4f-9ad3-2c7492786a4b ==============================
[0m10:08:09.697750 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:08:09.699586 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:08:09.783342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40a2b510-cd74-4b4f-9ad3-2c7492786a4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16fc740>]}
[0m10:08:09.784169 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:08:09.785575 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:08:09.786378 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.13770704, "process_user_time": 1.607835, "process_kernel_time": 0.334657, "process_mem_max_rss": "170100", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m10:08:09.786721 [debug] [MainThread]: Command `dbt deps` succeeded at 10:08:09.786665 after 0.14 seconds
[0m10:08:09.786911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16fc740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1491700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0649790>]}
[0m10:08:09.787095 [debug] [MainThread]: Flushing usage events
[0m10:08:11.873971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb96e6a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7ca7740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9de6fc0>]}


============================== 10:08:11.877653 | 1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7 ==============================
[0m10:08:11.877653 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:08:11.878294 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:08:12.331447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff991130e0>]}
[0m10:08:12.367824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99132930>]}
[0m10:08:12.368245 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:08:12.371765 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:08:12.376681 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:08:12.376951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9264c800>]}
[0m10:08:12.908326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91b51e80>]}
[0m10:08:12.913692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff924bb770>]}
[0m10:08:12.913902 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:08:12.914328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91b8ddf0>]}
[0m10:08:12.915153 [info ] [MainThread]: 
[0m10:08:12.915638 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:08:12.916218 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:08:12.921607 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:08:12.921764 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:08:12.921881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:13.663186 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:08:13.665130 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:08:13.784290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m10:08:13.795311 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:08:13.795820 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:08:13.796194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:14.349302 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:08:14.353195 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:08:14.513709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:08:14.519421 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:08:14.521281 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:08:14.521916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:15.141087 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.0 seconds
[0m10:08:15.145176 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:08:15.268741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91b26000>]}
[0m10:08:15.270482 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:08:15.272582 [info ] [MainThread]: 
[0m10:08:15.285444 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m10:08:15.286464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now model.btc_elt.stg_btc_market)
[0m10:08:15.286844 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m10:08:15.295738 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m10:08:15.298479 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 10:08:15.287095 => 10:08:15.298318
[0m10:08:15.299137 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m10:08:15.299427 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m10:08:15.300031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m10:08:15.300310 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m10:08:15.302362 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m10:08:15.303150 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 10:08:15.300481 => 10:08:15.303027
[0m10:08:15.303682 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m10:08:15.304236 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m10:08:15.304603 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m10:08:15.305360 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m10:08:15.305583 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m10:08:15.327080 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m10:08:15.328133 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 10:08:15.305726 => 10:08:15.328033
[0m10:08:15.328321 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m10:08:15.339956 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m10:08:15.343987 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m10:08:15.344249 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m10:08:15.344532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:17.529630 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m10:08:17.555955 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 10:08:15.328453 => 10:08:17.555654
[0m10:08:17.556518 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m10:08:17.661944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea80c0d-f4a4-40d1-acdb-8aa005f5c8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90bb8ec0>]}
[0m10:08:17.663364 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.36s]
[0m10:08:17.666180 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m10:08:17.669603 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:08:17.670095 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m10:08:17.670579 [info ] [MainThread]: 
[0m10:08:17.671247 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.76 seconds (4.76s).
[0m10:08:17.672112 [debug] [MainThread]: Command end result
[0m10:08:17.687764 [info ] [MainThread]: 
[0m10:08:17.688261 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:08:17.688702 [info ] [MainThread]: 
[0m10:08:17.689043 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:08:17.691528 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.8419156, "process_user_time": 3.016631, "process_kernel_time": 0.20738, "process_mem_max_rss": "220452", "process_in_blocks": "8", "process_out_blocks": "2826"}
[0m10:08:17.692102 [debug] [MainThread]: Command `dbt run` succeeded at 10:08:17.692007 after 5.84 seconds
[0m10:08:17.692518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9de6fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8906000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb79ed3a0>]}
[0m10:08:17.692803 [debug] [MainThread]: Flushing usage events
[0m10:08:20.626817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa09fc650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa09fc5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa09fee40>]}


============================== 10:08:20.629835 | b43a7d49-ced6-4fe4-b1de-519c97209aaa ==============================
[0m10:08:20.629835 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:08:20.630453 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:08:21.024807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80673080>]}
[0m10:08:21.057388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b7d57c0>]}
[0m10:08:21.057821 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:08:21.061435 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:08:21.075917 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:08:21.076089 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:08:21.078432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b5a3c20>]}
[0m10:08:21.084111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b574440>]}
[0m10:08:21.084313 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:08:21.084654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b8349b0>]}
[0m10:08:21.085441 [info ] [MainThread]: 
[0m10:08:21.085859 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:08:21.086443 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_analytics'
[0m10:08:21.092296 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:08:21.092450 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:08:21.092583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:21.599780 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m10:08:21.602304 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:08:21.752026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:08:21.758419 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:08:21.759145 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:08:21.759586 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:22.236383 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:08:22.239730 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:08:22.394146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b43a7d49-ced6-4fe4-b1de-519c97209aaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a18590>]}
[0m10:08:22.410898 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:08:22.411865 [info ] [MainThread]: 
[0m10:08:22.422487 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:08:22.422993 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m10:08:22.423979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m10:08:22.424359 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:08:22.436079 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:08:22.437376 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 10:08:22.424621 => 10:08:22.437223
[0m10:08:22.437616 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:08:22.448660 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:08:22.450170 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:08:22.450419 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m10:08:22.450623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:22.940076 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:08:22.951846 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 10:08:22.437793 => 10:08:22.951438
[0m10:08:22.952636 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m10:08:23.400187 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.98s]
[0m10:08:23.402491 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:08:23.403080 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:08:23.403593 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m10:08:23.404602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m10:08:23.404953 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:08:23.409723 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:08:23.411554 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 10:08:23.405211 => 10:08:23.411386
[0m10:08:23.411850 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:08:23.415405 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:08:23.416433 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:08:23.416683 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m10:08:23.416933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:24.577016 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:08:24.581137 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 10:08:23.412063 => 10:08:24.580892
[0m10:08:24.581559 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m10:08:24.679147 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 1.27s]
[0m10:08:24.682878 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:08:24.683640 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:08:24.684337 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m10:08:24.685684 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m10:08:24.686079 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:08:24.694147 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:08:24.696578 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 10:08:24.686336 => 10:08:24.696432
[0m10:08:24.696851 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:08:24.698969 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:08:24.700441 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:08:24.700752 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m10:08:24.701063 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:25.468020 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:08:25.471589 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 10:08:24.697036 => 10:08:25.471032
[0m10:08:25.472316 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m10:08:25.588091 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.90s]
[0m10:08:25.589445 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:08:25.593495 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:08:25.594161 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m10:08:25.594693 [info ] [MainThread]: 
[0m10:08:25.595843 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 4.51 seconds (4.51s).
[0m10:08:25.597755 [debug] [MainThread]: Command end result
[0m10:08:25.613763 [info ] [MainThread]: 
[0m10:08:25.614784 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:08:25.615079 [info ] [MainThread]: 
[0m10:08:25.615553 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:08:25.617847 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.0110774, "process_user_time": 2.591832, "process_kernel_time": 0.201463, "process_mem_max_rss": "208828", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m10:08:25.618420 [debug] [MainThread]: Command `dbt test` succeeded at 10:08:25.618323 after 5.01 seconds
[0m10:08:25.618803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0e0e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80787740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1d216a0>]}
[0m10:08:25.619163 [debug] [MainThread]: Flushing usage events
[0m10:08:28.228152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a8004d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a8951f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a89a180>]}


============================== 10:08:28.231364 | c40ca26c-c3d8-4952-b37d-0053edba1980 ==============================
[0m10:08:28.231364 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:08:28.231838 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:08:28.635615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a7fd280>]}
[0m10:08:28.673807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff699c3980>]}
[0m10:08:28.674329 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:08:28.678684 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:08:28.697853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:08:28.698158 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:08:28.701083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff596468d0>]}
[0m10:08:28.713829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff593b12e0>]}
[0m10:08:28.714150 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:08:28.715026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff596ab170>]}
[0m10:08:28.716535 [info ] [MainThread]: 
[0m10:08:28.717347 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:08:28.719891 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:08:28.728446 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:08:28.728762 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:08:28.728945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:29.249506 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:08:29.252257 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:08:29.369799 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:08:29.377083 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:08:29.377462 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:08:29.377690 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:29.826383 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:08:29.828129 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:08:29.992320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:08:30.005881 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:08:30.006753 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:08:30.008225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:30.480738 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:08:30.482574 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:08:30.590187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59348d40>]}
[0m10:08:30.591365 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:08:30.594383 [info ] [MainThread]: 
[0m10:08:30.605070 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m10:08:30.605540 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m10:08:30.606081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m10:08:30.606320 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m10:08:30.613471 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 10:08:30.606507 => 10:08:30.613325
[0m10:08:30.613701 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m10:08:30.642958 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m10:08:30.644220 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:08:30.644415 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

    ) sbq



        );
[0m10:08:30.644590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:32.272386 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m10:08:32.298936 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 10:08:30.613856 => 10:08:32.298730
[0m10:08:32.299643 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m10:08:32.402138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff593b1250>]}
[0m10:08:32.403082 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 1.80s]
[0m10:08:32.404093 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m10:08:32.404504 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m10:08:32.404962 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m10:08:32.405760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m10:08:32.406047 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m10:08:32.408813 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 10:08:32.406254 => 10:08:32.408662
[0m10:08:32.409095 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m10:08:32.411776 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m10:08:32.414450 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:08:32.414802 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

    ) sbq



        );
[0m10:08:32.415072 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:33.703569 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:08:33.707178 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 10:08:32.409283 => 10:08:33.706957
[0m10:08:33.707697 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m10:08:33.856025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c40ca26c-c3d8-4952-b37d-0053edba1980', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff58802840>]}
[0m10:08:33.857826 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.45s]
[0m10:08:33.860345 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m10:08:33.863620 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:08:33.864050 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m10:08:33.864478 [info ] [MainThread]: 
[0m10:08:33.865227 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 5.15 seconds (5.15s).
[0m10:08:33.866139 [debug] [MainThread]: Command end result
[0m10:08:33.877862 [info ] [MainThread]: 
[0m10:08:33.878400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:08:33.879179 [info ] [MainThread]: 
[0m10:08:33.879741 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:08:33.881788 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 5.676097, "process_user_time": 2.551937, "process_kernel_time": 0.213084, "process_mem_max_rss": "208892", "process_out_blocks": "1797", "process_in_blocks": "0"}
[0m10:08:33.882425 [debug] [MainThread]: Command `dbt snapshot` succeeded at 10:08:33.882330 after 5.68 seconds
[0m10:08:33.882857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a479850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59548dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7abecc20>]}
[0m10:08:33.883118 [debug] [MainThread]: Flushing usage events
[0m10:13:15.370703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae7d5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae7d6150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae7d6a50>]}


============================== 10:13:15.375177 | e01a9159-8e64-4b84-ad75-d24dad45968a ==============================
[0m10:13:15.375177 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:13:15.375647 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:13:15.425037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e01a9159-8e64-4b84-ad75-d24dad45968a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaed1ea20>]}
[0m10:13:15.425475 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:13:15.426449 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:13:15.427021 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.07794192, "process_user_time": 1.029237, "process_kernel_time": 0.069083, "process_mem_max_rss": "170156", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m10:13:15.427249 [debug] [MainThread]: Command `dbt deps` succeeded at 10:13:15.427191 after 0.08 seconds
[0m10:13:15.427425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb37b6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae81f650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae7d5e50>]}
[0m10:13:15.427611 [debug] [MainThread]: Flushing usage events
[0m10:13:17.409230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b3a9580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b797980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b872180>]}


============================== 10:13:17.412162 | 3a85f3ff-d8a2-4184-9f86-b621d5fa4c96 ==============================
[0m10:13:17.412162 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:13:17.412503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:13:17.773433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e597470>]}
[0m10:13:17.806317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff578f0e60>]}
[0m10:13:17.806671 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:13:17.809978 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:13:17.825669 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:13:17.825828 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:13:17.828052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5640c0e0>]}
[0m10:13:17.833868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5618cce0>]}
[0m10:13:17.834052 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:13:17.834215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b228830>]}
[0m10:13:17.834975 [info ] [MainThread]: 
[0m10:13:17.835311 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:13:17.835875 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:13:17.841078 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:13:17.841233 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:13:17.841363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:18.368077 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:13:18.370924 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:13:18.495466 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:13:18.506576 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:13:18.507111 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:13:18.507573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:18.942988 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:13:18.946603 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:13:19.045894 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:13:19.051641 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:13:19.052211 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:13:19.052571 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:19.412178 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:13:19.415030 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:13:19.522562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff55efaa20>]}
[0m10:13:19.524265 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:13:19.524952 [info ] [MainThread]: 
[0m10:13:19.535527 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m10:13:19.536375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m10:13:19.536768 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m10:13:19.546225 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m10:13:19.547782 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 10:13:19.537061 => 10:13:19.547617
[0m10:13:19.548452 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m10:13:19.548766 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m10:13:19.549493 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m10:13:19.549754 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m10:13:19.552061 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m10:13:19.553040 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 10:13:19.549921 => 10:13:19.552901
[0m10:13:19.553540 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m10:13:19.554174 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m10:13:19.554448 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m10:13:19.555040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m10:13:19.555251 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m10:13:19.578304 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m10:13:19.580214 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 10:13:19.555401 => 10:13:19.580068
[0m10:13:19.580435 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m10:13:19.594672 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m10:13:19.599086 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m10:13:19.599442 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m10:13:19.599763 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:20.932730 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:13:20.958260 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 10:13:19.580567 => 10:13:20.957983
[0m10:13:20.958835 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m10:13:21.058882 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a85f3ff-d8a2-4184-9f86-b621d5fa4c96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff555fc260>]}
[0m10:13:21.059752 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.50s]
[0m10:13:21.060482 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m10:13:21.062557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:21.062901 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m10:13:21.067114 [info ] [MainThread]: 
[0m10:13:21.067522 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.23 seconds (3.23s).
[0m10:13:21.068273 [debug] [MainThread]: Command end result
[0m10:13:21.083075 [info ] [MainThread]: 
[0m10:13:21.084872 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:21.085323 [info ] [MainThread]: 
[0m10:13:21.085623 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:13:21.087539 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6997824, "process_user_time": 2.699013, "process_kernel_time": 0.133198, "process_mem_max_rss": "211076", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m10:13:21.088209 [debug] [MainThread]: Command `dbt run` succeeded at 10:13:21.088131 after 3.70 seconds
[0m10:13:21.088694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b797980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b228830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56e66cc0>]}
[0m10:13:21.090411 [debug] [MainThread]: Flushing usage events
[0m10:13:23.393797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a85490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a84500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a86150>]}


============================== 10:13:23.396768 | 3a27756a-d99f-40ba-b022-4df7da4098bd ==============================
[0m10:13:23.396768 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:13:23.397058 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:13:23.811003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94b65280>]}
[0m10:13:23.842173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf2835c0>]}
[0m10:13:23.842501 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:13:23.846047 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:13:23.862966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:13:23.863182 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:13:23.866035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf283590>]}
[0m10:13:23.872204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff948dcf80>]}
[0m10:13:23.872429 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:13:23.872808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9496e6c0>]}
[0m10:13:23.873565 [info ] [MainThread]: 
[0m10:13:23.873990 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:13:23.874611 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_snapshot'
[0m10:13:23.880700 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:13:23.881253 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:13:23.881607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:24.290523 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:13:24.292668 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:13:24.426030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:13:24.431718 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:13:24.432586 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:13:24.433221 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:24.884428 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:13:24.887906 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:13:24.991101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a27756a-d99f-40ba-b022-4df7da4098bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94817dd0>]}
[0m10:13:24.993026 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:13:24.993954 [info ] [MainThread]: 
[0m10:13:25.007368 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:13:25.007936 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m10:13:25.008685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m10:13:25.009027 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:13:25.020994 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:13:25.022510 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 10:13:25.009274 => 10:13:25.022319
[0m10:13:25.022849 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:13:25.034610 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:13:25.035871 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:13:25.036110 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m10:13:25.036297 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:25.544585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:13:25.555294 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 10:13:25.023061 => 10:13:25.554738
[0m10:13:25.556282 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m10:13:25.676031 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.67s]
[0m10:13:25.678326 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:13:25.679043 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:13:25.679686 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m10:13:25.680970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m10:13:25.681566 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:13:25.687948 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:13:25.690997 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 10:13:25.681937 => 10:13:25.690676
[0m10:13:25.691553 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:13:25.696026 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:13:25.697548 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:13:25.697958 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m10:13:25.698307 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:26.129196 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:13:26.133474 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 10:13:25.691868 => 10:13:26.132911
[0m10:13:26.136916 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m10:13:26.278117 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.60s]
[0m10:13:26.279977 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:13:26.280745 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:13:26.281399 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m10:13:26.282749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m10:13:26.283308 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:13:26.292700 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:13:26.294606 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 10:13:26.283621 => 10:13:26.294328
[0m10:13:26.295027 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:13:26.297789 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:13:26.299627 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:13:26.300046 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m10:13:26.300460 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:26.745440 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:13:26.754111 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 10:13:26.295301 => 10:13:26.753451
[0m10:13:26.758012 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m10:13:26.893189 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.61s]
[0m10:13:26.894569 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:13:26.896064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:26.896317 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m10:13:26.896549 [info ] [MainThread]: 
[0m10:13:26.896855 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.02 seconds (3.02s).
[0m10:13:26.897532 [debug] [MainThread]: Command end result
[0m10:13:26.904249 [info ] [MainThread]: 
[0m10:13:26.904785 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:26.905198 [info ] [MainThread]: 
[0m10:13:26.906052 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:13:26.907174 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5351787, "process_user_time": 2.615595, "process_kernel_time": 0.157739, "process_mem_max_rss": "209292", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m10:13:26.907697 [debug] [MainThread]: Command `dbt test` succeeded at 10:13:26.907625 after 3.54 seconds
[0m10:13:26.907972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb60adbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a43170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ab5dcd0>]}
[0m10:13:26.908260 [debug] [MainThread]: Flushing usage events
[0m10:13:29.635820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff938f09e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff939d6420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95088f20>]}


============================== 10:13:29.638807 | 05a82709-bef3-44d2-bc59-e3a50bc04994 ==============================
[0m10:13:29.638807 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:13:29.639111 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:13:30.037126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e3834a0>]}
[0m10:13:30.068027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6eec1490>]}
[0m10:13:30.068372 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:13:30.071575 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:13:30.085216 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:13:30.085401 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:13:30.087648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e28a750>]}
[0m10:13:30.093733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6df911f0>]}
[0m10:13:30.093967 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:13:30.094252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e0ec710>]}
[0m10:13:30.095045 [info ] [MainThread]: 
[0m10:13:30.095419 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:13:30.095956 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:13:30.101160 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:13:30.101324 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:13:30.101461 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:30.497673 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m10:13:30.499303 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:13:30.600690 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m10:13:30.608190 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:13:30.608567 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:13:30.608893 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:30.999773 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:13:31.002811 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:13:31.098828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:13:31.101458 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:13:31.101762 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:13:31.102299 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:31.473740 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:13:31.477132 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:13:31.581215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6dfbbe60>]}
[0m10:13:31.582847 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:13:31.583446 [info ] [MainThread]: 
[0m10:13:31.595802 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m10:13:31.596514 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m10:13:31.597304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now snapshot.btc_elt.snap_btc_market)
[0m10:13:31.597651 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m10:13:31.604754 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 10:13:31.597889 => 10:13:31.604575
[0m10:13:31.605059 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m10:13:31.636689 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:31.636914 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:13:31.637095 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:32.324835 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:13:32.337814 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:32.338807 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:13:32.418236 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:13:32.429081 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:32.429887 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:13:32.510627 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:13:32.535067 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:32.535541 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:13:33.648512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:13:33.654273 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:33.655014 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:13:33.740539 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:13:33.744501 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:33.744961 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:13:33.815148 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:13:33.820969 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:33.821834 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:13:33.938082 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:13:33.944877 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:33.945883 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:13:34.033826 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:13:34.045337 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:34.046221 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:13:34.130382 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:13:34.142740 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m10:13:34.146178 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:34.146818 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m10:13:34.243548 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:13:34.244604 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:13:34.245379 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:13:34.619504 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08f25-0307-19b7-000f-c0df0089dff6
[0m10:13:34.620461 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m10:13:34.621402 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 10:13:31.605262 => 10:13:34.621082
[0m10:13:34.622034 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m10:13:34.740698 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:13:34.741568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d4dbce0>]}
[0m10:13:34.742552 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 3.14s]
[0m10:13:34.743407 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m10:13:34.744069 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m10:13:34.745349 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m10:13:34.746124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m10:13:34.746523 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m10:13:34.750332 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 10:13:34.746767 => 10:13:34.750132
[0m10:13:34.750709 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m10:13:34.754497 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:34.754811 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:13:34.755086 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:35.304916 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:13:35.310985 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:35.311968 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:13:35.410394 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:13:35.417395 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:35.417970 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:13:35.487724 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:13:35.492163 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:35.492513 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:13:36.281821 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:13:36.287291 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.287979 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:13:36.363834 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:13:36.370727 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.371694 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:13:36.478024 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:13:36.484235 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.484987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:13:36.588508 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:13:36.595101 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.595841 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:13:36.667709 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:13:36.675391 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.677090 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:13:36.766039 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:13:36.769218 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.770626 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.770909 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m10:13:36.859729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:13:36.860041 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:36.860249 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:13:38.085338 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:13:38.087309 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:13:38.088016 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m10:13:38.460577 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:13:38.482652 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 10:13:34.750984 => 10:13:38.482412
[0m10:13:38.483215 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m10:13:38.579682 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05a82709-bef3-44d2-bc59-e3a50bc04994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d3dd8e0>]}
[0m10:13:38.581362 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.83s]
[0m10:13:38.585901 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m10:13:38.588893 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:38.589322 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m10:13:38.589709 [info ] [MainThread]: 
[0m10:13:38.590093 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.49 seconds (8.49s).
[0m10:13:38.591056 [debug] [MainThread]: Command end result
[0m10:13:38.604480 [info ] [MainThread]: 
[0m10:13:38.605030 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:13:38.605733 [info ] [MainThread]: 
[0m10:13:38.606029 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:13:38.606334 [info ] [MainThread]: 
[0m10:13:38.606608 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m10:13:38.607700 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 8.994187, "process_user_time": 2.917838, "process_kernel_time": 0.231125, "process_mem_max_rss": "215220", "process_out_blocks": "1837", "command_success": false, "process_in_blocks": "0"}
[0m10:13:38.608142 [debug] [MainThread]: Command `dbt snapshot` failed at 10:13:38.608049 after 8.99 seconds
[0m10:13:38.608539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff938f09e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f9f2750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9385a660>]}
[0m10:13:38.608806 [debug] [MainThread]: Flushing usage events
[0m10:14:12.675124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b8edd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b85c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99bc7e30>]}


============================== 10:14:12.678380 | 7adbd04b-460e-4da3-93e7-6e60ce87f626 ==============================
[0m10:14:12.678380 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:14:12.678816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:14:12.728700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7adbd04b-460e-4da3-93e7-6e60ce87f626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a7dc5c0>]}
[0m10:14:12.729099 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:14:12.730128 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:14:12.730640 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.07598771, "process_user_time": 1.043051, "process_kernel_time": 0.073861, "process_mem_max_rss": "170156", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m10:14:12.730856 [debug] [MainThread]: Command `dbt deps` succeeded at 10:14:12.730798 after 0.08 seconds
[0m10:14:12.731028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a7dc5c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99addaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99bc4110>]}
[0m10:14:12.731188 [debug] [MainThread]: Flushing usage events
[0m10:14:15.030406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90378e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90378a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff903782f0>]}


============================== 10:14:15.033809 | 54b7990e-e99c-424a-94e0-123e34fc2702 ==============================
[0m10:14:15.033809 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:14:15.034422 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:14:15.711170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83591730>]}
[0m10:14:15.774303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b906780>]}
[0m10:14:15.778949 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:14:15.805927 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:14:15.876664 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:14:15.877319 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:14:15.881137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6af07a10>]}
[0m10:14:15.890254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6afb0410>]}
[0m10:14:15.890573 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:14:15.890997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b23eed0>]}
[0m10:14:15.891973 [info ] [MainThread]: 
[0m10:14:15.892477 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:14:15.893132 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:14:15.901081 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:14:15.901399 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:14:15.901575 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:16.443769 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:14:16.469996 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:14:16.607394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:14:16.636486 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:14:16.638869 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:14:16.641285 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:14:17.928372 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m10:14:17.934578 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:14:18.100491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:14:18.111151 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:14:18.111937 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:14:18.112175 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:14:18.511385 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:14:18.513408 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:14:18.634193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff835ba6c0>]}
[0m10:14:18.635840 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:14:18.639035 [info ] [MainThread]: 
[0m10:14:18.666251 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m10:14:18.669978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m10:14:18.671173 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m10:14:18.708984 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m10:14:18.712263 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 10:14:18.674339 => 10:14:18.711751
[0m10:14:18.715119 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m10:14:18.715777 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m10:14:18.717453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m10:14:18.718105 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m10:14:18.722307 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m10:14:18.725243 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 10:14:18.718360 => 10:14:18.724606
[0m10:14:18.727036 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m10:14:18.734131 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m10:14:18.735052 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m10:14:18.737369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m10:14:18.738014 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m10:14:18.790166 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m10:14:18.792423 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 10:14:18.738383 => 10:14:18.792094
[0m10:14:18.793013 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m10:14:18.826380 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m10:14:18.832853 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m10:14:18.833371 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m10:14:18.834098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:20.122926 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:14:20.183053 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 10:14:18.793270 => 10:14:20.182274
[0m10:14:20.184428 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m10:14:20.317183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '54b7990e-e99c-424a-94e0-123e34fc2702', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a5fb3b0>]}
[0m10:14:20.319005 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.58s]
[0m10:14:20.322962 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m10:14:20.326093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:14:20.326743 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m10:14:20.327209 [info ] [MainThread]: 
[0m10:14:20.328085 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.43 seconds (4.43s).
[0m10:14:20.329213 [debug] [MainThread]: Command end result
[0m10:14:20.351051 [info ] [MainThread]: 
[0m10:14:20.351964 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:14:20.352975 [info ] [MainThread]: 
[0m10:14:20.353687 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:14:20.357019 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.350248, "process_user_time": 3.631867, "process_kernel_time": 0.211167, "process_mem_max_rss": "213008", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m10:14:20.358959 [debug] [MainThread]: Command `dbt run` succeeded at 10:14:20.358741 after 5.35 seconds
[0m10:14:20.441113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90378e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff901f49e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b23fef0>]}
[0m10:14:20.442106 [debug] [MainThread]: Flushing usage events
[0m10:14:23.268713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9485a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95429280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94c6b440>]}


============================== 10:14:23.276031 | 6ca498d7-7bae-44ae-b812-5c78c2728763 ==============================
[0m10:14:23.276031 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:14:23.277082 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:14:23.722774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74d9e750>]}
[0m10:14:23.839080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f55d280>]}
[0m10:14:23.840352 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:14:23.849988 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:14:23.876870 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:14:23.877286 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:14:23.882591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6fa34860>]}
[0m10:14:23.893019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f62c8c0>]}
[0m10:14:23.894365 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:14:23.895606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f564aa0>]}
[0m10:14:23.901804 [info ] [MainThread]: 
[0m10:14:23.903187 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:14:23.904732 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_analytics'
[0m10:14:23.912178 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:14:23.912558 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:14:23.912752 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:24.980741 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m10:14:24.984509 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:14:25.099683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:14:25.106991 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:14:25.111342 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:14:25.111757 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:14:25.524022 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:14:25.527218 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:14:25.681467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ca498d7-7bae-44ae-b812-5c78c2728763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f62e750>]}
[0m10:14:25.683888 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:14:25.688160 [info ] [MainThread]: 
[0m10:14:25.698724 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:14:25.699397 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m10:14:25.700605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m10:14:25.700971 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:14:25.714328 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:14:25.716394 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 10:14:25.701219 => 10:14:25.716234
[0m10:14:25.716646 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:14:25.727196 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:14:25.728555 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:14:25.728806 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m10:14:25.729018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:26.158527 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:14:26.166874 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 10:14:25.716818 => 10:14:26.166505
[0m10:14:26.167600 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m10:14:26.289523 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.59s]
[0m10:14:26.292454 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:14:26.293522 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:14:26.294285 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m10:14:26.296323 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m10:14:26.297220 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:14:26.304122 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:14:26.306688 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 10:14:26.297671 => 10:14:26.306311
[0m10:14:26.307258 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:14:26.311515 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:14:26.312856 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:14:26.313305 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m10:14:26.313690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:26.793933 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:14:26.800936 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 10:14:26.307586 => 10:14:26.800309
[0m10:14:26.802267 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m10:14:26.919872 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.62s]
[0m10:14:26.921518 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:14:26.922255 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:14:26.923313 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m10:14:26.925030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m10:14:26.925492 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:14:26.933152 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:14:26.934251 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 10:14:26.925980 => 10:14:26.934108
[0m10:14:26.934435 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:14:26.936199 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:14:26.937324 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:14:26.937658 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m10:14:26.937912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:27.513435 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:14:27.517619 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 10:14:26.934694 => 10:14:27.517199
[0m10:14:27.518471 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m10:14:27.625333 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.70s]
[0m10:14:27.626808 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:14:27.630604 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:14:27.631292 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m10:14:27.631841 [info ] [MainThread]: 
[0m10:14:27.633304 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m10:14:27.635111 [debug] [MainThread]: Command end result
[0m10:14:27.650558 [info ] [MainThread]: 
[0m10:14:27.651721 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:14:27.652026 [info ] [MainThread]: 
[0m10:14:27.652389 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:14:27.653988 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.4281187, "process_user_time": 3.069279, "process_kernel_time": 0.270758, "process_mem_max_rss": "212340", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m10:14:27.654546 [debug] [MainThread]: Command `dbt test` succeeded at 10:14:27.654402 after 4.43 seconds
[0m10:14:27.654963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95429280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94b9d6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f723890>]}
[0m10:14:27.655318 [debug] [MainThread]: Flushing usage events
[0m10:14:29.960558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa53df8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6e23380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa54ac830>]}


============================== 10:14:29.963813 | e79bde64-00f2-4543-a68e-54a69b8a064b ==============================
[0m10:14:29.963813 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:14:29.965312 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:14:30.401634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4ff3f20>]}
[0m10:14:30.433980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4ff2180>]}
[0m10:14:30.434426 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:14:30.437986 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:14:30.455521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:14:30.455711 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:14:30.458066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fe31dc0>]}
[0m10:14:30.463808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb68e90>]}
[0m10:14:30.464014 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:14:30.464364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4ff4800>]}
[0m10:14:30.465105 [info ] [MainThread]: 
[0m10:14:30.465522 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:14:30.466149 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:14:30.471642 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:14:30.471800 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:14:30.471931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:30.938335 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m10:14:30.940387 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:14:31.058510 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:14:31.067790 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:14:31.068493 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:14:31.068927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:14:31.400604 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:14:31.403741 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:14:31.533296 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:14:31.538775 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:14:31.539422 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:14:31.539869 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:14:31.987233 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:14:31.990304 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:14:32.115287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb11250>]}
[0m10:14:32.116897 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:14:32.118781 [info ] [MainThread]: 
[0m10:14:32.132279 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m10:14:32.133081 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m10:14:32.134391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m10:14:32.134762 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m10:14:32.141813 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 10:14:32.135047 => 10:14:32.141599
[0m10:14:32.142188 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m10:14:32.173751 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:32.174003 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:14:32.174205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:33.055692 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:14:33.067527 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:33.068242 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:14:33.171567 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:14:33.176773 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:33.177160 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:14:33.285701 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:14:33.300436 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:33.300768 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:14:34.439642 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:14:34.446103 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:34.446700 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:14:34.638577 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:14:34.645620 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:34.646605 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:14:34.727327 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:14:34.733354 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:34.734370 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:14:34.804758 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:14:34.809009 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:34.809524 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:14:34.893119 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:14:34.903428 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:34.904141 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:14:34.996167 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:14:35.008102 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m10:14:35.012690 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:35.013504 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m10:14:35.193169 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:14:35.194272 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:14:35.194987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:14:35.603822 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08f26-0307-1ab7-000f-c0df0089ede2
[0m10:14:35.604508 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m10:14:35.605042 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 10:14:32.142394 => 10:14:35.604823
[0m10:14:35.605490 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m10:14:35.705618 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:14:35.706238 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f1ed550>]}
[0m10:14:35.707313 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 3.57s]
[0m10:14:35.708570 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m10:14:35.708852 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m10:14:35.709747 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m10:14:35.710377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m10:14:35.710645 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m10:14:35.713163 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 10:14:35.710781 => 10:14:35.712878
[0m10:14:35.713406 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m10:14:35.716342 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:35.716595 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:14:35.716776 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:35.999959 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m10:14:36.001934 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:36.002358 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:14:36.087914 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:14:36.093612 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:36.094161 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:14:36.254094 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:14:36.266247 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:36.267341 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:14:37.264731 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:14:37.269592 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.270040 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:14:37.347859 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:14:37.354561 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.355470 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:14:37.442334 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:14:37.448886 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.449844 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:14:37.564258 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:14:37.570763 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.571663 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:14:37.641100 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:14:37.647911 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.648991 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:14:37.723460 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:14:37.729439 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.735349 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:37.736409 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m10:14:38.175134 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:14:38.176254 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:38.176910 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:14:38.701824 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:14:38.703208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:14:38.703926 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m10:14:39.111621 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:14:39.137109 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 10:14:35.713543 => 10:14:39.136874
[0m10:14:39.137670 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m10:14:39.242866 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e79bde64-00f2-4543-a68e-54a69b8a064b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb6a9f0>]}
[0m10:14:39.244550 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.53s]
[0m10:14:39.246547 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m10:14:39.250129 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:14:39.250647 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m10:14:39.251105 [info ] [MainThread]: 
[0m10:14:39.251968 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.79 seconds (8.79s).
[0m10:14:39.252961 [debug] [MainThread]: Command end result
[0m10:14:39.267417 [info ] [MainThread]: 
[0m10:14:39.268007 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:14:39.268372 [info ] [MainThread]: 
[0m10:14:39.268594 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:14:39.268920 [info ] [MainThread]: 
[0m10:14:39.269150 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m10:14:39.270881 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 9.334076, "process_user_time": 3.113794, "process_kernel_time": 0.267897, "process_mem_max_rss": "214900", "process_out_blocks": "1837", "command_success": false, "process_in_blocks": "0"}
[0m10:14:39.271312 [debug] [MainThread]: Command `dbt snapshot` failed at 10:14:39.271239 after 9.33 seconds
[0m10:14:39.271640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5406960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff847c1070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fff0e60>]}
[0m10:14:39.271885 [debug] [MainThread]: Flushing usage events
[0m10:17:25.080435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf915df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafd6f8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf916030>]}


============================== 10:17:25.085846 | 4b594946-72d6-4af8-b651-595dcf2fa237 ==============================
[0m10:17:25.085846 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:17:25.087192 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:17:25.153401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b594946-72d6-4af8-b651-595dcf2fa237', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf7da030>]}
[0m10:17:25.154067 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:17:25.156357 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:17:25.157354 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.13801834, "process_user_time": 1.477153, "process_kernel_time": 0.205216, "process_mem_max_rss": "170160", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m10:17:25.157825 [debug] [MainThread]: Command `dbt deps` succeeded at 10:17:25.157742 after 0.14 seconds
[0m10:17:25.158065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf7db110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf7da030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf872690>]}
[0m10:17:25.158277 [debug] [MainThread]: Flushing usage events
[0m10:17:27.972672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f402e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f6b2780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f364d40>]}


============================== 10:17:27.975946 | fa855234-85ac-40b3-932b-83273232849a ==============================
[0m10:17:27.975946 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:17:27.976275 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:17:28.420362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f1e2060>]}
[0m10:17:28.452704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b8c6840>]}
[0m10:17:28.453165 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:17:28.457092 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:17:28.472973 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:17:28.473234 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:17:28.475937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a032060>]}
[0m10:17:28.482369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79ee0800>]}
[0m10:17:28.482561 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:17:28.483031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a010770>]}
[0m10:17:28.483830 [info ] [MainThread]: 
[0m10:17:28.484339 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:17:28.484936 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:17:28.490265 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:17:28.490458 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:17:28.490679 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:29.309849 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:17:29.313433 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:17:29.415264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:17:29.430444 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:17:29.431125 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:17:29.431470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:30.437803 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m10:17:30.443322 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:17:30.554451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:17:30.560256 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:17:30.560740 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:17:30.561117 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:31.005886 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:17:31.009919 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:17:31.140173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a06d9d0>]}
[0m10:17:31.142269 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:17:31.146413 [info ] [MainThread]: 
[0m10:17:31.159714 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m10:17:31.160577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m10:17:31.161007 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m10:17:31.168614 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m10:17:31.171198 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 10:17:31.161267 => 10:17:31.170920
[0m10:17:31.172215 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m10:17:31.172598 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m10:17:31.173337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m10:17:31.173592 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m10:17:31.176167 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m10:17:31.177206 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 10:17:31.173830 => 10:17:31.177085
[0m10:17:31.177720 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m10:17:31.178144 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m10:17:31.178548 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m10:17:31.179566 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m10:17:31.179773 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m10:17:31.203151 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m10:17:31.204070 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 10:17:31.179896 => 10:17:31.203968
[0m10:17:31.204244 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m10:17:31.217215 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m10:17:31.220155 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m10:17:31.220435 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m10:17:31.220711 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:32.263500 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:17:32.284940 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 10:17:31.204347 => 10:17:32.284812
[0m10:17:32.285458 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m10:17:32.395117 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa855234-85ac-40b3-932b-83273232849a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a030dd0>]}
[0m10:17:32.396101 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.22s]
[0m10:17:32.397425 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m10:17:32.401850 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:17:32.402668 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m10:17:32.403156 [info ] [MainThread]: 
[0m10:17:32.404254 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.92 seconds (3.92s).
[0m10:17:32.405743 [debug] [MainThread]: Command end result
[0m10:17:32.418485 [info ] [MainThread]: 
[0m10:17:32.419121 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:17:32.419503 [info ] [MainThread]: 
[0m10:17:32.419837 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:17:32.421202 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.471562, "process_user_time": 2.953263, "process_kernel_time": 0.259401, "process_mem_max_rss": "212992", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m10:17:32.421640 [debug] [MainThread]: Command `dbt run` succeeded at 10:17:32.421566 after 4.47 seconds
[0m10:17:32.421926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f402e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f79c860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79e81880>]}
[0m10:17:32.422097 [debug] [MainThread]: Flushing usage events
[0m10:17:36.695359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cbf52b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b232d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aea6ff0>]}


============================== 10:17:36.701583 | 44486c6a-a630-4007-b09d-fcef1a23dbe9 ==============================
[0m10:17:36.701583 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:17:36.706694 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:17:38.146891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a2171a0>]}
[0m10:17:38.272057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69d487a0>]}
[0m10:17:38.273414 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:17:38.291233 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:17:38.336857 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:17:38.337427 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:17:38.342433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69d71ee0>]}
[0m10:17:38.354912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69ae0c20>]}
[0m10:17:38.355650 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:17:38.356387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69ea3e00>]}
[0m10:17:38.358214 [info ] [MainThread]: 
[0m10:17:38.359435 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:17:38.361820 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_snapshot'
[0m10:17:38.386025 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:17:38.387103 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:17:38.388435 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:38.834430 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m10:17:38.837412 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:17:38.931848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:17:38.938027 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:17:38.938618 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:17:38.939338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:39.401857 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:17:39.406863 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:17:39.514736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44486c6a-a630-4007-b09d-fcef1a23dbe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ff29580>]}
[0m10:17:39.520150 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:17:39.523005 [info ] [MainThread]: 
[0m10:17:39.538797 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:17:39.539982 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m10:17:39.541766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m10:17:39.542671 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:17:39.567297 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:17:39.573408 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 10:17:39.543066 => 10:17:39.572837
[0m10:17:39.574186 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:17:39.607459 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:17:39.608976 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:17:39.609534 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m10:17:39.609940 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:40.108903 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:17:40.113116 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 10:17:39.574455 => 10:17:40.113000
[0m10:17:40.113348 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m10:17:40.262889 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.72s]
[0m10:17:40.264264 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:17:40.264913 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:17:40.265533 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m10:17:40.266480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m10:17:40.266857 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:17:40.271483 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:17:40.273149 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 10:17:40.267089 => 10:17:40.272977
[0m10:17:40.273498 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:17:40.277715 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:17:40.279309 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:17:40.279619 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m10:17:40.279897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:40.771262 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:17:40.776937 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 10:17:40.273883 => 10:17:40.776463
[0m10:17:40.777894 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m10:17:40.885381 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.62s]
[0m10:17:40.888197 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:17:40.889353 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:17:40.890073 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m10:17:40.892049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m10:17:40.892766 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:17:40.901166 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:17:40.904420 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 10:17:40.893115 => 10:17:40.904215
[0m10:17:40.904758 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:17:40.907164 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:17:40.908686 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:17:40.908993 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m10:17:40.909287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:41.433856 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:17:41.436286 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 10:17:40.904968 => 10:17:41.436066
[0m10:17:41.436714 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m10:17:41.537405 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.65s]
[0m10:17:41.540047 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:17:41.544690 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:17:41.545581 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m10:17:41.546104 [info ] [MainThread]: 
[0m10:17:41.547488 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.19 seconds (3.19s).
[0m10:17:41.548658 [debug] [MainThread]: Command end result
[0m10:17:41.563182 [info ] [MainThread]: 
[0m10:17:41.564044 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:17:41.564374 [info ] [MainThread]: 
[0m10:17:41.564860 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:17:41.566775 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.9421043, "process_user_time": 5.389132, "process_kernel_time": 0.792988, "process_mem_max_rss": "212736", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m10:17:41.569025 [debug] [MainThread]: Command `dbt test` succeeded at 10:17:41.568942 after 4.94 seconds
[0m10:17:41.569390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff16a80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f614c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69c3dbb0>]}
[0m10:17:41.569739 [debug] [MainThread]: Flushing usage events
[0m10:17:43.853768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e650260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f8ed880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e6505f0>]}


============================== 10:17:43.856929 | 12ca5aed-68c6-475e-9133-e6bee475398f ==============================
[0m10:17:43.856929 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:17:43.857543 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:17:44.308501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d96f440>]}
[0m10:17:44.342683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b37d520>]}
[0m10:17:44.343152 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:17:44.347117 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:17:44.361952 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:17:44.362122 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:17:44.364480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4c9dc0>]}
[0m10:17:44.369747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d235190>]}
[0m10:17:44.369936 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:17:44.370276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d9c6780>]}
[0m10:17:44.371044 [info ] [MainThread]: 
[0m10:17:44.371448 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:17:44.372053 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:17:44.377507 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:17:44.377664 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:17:44.377784 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:44.812909 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m10:17:44.814535 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:17:44.917086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m10:17:44.928791 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:17:44.929413 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:17:44.929774 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:45.340066 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:17:45.342003 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:17:45.471840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:17:45.478446 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:17:45.479242 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:17:45.479767 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:46.097519 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m10:17:46.100824 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:17:46.192399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83670ad0>]}
[0m10:17:46.193434 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:17:46.194504 [info ] [MainThread]: 
[0m10:17:46.203057 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m10:17:46.203544 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m10:17:46.204267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m10:17:46.204528 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m10:17:46.210297 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 10:17:46.204715 => 10:17:46.210149
[0m10:17:46.210542 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m10:17:46.238969 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:46.239203 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:17:46.239383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:46.702526 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m10:17:46.721063 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:46.722064 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:17:46.814260 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:17:46.834167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:46.835068 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:17:46.927763 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:17:46.975824 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:46.977425 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:17:48.324413 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:17:48.331507 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.332148 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:17:48.404947 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:17:48.410140 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.410718 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:17:48.480816 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:17:48.487622 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.488337 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:17:48.577505 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:17:48.584628 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.585568 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m10:17:48.662761 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:17:48.674253 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.674847 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m10:17:48.770572 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m10:17:48.781189 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.783557 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.783846 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m10:17:48.959987 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:17:48.960901 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:17:48.961549 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:17:49.489787 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08f29-0307-19b7-000f-c0df008ac026
[0m10:17:49.491902 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m10:17:49.493316 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 10:17:46.210761 => 10:17:49.492770
[0m10:17:49.494062 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m10:17:49.628790 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:17:49.630771 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d19bb30>]}
[0m10:17:49.635033 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 3.43s]
[0m10:17:49.640441 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m10:17:49.641190 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m10:17:49.643486 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m10:17:49.644681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m10:17:49.645079 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m10:17:49.649409 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 10:17:49.645319 => 10:17:49.649226
[0m10:17:49.649729 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m10:17:49.653588 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:49.653946 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m10:17:49.654242 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:50.591409 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:17:50.600464 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:50.601501 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:17:50.693878 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:17:50.701033 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:50.701714 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:17:50.780044 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:17:50.795191 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:50.796923 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m10:17:51.652240 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:17:51.654273 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:51.654476 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:17:51.747320 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:17:51.749643 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:51.749886 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:17:51.814520 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:17:51.816998 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:51.817492 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:17:51.891106 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:17:51.893438 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:51.893692 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m10:17:51.998950 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m10:17:52.004040 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:52.004506 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m10:17:52.096192 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m10:17:52.101200 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:52.105010 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:52.105513 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m10:17:52.215696 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:17:52.217797 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:52.218478 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m10:17:52.740524 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m10:17:52.742947 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:17:52.743756 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m10:17:53.050011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:17:53.076871 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 10:17:49.649968 => 10:17:53.076630
[0m10:17:53.077324 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m10:17:53.186138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12ca5aed-68c6-475e-9133-e6bee475398f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c6a3bc0>]}
[0m10:17:53.187574 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.54s]
[0m10:17:53.190094 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m10:17:53.195323 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:17:53.195879 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m10:17:53.196322 [info ] [MainThread]: 
[0m10:17:53.196973 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.82 seconds (8.82s).
[0m10:17:53.197703 [debug] [MainThread]: Command end result
[0m10:17:53.208492 [info ] [MainThread]: 
[0m10:17:53.209213 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:17:53.209583 [info ] [MainThread]: 
[0m10:17:53.209936 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/btc_elt/snapshots/snap_btc_market.sql
[0m10:17:53.210251 [info ] [MainThread]: 
[0m10:17:53.210582 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m10:17:53.213136 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 9.381864, "process_user_time": 2.898657, "process_kernel_time": 0.24516, "process_mem_max_rss": "215160", "process_out_blocks": "1837", "command_success": false, "process_in_blocks": "0"}
[0m10:17:53.213922 [debug] [MainThread]: Command `dbt snapshot` failed at 10:17:53.213770 after 9.38 seconds
[0m10:17:53.214514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e34e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e60f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e60e1b0>]}
[0m10:17:53.214824 [debug] [MainThread]: Flushing usage events
[0m10:23:21.647266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff909f54f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90de0ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff909f4dd0>]}


============================== 10:23:21.655943 | ecaf34e3-9b58-4857-b2bc-ca63efe3dd3b ==============================
[0m10:23:21.655943 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:23:21.658371 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:23:21.752572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ecaf34e3-9b58-4857-b2bc-ca63efe3dd3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90ebdb50>]}
[0m10:23:21.753456 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:23:21.755199 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m10:23:21.756203 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.14837933, "process_user_time": 1.488427, "process_kernel_time": 0.187333, "process_mem_max_rss": "170160", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m10:23:21.756488 [debug] [MainThread]: Command `dbt deps` succeeded at 10:23:21.756438 after 0.15 seconds
[0m10:23:21.756665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90de0ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff909b2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90a8cf20>]}
[0m10:23:21.757044 [debug] [MainThread]: Flushing usage events
[0m10:23:25.400491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf16a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf59fe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf4b64e0>]}


============================== 10:23:25.403911 | 205643e0-585a-4c52-933c-9e387c7eda08 ==============================
[0m10:23:25.403911 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:23:25.404411 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:23:25.869318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dfae6c0>]}
[0m10:23:25.902879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf557b60>]}
[0m10:23:25.903362 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:23:25.907029 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:23:25.922260 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:23:25.922445 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:23:25.924740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8de7fbc0>]}
[0m10:23:25.930736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dce86e0>]}
[0m10:23:25.930971 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:23:25.931283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e10f2c0>]}
[0m10:23:25.932035 [info ] [MainThread]: 
[0m10:23:25.932423 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:23:25.932954 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:23:25.938275 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:23:25.938429 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:23:25.938545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:26.423527 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m10:23:26.426222 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:23:26.563135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m10:23:26.575370 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:23:26.576041 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:23:26.576431 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:26.996664 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:27.000910 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:23:27.138884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:23:27.140556 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:23:27.140857 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:23:27.141154 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:27.468557 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:23:27.469529 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:23:27.582617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc56ab0>]}
[0m10:23:27.583590 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:23:27.585022 [info ] [MainThread]: 
[0m10:23:27.593535 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m10:23:27.594071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now model.btc_elt.stg_btc_market)
[0m10:23:27.594380 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m10:23:27.599513 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m10:23:27.600981 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 10:23:27.594548 => 10:23:27.600866
[0m10:23:27.601479 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m10:23:27.601721 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m10:23:27.602219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m10:23:27.602390 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m10:23:27.604067 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m10:23:27.604921 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 10:23:27.602502 => 10:23:27.604774
[0m10:23:27.605355 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m10:23:27.606118 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m10:23:27.606469 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m10:23:27.607382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m10:23:27.607614 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m10:23:27.629054 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m10:23:27.629955 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 10:23:27.607819 => 10:23:27.629845
[0m10:23:27.630129 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m10:23:27.641559 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m10:23:27.644069 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m10:23:27.644341 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m10:23:27.644645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:29.478693 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m10:23:29.504972 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 10:23:27.630242 => 10:23:29.504735
[0m10:23:29.505473 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m10:23:29.608959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '205643e0-585a-4c52-933c-9e387c7eda08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db275f0>]}
[0m10:23:29.609796 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.00s]
[0m10:23:29.611752 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m10:23:29.613343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:29.613566 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m10:23:29.613823 [info ] [MainThread]: 
[0m10:23:29.614278 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.68 seconds (3.68s).
[0m10:23:29.614765 [debug] [MainThread]: Command end result
[0m10:23:29.621928 [info ] [MainThread]: 
[0m10:23:29.622297 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:23:29.622474 [info ] [MainThread]: 
[0m10:23:29.622776 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:23:29.623569 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2450213, "process_user_time": 2.706332, "process_kernel_time": 0.285368, "process_mem_max_rss": "213144", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m10:23:29.623863 [debug] [MainThread]: Command `dbt run` succeeded at 10:23:29.623793 after 4.25 seconds
[0m10:23:29.624064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf59fe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafa2d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e61ddf0>]}
[0m10:23:29.624250 [debug] [MainThread]: Flushing usage events
[0m10:23:31.997194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff956cc410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95b3a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff956cc950>]}


============================== 10:23:32.000447 | c9d43b6b-f944-4805-929d-772cdb4dd142 ==============================
[0m10:23:32.000447 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:23:32.000899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:23:32.392630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74826e40>]}
[0m10:23:32.423918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee9ec30>]}
[0m10:23:32.424231 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:23:32.427800 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:23:32.442298 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:23:32.442465 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:23:32.444716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74770f50>]}
[0m10:23:32.450098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff742f0890>]}
[0m10:23:32.450275 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:23:32.450544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7483ea50>]}
[0m10:23:32.451237 [info ] [MainThread]: 
[0m10:23:32.451600 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:23:32.452154 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_analytics'
[0m10:23:32.457992 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:23:32.458154 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:23:32.458275 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:32.787919 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:23:32.789782 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:23:32.894884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m10:23:32.900364 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:23:32.900985 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:23:32.901417 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:33.248928 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:33.251794 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:23:33.411542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9d43b6b-f944-4805-929d-772cdb4dd142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff742f2bd0>]}
[0m10:23:33.413167 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:23:33.414876 [info ] [MainThread]: 
[0m10:23:33.428436 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:23:33.429050 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m10:23:33.430426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m10:23:33.430800 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:23:33.443684 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:23:33.445079 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 10:23:33.431068 => 10:23:33.444939
[0m10:23:33.445335 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:23:33.456127 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:23:33.457320 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m10:23:33.457570 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m10:23:33.457777 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:33.910712 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:33.921246 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 10:23:33.445496 => 10:23:33.920656
[0m10:23:33.922167 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m10:23:34.083520 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.65s]
[0m10:23:34.085569 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m10:23:34.086204 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:23:34.086943 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m10:23:34.088263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m10:23:34.088782 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:23:34.095111 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:23:34.098232 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 10:23:34.089210 => 10:23:34.097817
[0m10:23:34.098781 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:23:34.103444 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:23:34.104920 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m10:23:34.105229 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m10:23:34.105593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:34.603237 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:34.606370 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 10:23:34.099107 => 10:23:34.606079
[0m10:23:34.606823 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m10:23:34.760410 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.67s]
[0m10:23:34.762491 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m10:23:34.763285 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:23:34.764056 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m10:23:34.765590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m10:23:34.766182 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:23:34.775984 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:23:34.778351 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 10:23:34.766548 => 10:23:34.778083
[0m10:23:34.778760 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:23:34.781557 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:23:34.783163 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m10:23:34.783513 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m10:23:34.783820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:35.277549 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:35.281324 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 10:23:34.779033 => 10:23:35.281011
[0m10:23:35.281939 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m10:23:35.585889 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.82s]
[0m10:23:35.587778 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m10:23:35.592130 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:35.592911 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m10:23:35.593530 [info ] [MainThread]: 
[0m10:23:35.594685 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.14 seconds (3.14s).
[0m10:23:35.596236 [debug] [MainThread]: Command end result
[0m10:23:35.609614 [info ] [MainThread]: 
[0m10:23:35.610306 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:23:35.610588 [info ] [MainThread]: 
[0m10:23:35.611075 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:23:35.612440 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.6371286, "process_user_time": 2.515533, "process_kernel_time": 0.131919, "process_mem_max_rss": "212332", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m10:23:35.612987 [debug] [MainThread]: Command `dbt test` succeeded at 10:23:35.612873 after 3.64 seconds
[0m10:23:35.613368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95b3a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95bce9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74428980>]}
[0m10:23:35.613718 [debug] [MainThread]: Flushing usage events
[0m10:23:38.215502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5262c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5648980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5e50770>]}


============================== 10:23:38.221816 | 69896ef3-01eb-43ac-b9de-7ba92517836b ==============================
[0m10:23:38.221816 [info ] [MainThread]: Running with dbt=1.7.19
[0m10:23:38.222170 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m10:23:38.688177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1f72ba0>]}
[0m10:23:38.731487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c42c30>]}
[0m10:23:38.732284 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m10:23:38.736836 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m10:23:38.750264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:23:38.750469 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:23:38.752957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ffa9250>]}
[0m10:23:38.758996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fe14aa0>]}
[0m10:23:38.759215 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:23:38.759649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff840ac530>]}
[0m10:23:38.760444 [info ] [MainThread]: 
[0m10:23:38.761014 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:23:38.761764 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m10:23:38.767463 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m10:23:38.767652 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m10:23:38.767804 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:39.465943 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m10:23:39.467586 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m10:23:39.615074 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m10:23:39.619235 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m10:23:39.619467 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m10:23:39.619661 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:39.952669 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:39.954103 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m10:23:40.066268 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m10:23:40.069374 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m10:23:40.069685 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m10:23:40.069892 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:40.560895 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m10:23:40.563786 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m10:23:40.661650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1ea9be0>]}
[0m10:23:40.662218 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:23:40.663027 [info ] [MainThread]: 
[0m10:23:40.667897 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m10:23:40.668206 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m10:23:40.668705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now snapshot.btc_elt.snap_btc_market)
[0m10:23:40.668866 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m10:23:40.672700 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 10:23:40.668961 => 10:23:40.672592
[0m10:23:40.672921 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m10:23:40.700112 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m10:23:40.701616 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m10:23:40.701859 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

    ) sbq



        );
[0m10:23:40.702101 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:41.893775 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:41.913940 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 10:23:40.673079 => 10:23:41.913824
[0m10:23:41.914259 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m10:23:42.015037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f236fc0>]}
[0m10:23:42.016817 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 1.35s]
[0m10:23:42.018657 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m10:23:42.019373 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m10:23:42.019945 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m10:23:42.021026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m10:23:42.021462 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m10:23:42.026026 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 10:23:42.021769 => 10:23:42.025466
[0m10:23:42.026742 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m10:23:42.032273 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m10:23:42.035201 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m10:23:42.035630 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

    ) sbq



        );
[0m10:23:42.036176 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:42.961620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:42.964751 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 10:23:42.027062 => 10:23:42.964551
[0m10:23:42.965272 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m10:23:43.075378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69896ef3-01eb-43ac-b9de-7ba92517836b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f26fef0>]}
[0m10:23:43.077154 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.05s]
[0m10:23:43.078974 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m10:23:43.081835 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:43.082514 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m10:23:43.083033 [info ] [MainThread]: 
[0m10:23:43.083948 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.32 seconds (4.32s).
[0m10:23:43.085043 [debug] [MainThread]: Command end result
[0m10:23:43.094421 [info ] [MainThread]: 
[0m10:23:43.095153 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:23:43.095544 [info ] [MainThread]: 
[0m10:23:43.095760 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:23:43.097126 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.9222116, "process_user_time": 2.899501, "process_kernel_time": 0.213915, "process_mem_max_rss": "213164", "process_out_blocks": "1797", "process_in_blocks": "0"}
[0m10:23:43.097453 [debug] [MainThread]: Command `dbt snapshot` succeeded at 10:23:43.097388 after 4.92 seconds
[0m10:23:43.097654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5648980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa55ab560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff963ad820>]}
[0m10:23:43.097911 [debug] [MainThread]: Flushing usage events
[0m19:08:17.105578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ca6420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ca6ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ca6510>]}


============================== 19:08:17.108469 | b5ba584c-dc19-4432-9fb3-96ec6f0e0024 ==============================
[0m19:08:17.108469 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:08:17.108896 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:08:17.166400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b5ba584c-dc19-4432-9fb3-96ec6f0e0024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ca6210>]}
[0m19:08:17.166774 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:08:17.167638 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:08:17.168096 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.08369383, "process_user_time": 1.023795, "process_kernel_time": 0.065627, "process_mem_max_rss": "164244", "process_in_blocks": "26592", "process_out_blocks": "3"}
[0m19:08:17.168367 [debug] [MainThread]: Command `dbt deps` succeeded at 19:08:17.168299 after 0.08 seconds
[0m19:08:17.168527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7031280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa917aab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ce9ac0>]}
[0m19:08:17.168683 [debug] [MainThread]: Flushing usage events
[0m19:08:19.459379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b2fc890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dd12120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b2fcbf0>]}


============================== 19:08:19.465059 | 9377daca-5dea-4d7b-9a64-4e73db7a2d89 ==============================
[0m19:08:19.465059 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:08:19.465479 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m19:08:19.805223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff685d7230>]}
[0m19:08:19.835420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68596150>]}
[0m19:08:19.835815 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:08:19.839386 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:08:19.859678 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:08:19.859854 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:08:19.862067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56192f60>]}
[0m19:08:19.867535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff55ed0920>]}
[0m19:08:19.867728 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:08:19.868000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56022960>]}
[0m19:08:19.868695 [info ] [MainThread]: 
[0m19:08:19.869057 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:08:19.869570 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:08:19.875342 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:08:19.875567 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:08:19.875691 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:08:20.351095 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m19:08:20.353786 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:08:20.474163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m19:08:20.483901 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:08:20.484389 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:08:20.484702 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:08:20.899792 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m19:08:20.902662 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:08:21.012995 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m19:08:21.016325 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:08:21.016726 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:08:21.017389 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:08:21.423264 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:08:21.426518 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:08:21.562665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5615fd40>]}
[0m19:08:21.564204 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:08:21.565540 [info ] [MainThread]: 
[0m19:08:21.577691 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m19:08:21.578748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now model.btc_elt.stg_btc_market)
[0m19:08:21.579232 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m19:08:21.586919 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m19:08:21.589439 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 19:08:21.579528 => 19:08:21.589257
[0m19:08:21.590115 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m19:08:21.590456 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m19:08:21.591135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m19:08:21.591402 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m19:08:21.593685 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m19:08:21.594434 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 19:08:21.591565 => 19:08:21.594309
[0m19:08:21.594918 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m19:08:21.595375 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m19:08:21.595777 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m19:08:21.596685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m19:08:21.596918 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m19:08:21.620827 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m19:08:21.621629 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 19:08:21.597055 => 19:08:21.621532
[0m19:08:21.621809 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m19:08:21.633635 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m19:08:21.636294 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m19:08:21.636562 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m19:08:21.636818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:23.076105 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:08:23.101381 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 19:08:21.621929 => 19:08:23.101175
[0m19:08:23.101924 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m19:08:23.254379 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9377daca-5dea-4d7b-9a64-4e73db7a2d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff55d83380>]}
[0m19:08:23.255212 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.66s]
[0m19:08:23.256478 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m19:08:23.258415 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:08:23.258753 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m19:08:23.259084 [info ] [MainThread]: 
[0m19:08:23.259647 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.39 seconds (3.39s).
[0m19:08:23.260236 [debug] [MainThread]: Command end result
[0m19:08:23.270039 [info ] [MainThread]: 
[0m19:08:23.270570 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:08:23.270823 [info ] [MainThread]: 
[0m19:08:23.271178 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:08:23.271948 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8328335, "process_user_time": 2.414346, "process_kernel_time": 0.091088, "process_mem_max_rss": "213244", "process_in_blocks": "1512", "process_out_blocks": "1852"}
[0m19:08:23.272302 [debug] [MainThread]: Command `dbt run` succeeded at 19:08:23.272226 after 3.83 seconds
[0m19:08:23.272633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b391010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b641eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56060ec0>]}
[0m19:08:23.272925 [debug] [MainThread]: Flushing usage events
[0m19:08:25.526727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeee6510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeee6180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeee6630>]}


============================== 19:08:25.529716 | b3f21e0d-e228-4d21-a14c-552b0cc70409 ==============================
[0m19:08:25.529716 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:08:25.530108 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m19:08:25.875549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd45280>]}
[0m19:08:25.905889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f507ad0>]}
[0m19:08:25.906191 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:08:25.909304 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:08:25.921377 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:08:25.921531 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:08:25.923677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd6e750>]}
[0m19:08:25.928728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dcd8e60>]}
[0m19:08:25.928931 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:08:25.929208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef2ffe0>]}
[0m19:08:25.929865 [info ] [MainThread]: 
[0m19:08:25.930259 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:08:25.930802 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_analytics'
[0m19:08:25.936156 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:08:25.936307 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:08:25.936425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:08:26.391935 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:08:26.393686 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:08:26.519610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m19:08:26.526468 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:08:26.527256 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:08:26.528052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:08:26.923832 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m19:08:26.926919 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:08:27.072495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3f21e0d-e228-4d21-a14c-552b0cc70409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db39370>]}
[0m19:08:27.073952 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:08:27.074565 [info ] [MainThread]: 
[0m19:08:27.087510 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:08:27.088258 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m19:08:27.089605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m19:08:27.089959 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:08:27.103439 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:08:27.105005 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 19:08:27.090201 => 19:08:27.104806
[0m19:08:27.105320 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:08:27.116773 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:08:27.117837 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:08:27.118084 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m19:08:27.118349 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:27.552558 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:27.560750 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 19:08:27.105532 => 19:08:27.560422
[0m19:08:27.561268 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m19:08:27.661763 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.57s]
[0m19:08:27.663354 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:08:27.664027 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:08:27.664585 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m19:08:27.665711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m19:08:27.666157 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:08:27.670777 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:08:27.672802 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 19:08:27.666441 => 19:08:27.672628
[0m19:08:27.673131 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:08:27.675277 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:08:27.676547 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:08:27.676889 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m19:08:27.677247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:28.150841 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:28.155134 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 19:08:27.673339 => 19:08:28.154761
[0m19:08:28.155858 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m19:08:28.262620 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.60s]
[0m19:08:28.263881 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:08:28.264383 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:08:28.264846 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m19:08:28.265796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m19:08:28.266208 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:08:28.273889 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:08:28.275583 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 19:08:28.266460 => 19:08:28.275408
[0m19:08:28.275874 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:08:28.277850 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:08:28.278942 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:08:28.279211 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m19:08:28.279480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:28.618920 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:28.621078 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 19:08:28.276073 => 19:08:28.620880
[0m19:08:28.621513 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m19:08:28.729169 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.46s]
[0m19:08:28.729975 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:08:28.731422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:08:28.731686 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m19:08:28.732012 [info ] [MainThread]: 
[0m19:08:28.732457 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 2.80 seconds (2.80s).
[0m19:08:28.733092 [debug] [MainThread]: Command end result
[0m19:08:28.739933 [info ] [MainThread]: 
[0m19:08:28.740270 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:08:28.740499 [info ] [MainThread]: 
[0m19:08:28.740783 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:08:28.741348 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.234921, "process_user_time": 2.369959, "process_kernel_time": 0.093998, "process_mem_max_rss": "212524", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m19:08:28.741659 [debug] [MainThread]: Command `dbt test` succeeded at 19:08:28.741589 after 3.24 seconds
[0m19:08:28.741889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf78e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ddd24e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb134ae70>]}
[0m19:08:28.742129 [debug] [MainThread]: Flushing usage events
[0m19:08:30.543621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bf28c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a2b9190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a1ddfa0>]}


============================== 19:08:30.546638 | 232fafc5-9acf-4e85-b1e7-6f0d21b824e2 ==============================
[0m19:08:30.546638 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:08:30.547080 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:08:30.884705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a571f70>]}
[0m19:08:30.915667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a881490>]}
[0m19:08:30.916125 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:08:30.919710 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:08:30.932020 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:08:30.932191 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:08:30.934299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59273350>]}
[0m19:08:30.939228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff58e18830>]}
[0m19:08:30.939427 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:08:30.939710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a7a5a60>]}
[0m19:08:30.940403 [info ] [MainThread]: 
[0m19:08:30.940806 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:08:30.941339 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:08:30.946189 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:08:30.946348 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:08:30.946493 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:08:31.316967 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m19:08:31.317879 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:08:31.416636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_snapshot)
[0m19:08:31.420596 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:08:31.420836 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:08:31.421052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:08:31.811646 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m19:08:31.812503 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:08:32.530535 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m19:08:32.535335 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:08:32.536334 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:08:32.537724 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:08:32.849555 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:08:32.850437 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:08:32.943466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff58c4cfe0>]}
[0m19:08:32.943924 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:08:32.944312 [info ] [MainThread]: 
[0m19:08:32.948686 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m19:08:32.948971 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m19:08:32.949429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now snapshot.btc_elt.snap_btc_market)
[0m19:08:32.949602 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m19:08:32.953234 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 19:08:32.949719 => 19:08:32.953111
[0m19:08:32.953462 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m19:08:32.977028 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:32.977384 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:08:32.977619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:33.483194 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:08:33.495616 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:33.496293 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:08:33.580085 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:08:33.587270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:33.587651 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:08:33.686198 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:08:33.702556 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:33.702970 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:08:34.904153 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:08:34.910585 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:34.911223 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:08:35.062911 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:08:35.068836 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.069590 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:08:35.188109 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:08:35.194421 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.195175 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:08:35.280149 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:08:35.286113 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.286686 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:08:35.418544 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:08:35.429281 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.429940 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:08:35.541410 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:08:35.551150 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.553657 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.554041 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m19:08:35.704010 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:35.705094 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:35.705595 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:08:36.413559 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 1.0 seconds
[0m19:08:36.414200 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:08:36.414502 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m19:08:36.694428 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:36.708270 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 19:08:32.953585 => 19:08:36.708137
[0m19:08:36.708576 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m19:08:36.861990 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff58fae9f0>]}
[0m19:08:36.863593 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 4[0m in 3.91s]
[0m19:08:36.865266 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m19:08:36.865874 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m19:08:36.866537 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m19:08:36.867755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m19:08:36.868207 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m19:08:36.873460 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 19:08:36.868523 => 19:08:36.873180
[0m19:08:36.873940 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m19:08:36.878934 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:36.879376 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:08:36.879807 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:08:37.363410 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m19:08:37.368945 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:37.369854 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:08:37.463843 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:08:37.468516 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:37.468927 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:08:37.566062 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:08:37.574241 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:37.574803 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:08:38.766110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:08:38.768474 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:38.768789 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:08:38.865893 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:08:38.870928 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:38.871533 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:08:39.014876 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:08:39.020842 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.021456 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:08:39.134343 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:08:39.141097 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.141947 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:08:39.252274 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:08:39.258992 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.259597 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:08:39.381127 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:08:39.383928 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.386031 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.386369 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m19:08:39.495352 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:39.496334 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:39.497017 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:08:40.249468 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:08:40.252306 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:08:40.253157 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m19:08:40.612437 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:08:40.616698 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 19:08:36.874381 => 19:08:40.616495
[0m19:08:40.617137 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m19:08:40.774941 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '232fafc5-9acf-4e85-b1e7-6f0d21b824e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5835a810>]}
[0m19:08:40.775712 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.91s]
[0m19:08:40.776443 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m19:08:40.777896 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:08:40.778195 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m19:08:40.778483 [info ] [MainThread]: 
[0m19:08:40.778834 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 9.84 seconds (9.84s).
[0m19:08:40.779378 [debug] [MainThread]: Command end result
[0m19:08:40.786097 [info ] [MainThread]: 
[0m19:08:40.786473 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:08:40.786721 [info ] [MainThread]: 
[0m19:08:40.787057 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:08:40.787584 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.264579, "process_user_time": 2.568939, "process_kernel_time": 0.09795, "process_mem_max_rss": "213516", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m19:08:40.787875 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:08:40.787810 after 10.26 seconds
[0m19:08:40.788086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a1de210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bf28c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5910ecf0>]}
[0m19:08:40.788311 [debug] [MainThread]: Flushing usage events
[0m19:19:50.544396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a474290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff994751f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98747d40>]}


============================== 19:19:50.550830 | ac82fc1b-bb8a-4d38-9f1f-72d873264b9b ==============================
[0m19:19:50.550830 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:19:50.551377 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:19:50.626840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac82fc1b-bb8a-4d38-9f1f-72d873264b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff984ebdd0>]}
[0m19:19:50.627265 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:19:50.628247 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:19:50.628974 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.10582712, "process_user_time": 1.084775, "process_kernel_time": 0.077483, "process_mem_max_rss": "170084", "process_in_blocks": "58808", "process_out_blocks": "1339"}
[0m19:19:50.631738 [debug] [MainThread]: Command `dbt deps` succeeded at 19:19:50.631690 after 0.11 seconds
[0m19:19:50.631919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d7b6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98ad8d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98631c70>]}
[0m19:19:50.632103 [debug] [MainThread]: Flushing usage events
[0m19:19:52.435157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90024500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90127f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90024cb0>]}


============================== 19:19:52.438749 | 564e162c-fb9c-4c00-8911-02a6ec9de6c9 ==============================
[0m19:19:52.438749 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:19:52.439197 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:19:52.881359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b09c260>]}
[0m19:19:52.915237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90024fb0>]}
[0m19:19:52.915794 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:19:52.919856 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:19:52.939532 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:19:52.939725 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:19:52.942199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6adb0fe0>]}
[0m19:19:52.948783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ac24440>]}
[0m19:19:52.949034 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:19:52.949405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ad70830>]}
[0m19:19:52.950267 [info ] [MainThread]: 
[0m19:19:52.950719 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:19:52.951316 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:19:52.956616 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:19:52.956811 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:19:52.956960 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:53.379904 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m19:19:53.380844 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:19:53.496878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m19:19:53.501985 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:19:53.502222 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:19:53.502469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:53.826359 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:19:53.829233 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:19:53.972757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m19:19:53.978316 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:19:53.978864 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:19:53.979237 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:54.394876 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:19:54.396097 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:19:54.502558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b077bc0>]}
[0m19:19:54.503297 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:19:54.504039 [info ] [MainThread]: 
[0m19:19:54.510764 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m19:19:54.511254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m19:19:54.511493 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m19:19:54.516794 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m19:19:54.518206 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 19:19:54.511648 => 19:19:54.518089
[0m19:19:54.518695 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m19:19:54.518926 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m19:19:54.519351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m19:19:54.519590 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m19:19:54.521627 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m19:19:54.522386 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 19:19:54.519733 => 19:19:54.522294
[0m19:19:54.522784 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m19:19:54.523133 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m19:19:54.523459 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m19:19:54.523921 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m19:19:54.524083 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m19:19:54.545009 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m19:19:54.545952 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 19:19:54.524186 => 19:19:54.545842
[0m19:19:54.546138 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m19:19:54.557217 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m19:19:54.559974 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m19:19:54.560245 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m19:19:54.560540 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:56.069776 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m19:19:56.096477 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 19:19:54.546253 => 19:19:56.096265
[0m19:19:56.096974 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m19:19:56.217778 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564e162c-fb9c-4c00-8911-02a6ec9de6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ab1ac90>]}
[0m19:19:56.219256 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.69s]
[0m19:19:56.221031 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m19:19:56.223685 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:19:56.224190 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m19:19:56.224633 [info ] [MainThread]: 
[0m19:19:56.225395 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.27 seconds (3.27s).
[0m19:19:56.226282 [debug] [MainThread]: Command end result
[0m19:19:56.240092 [info ] [MainThread]: 
[0m19:19:56.240888 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:19:56.241189 [info ] [MainThread]: 
[0m19:19:56.241595 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:19:56.242699 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8292394, "process_user_time": 2.365814, "process_kernel_time": 0.108715, "process_mem_max_rss": "212536", "process_in_blocks": "17808", "process_out_blocks": "1852"}
[0m19:19:56.243283 [debug] [MainThread]: Command `dbt run` succeeded at 19:19:56.243182 after 3.83 seconds
[0m19:19:56.243625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9130e3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a138c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b148a70>]}
[0m19:19:56.243970 [debug] [MainThread]: Flushing usage events
[0m19:19:59.172495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c076a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c08b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c37d6d0>]}


============================== 19:19:59.176903 | 38c24128-0d4f-475f-93f0-e400935def17 ==============================
[0m19:19:59.176903 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:19:59.177882 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:19:59.536809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57140ad0>]}
[0m19:19:59.567541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c5ae8a0>]}
[0m19:19:59.567886 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:19:59.571390 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:19:59.584555 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:19:59.584723 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:19:59.586947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff570b59a0>]}
[0m19:19:59.592817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56c2ce30>]}
[0m19:19:59.593015 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:19:59.593375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56d88e30>]}
[0m19:19:59.594176 [info ] [MainThread]: 
[0m19:19:59.594626 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:19:59.595295 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_snapshot'
[0m19:19:59.601143 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:19:59.601304 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:19:59.601420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:59.996154 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:20:00.001560 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:20:00.120265 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m19:20:00.124434 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:20:00.124857 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:20:00.126958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:00.639562 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:20:00.640789 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:20:00.758689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38c24128-0d4f-475f-93f0-e400935def17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57362f30>]}
[0m19:20:00.759280 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:20:00.760000 [info ] [MainThread]: 
[0m19:20:00.764674 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:00.764932 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m19:20:00.765388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m19:20:00.765562 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:00.772798 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:00.774386 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 19:20:00.765689 => 19:20:00.774282
[0m19:20:00.774581 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:00.782916 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:00.785439 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:00.787112 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m19:20:00.787783 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:01.284171 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:20:01.287967 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 19:20:00.774701 => 19:20:01.287843
[0m19:20:01.288195 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m19:20:01.522905 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.76s]
[0m19:20:01.523631 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:01.523914 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:01.524135 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m19:20:01.524599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m19:20:01.524787 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:01.526931 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:01.527799 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 19:20:01.524929 => 19:20:01.527681
[0m19:20:01.528001 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:01.529196 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:01.529867 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:01.530022 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m19:20:01.530187 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:01.939864 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:20:01.941659 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 19:20:01.528100 => 19:20:01.941503
[0m19:20:01.941986 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m19:20:02.041085 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.52s]
[0m19:20:02.041967 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:02.042228 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:02.042489 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m19:20:02.042984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m19:20:02.043177 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:02.047631 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:02.048732 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 19:20:02.043323 => 19:20:02.048617
[0m19:20:02.049221 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:02.051970 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:02.054133 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:02.054571 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m19:20:02.055154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:02.515688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:20:02.517947 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 19:20:02.050019 => 19:20:02.517764
[0m19:20:02.518251 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m19:20:02.621918 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.58s]
[0m19:20:02.622965 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:02.624495 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:02.624683 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m19:20:02.624893 [info ] [MainThread]: 
[0m19:20:02.625254 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.03 seconds (3.03s).
[0m19:20:02.625737 [debug] [MainThread]: Command end result
[0m19:20:02.631873 [info ] [MainThread]: 
[0m19:20:02.632195 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:20:02.632337 [info ] [MainThread]: 
[0m19:20:02.632573 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:20:02.633552 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5059693, "process_user_time": 2.823269, "process_kernel_time": 0.178343, "process_mem_max_rss": "213092", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m19:20:02.633905 [debug] [MainThread]: Command `dbt test` succeeded at 19:20:02.633831 after 3.51 seconds
[0m19:20:02.634212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c076a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c382780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57b35820>]}
[0m19:20:02.634421 [debug] [MainThread]: Flushing usage events
[0m19:20:05.140483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb060de20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb06ee270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb060f080>]}


============================== 19:20:05.144111 | 2d3cdd9a-8df7-4331-b25a-968518079a1b ==============================
[0m19:20:05.144111 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:20:05.145008 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m19:20:05.539755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1979f40>]}
[0m19:20:05.575689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9560f650>]}
[0m19:20:05.576194 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:20:05.580283 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:20:05.594285 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:20:05.594494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:20:05.596938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d7fa090>]}
[0m19:20:05.602609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b228bf0>]}
[0m19:20:05.602818 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:20:05.603177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90739c10>]}
[0m19:20:05.603896 [info ] [MainThread]: 
[0m19:20:05.604316 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:20:05.604913 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:20:05.610304 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:20:05.610471 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:20:05.610588 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:05.974210 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m19:20:05.975888 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:20:06.581290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m19:20:06.596889 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:20:06.597343 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:20:06.597628 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:06.945787 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:20:06.948169 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:20:07.066783 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m19:20:07.072489 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:20:07.073323 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:20:07.073847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:07.493753 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:20:07.496287 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:20:07.605331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b02df10>]}
[0m19:20:07.606576 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:20:07.607896 [info ] [MainThread]: 
[0m19:20:07.619112 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m19:20:07.619729 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m19:20:07.620775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m19:20:07.621211 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m19:20:07.628956 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 19:20:07.621498 => 19:20:07.628760
[0m19:20:07.629275 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m19:20:07.666683 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m19:20:07.668388 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:20:07.668614 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

    ) sbq



        );
[0m19:20:07.668805 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:08.983228 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:20:09.010305 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 19:20:07.629490 => 19:20:09.010123
[0m19:20:09.010709 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m19:20:09.119451 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b22a720>]}
[0m19:20:09.121227 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 1.50s]
[0m19:20:09.122983 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m19:20:09.123639 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m19:20:09.124346 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m19:20:09.125742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m19:20:09.126320 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m19:20:09.134289 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 19:20:09.126690 => 19:20:09.134027
[0m19:20:09.134903 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m19:20:09.139085 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m19:20:09.142112 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:20:09.142512 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

    ) sbq



        );
[0m19:20:09.142891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:10.464785 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:20:10.466951 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 19:20:09.135194 => 19:20:10.466790
[0m19:20:10.467293 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m19:20:10.705898 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d3cdd9a-8df7-4331-b25a-968518079a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b2e9280>]}
[0m19:20:10.707009 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.58s]
[0m19:20:10.708122 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m19:20:10.710158 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:10.710557 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m19:20:10.710939 [info ] [MainThread]: 
[0m19:20:10.711432 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 5.11 seconds (5.11s).
[0m19:20:10.712183 [debug] [MainThread]: Command end result
[0m19:20:10.721664 [info ] [MainThread]: 
[0m19:20:10.722181 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:20:10.722467 [info ] [MainThread]: 
[0m19:20:10.722751 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:20:10.723759 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 5.605148, "process_user_time": 2.906939, "process_kernel_time": 0.195137, "process_mem_max_rss": "212404", "process_out_blocks": "1797", "process_in_blocks": "0"}
[0m19:20:10.724185 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:20:10.724103 after 5.61 seconds
[0m19:20:10.724494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb060e1e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb06ee270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9566e3f0>]}
[0m19:20:10.724793 [debug] [MainThread]: Flushing usage events
[0m19:31:52.567315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff803f25a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8077d430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff803f2450>]}


============================== 19:31:52.575812 | 7591746b-6449-4393-a7fb-37bb01fdbd01 ==============================
[0m19:31:52.575812 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:31:52.576385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:31:52.627477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7591746b-6449-4393-a7fb-37bb01fdbd01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff803f1dc0>]}
[0m19:31:52.627876 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:31:52.628910 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:31:52.629431 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.08425325, "process_user_time": 1.142424, "process_kernel_time": 0.074353, "process_mem_max_rss": "170088", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m19:31:52.629673 [debug] [MainThread]: Command `dbt deps` succeeded at 19:31:52.629616 after 0.08 seconds
[0m19:31:52.629844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80827c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8034d880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff803347a0>]}
[0m19:31:52.629997 [debug] [MainThread]: Flushing usage events
[0m19:31:55.234836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9356acf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff935691f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93568a70>]}


============================== 19:31:55.238247 | 2a984440-a813-4a46-9730-a04841f2391e ==============================
[0m19:31:55.238247 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:31:55.238736 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:31:55.603784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e49ee40>]}
[0m19:31:55.635618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff933e1c40>]}
[0m19:31:55.636077 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:31:55.639514 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:31:55.654428 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:31:55.654602 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:31:55.656773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e123da0>]}
[0m19:31:55.663091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e0d8d10>]}
[0m19:31:55.663270 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:31:55.663574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93522540>]}
[0m19:31:55.664322 [info ] [MainThread]: 
[0m19:31:55.664726 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:31:55.665294 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:31:55.670288 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:31:55.670467 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:31:55.670632 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:56.194575 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m19:31:56.196277 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:31:56.363504 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m19:31:56.374670 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:31:56.375357 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:31:56.375776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:31:56.782007 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:31:56.783743 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:31:56.886466 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m19:31:56.890145 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:31:56.890541 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:31:56.891200 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:31:57.264627 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:31:57.267763 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:31:57.409152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e2a6990>]}
[0m19:31:57.410430 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:31:57.410965 [info ] [MainThread]: 
[0m19:31:57.423961 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m19:31:57.425001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m19:31:57.425445 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m19:31:57.433774 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m19:31:57.436169 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 19:31:57.425736 => 19:31:57.435968
[0m19:31:57.436911 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m19:31:57.437229 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m19:31:57.437781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m19:31:57.438114 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m19:31:57.440856 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m19:31:57.442110 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 19:31:57.438313 => 19:31:57.441964
[0m19:31:57.442683 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m19:31:57.443349 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m19:31:57.443678 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m19:31:57.444380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m19:31:57.444632 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m19:31:57.474108 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m19:31:57.475158 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 19:31:57.444812 => 19:31:57.475042
[0m19:31:57.475370 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m19:31:57.487890 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m19:31:57.490739 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m19:31:57.491022 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m19:31:57.491316 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:31:58.966047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:31:58.981115 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 19:31:57.475503 => 19:31:58.980987
[0m19:31:58.981408 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m19:31:59.097104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a984440-a813-4a46-9730-a04841f2391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d504650>]}
[0m19:31:59.099821 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.65s]
[0m19:31:59.100744 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m19:31:59.102614 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:31:59.103043 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m19:31:59.103411 [info ] [MainThread]: 
[0m19:31:59.103994 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.44 seconds (3.44s).
[0m19:31:59.104690 [debug] [MainThread]: Command end result
[0m19:31:59.113370 [info ] [MainThread]: 
[0m19:31:59.113769 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:31:59.114027 [info ] [MainThread]: 
[0m19:31:59.114410 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:31:59.115106 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.9012582, "process_user_time": 2.604581, "process_kernel_time": 0.137189, "process_mem_max_rss": "209060", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m19:31:59.115479 [debug] [MainThread]: Command `dbt run` succeeded at 19:31:59.115387 after 3.90 seconds
[0m19:31:59.115814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93602ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93955e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d568530>]}
[0m19:31:59.116094 [debug] [MainThread]: Flushing usage events
[0m19:32:01.074592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cbf4440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e900e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cbf9070>]}


============================== 19:32:01.077778 | 18769c16-8af8-4e1a-b71d-3734302ae012 ==============================
[0m19:32:01.077778 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:32:01.078204 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:32:01.419857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d15eb10>]}
[0m19:32:01.451397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dda5820>]}
[0m19:32:01.451810 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:32:01.455219 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:32:01.467837 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:32:01.468042 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:32:01.470277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff778c4b00>]}
[0m19:32:01.475423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7776c9b0>]}
[0m19:32:01.475612 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:32:01.475956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff778a1820>]}
[0m19:32:01.476680 [info ] [MainThread]: 
[0m19:32:01.477102 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:32:01.477645 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_snapshot'
[0m19:32:01.483216 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:32:01.483377 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:32:01.483518 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:32:01.896333 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:32:01.897690 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:32:02.008031 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m19:32:02.010573 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:32:02.010881 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:32:02.011124 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:32:02.480122 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:32:02.482035 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:32:02.585356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18769c16-8af8-4e1a-b71d-3734302ae012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76d1b410>]}
[0m19:32:02.586835 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:32:02.588209 [info ] [MainThread]: 
[0m19:32:02.600312 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:32:02.600960 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m19:32:02.602380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m19:32:02.603013 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:32:02.616472 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:32:02.617931 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 19:32:02.603417 => 19:32:02.617755
[0m19:32:02.618208 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:32:02.629618 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:32:02.630619 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:32:02.630858 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m19:32:02.631111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:32:03.087554 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:32:03.098996 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 19:32:02.618394 => 19:32:03.098658
[0m19:32:03.099566 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m19:32:03.208109 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.61s]
[0m19:32:03.209337 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:32:03.210074 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:32:03.210674 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m19:32:03.211966 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m19:32:03.212494 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:32:03.219232 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:32:03.221416 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 19:32:03.212832 => 19:32:03.221032
[0m19:32:03.221987 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:32:03.225174 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:32:03.226874 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:32:03.227224 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m19:32:03.227555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:32:03.537198 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:32:03.541987 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 19:32:03.222291 => 19:32:03.541363
[0m19:32:03.542976 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m19:32:03.650159 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.44s]
[0m19:32:03.652468 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:32:03.653403 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:32:03.654114 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m19:32:03.655980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m19:32:03.656682 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:32:03.666687 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:32:03.668288 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 19:32:03.657122 => 19:32:03.668118
[0m19:32:03.668590 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:32:03.670732 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:32:03.672167 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:32:03.673124 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m19:32:03.673480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:32:04.236800 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:32:04.238201 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 19:32:03.668788 => 19:32:04.238075
[0m19:32:04.238428 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m19:32:04.383245 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.73s]
[0m19:32:04.385544 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:32:04.391236 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:32:04.392027 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m19:32:04.393661 [info ] [MainThread]: 
[0m19:32:04.394864 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 2.92 seconds (2.92s).
[0m19:32:04.396889 [debug] [MainThread]: Command end result
[0m19:32:04.421742 [info ] [MainThread]: 
[0m19:32:04.424421 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:32:04.427181 [info ] [MainThread]: 
[0m19:32:04.429730 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:32:04.433571 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.3793628, "process_user_time": 2.419487, "process_kernel_time": 0.099554, "process_mem_max_rss": "208424", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m19:32:04.436427 [debug] [MainThread]: Command `dbt test` succeeded at 19:32:04.436079 after 3.38 seconds
[0m19:32:04.438355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cfe79e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d096f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77700cb0>]}
[0m19:32:04.439985 [debug] [MainThread]: Flushing usage events
[0m19:32:06.565331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8438c500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84856270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8438d0d0>]}


============================== 19:32:06.569074 | 937f57f2-6add-4a37-908b-8c874f7fcf64 ==============================
[0m19:32:06.569074 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:32:06.569510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:32:06.939746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f3daa50>]}
[0m19:32:06.971811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f739e20>]}
[0m19:32:06.972154 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:32:06.975564 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:32:06.988395 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:32:06.988581 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:32:06.990901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f9da150>]}
[0m19:32:06.996434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5efb0bf0>]}
[0m19:32:06.996667 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:32:06.996999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f146030>]}
[0m19:32:06.997675 [info ] [MainThread]: 
[0m19:32:06.998099 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:32:06.998640 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m19:32:07.003806 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m19:32:07.003977 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m19:32:07.004118 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:32:07.442051 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m19:32:07.443504 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m19:32:07.627425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m19:32:07.632897 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m19:32:07.633164 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m19:32:07.633383 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:32:07.982962 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:32:07.984142 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m19:32:08.110441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m19:32:08.113941 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m19:32:08.114343 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m19:32:08.114862 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:32:08.477621 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:32:08.480729 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m19:32:08.607686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69427dd0>]}
[0m19:32:08.608707 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:32:08.609569 [info ] [MainThread]: 
[0m19:32:08.618584 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m19:32:08.619070 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m19:32:08.619868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m19:32:08.620181 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m19:32:08.626332 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 19:32:08.620387 => 19:32:08.626171
[0m19:32:08.626605 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m19:32:08.659173 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m19:32:08.660393 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:32:08.660585 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

    ) sbq



        );
[0m19:32:08.660758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:32:09.805158 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:32:09.826997 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 19:32:08.626777 => 19:32:09.826823
[0m19:32:09.827398 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m19:32:10.217503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e5db4d0>]}
[0m19:32:10.219075 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 1.60s]
[0m19:32:10.220699 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m19:32:10.221450 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m19:32:10.222137 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m19:32:10.223421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m19:32:10.223949 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m19:32:10.232348 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 19:32:10.224228 => 19:32:10.231961
[0m19:32:10.233029 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m19:32:10.237616 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m19:32:10.240315 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:32:10.240722 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table CAR_SALES_DBB.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

    ) sbq



        );
[0m19:32:10.241175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:32:11.115615 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:32:11.119097 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 19:32:10.233420 => 19:32:11.118919
[0m19:32:11.119522 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m19:32:11.222742 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '937f57f2-6add-4a37-908b-8c874f7fcf64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e5712e0>]}
[0m19:32:11.224451 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.00s]
[0m19:32:11.226103 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m19:32:11.228964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:32:11.229426 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m19:32:11.229866 [info ] [MainThread]: 
[0m19:32:11.230523 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.23 seconds (4.23s).
[0m19:32:11.231359 [debug] [MainThread]: Command end result
[0m19:32:11.244208 [info ] [MainThread]: 
[0m19:32:11.244990 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:32:11.245268 [info ] [MainThread]: 
[0m19:32:11.245580 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:32:11.246454 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.7036204, "process_user_time": 2.551787, "process_kernel_time": 0.10527, "process_mem_max_rss": "208896", "process_out_blocks": "1797", "process_in_blocks": "0"}
[0m19:32:11.246890 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:32:11.246779 after 4.70 seconds
[0m19:32:11.247306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff846de000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8442aff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e41bce0>]}
[0m19:32:11.247611 [debug] [MainThread]: Flushing usage events
[0m02:01:22.590612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3aae40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b354650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b354aa0>]}


============================== 02:01:22.600234 | 22caad23-d135-4e48-886f-9be8fbefd6c3 ==============================
[0m02:01:22.600234 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:22.600970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:01:22.704632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22caad23-d135-4e48-886f-9be8fbefd6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b1faf60>]}
[0m02:01:22.705565 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m02:01:22.706897 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m02:01:22.707825 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.14514746, "process_user_time": 1.134928, "process_kernel_time": 0.103084, "process_mem_max_rss": "133096", "process_in_blocks": "48216", "process_out_blocks": "3"}
[0m02:01:22.708287 [debug] [MainThread]: Command `dbt deps` succeeded at 02:01:22.708178 after 0.15 seconds
[0m02:01:22.708602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3aae40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b1faf60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b8109b0>]}
[0m02:01:22.708857 [debug] [MainThread]: Flushing usage events
[0m02:01:25.555631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff868de600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86b13680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff868de2a0>]}


============================== 02:01:25.559161 | da0877c3-55a4-4f5f-8e11-2518f2a62492 ==============================
[0m02:01:25.559161 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:25.559499 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:01:26.042777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65aeee40>]}
[0m02:01:26.074545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff658133e0>]}
[0m02:01:26.074924 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:26.078609 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:26.099508 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:26.099687 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:26.101922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff867c8740>]}
[0m02:01:26.107990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff653b8ce0>]}
[0m02:01:26.108170 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:26.108493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff657e0440>]}
[0m02:01:26.109215 [info ] [MainThread]: 
[0m02:01:26.109640 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:26.110299 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m02:01:26.115684 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m02:01:26.115839 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m02:01:26.115979 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:26.702570 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m02:01:26.705328 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m02:01:26.814330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m02:01:26.820257 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m02:01:26.820575 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m02:01:26.820729 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:27.259320 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m02:01:27.261438 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m02:01:27.384299 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m02:01:27.386761 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m02:01:27.386970 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m02:01:27.387141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:27.816169 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:01:27.818296 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m02:01:27.963833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff653ba600>]}
[0m02:01:27.965311 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:27.967613 [info ] [MainThread]: 
[0m02:01:27.975558 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m02:01:27.976623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now model.btc_elt.stg_btc_market)
[0m02:01:27.977340 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m02:01:27.987663 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m02:01:27.990275 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 02:01:27.977801 => 02:01:27.989952
[0m02:01:27.991456 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m02:01:27.991995 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m02:01:27.993252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m02:01:27.993632 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m02:01:27.998055 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m02:01:27.999909 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 02:01:27.993901 => 02:01:27.999635
[0m02:01:28.000780 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m02:01:28.013247 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m02:01:28.016349 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m02:01:28.018641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m02:01:28.024138 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m02:01:28.106860 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m02:01:28.120101 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 02:01:28.027646 => 02:01:28.119627
[0m02:01:28.120995 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m02:01:28.141880 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m02:01:28.153756 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m02:01:28.154171 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table CAR_SALES_DBB.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM CAR_SALES_DBB.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m02:01:28.154651 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:29.729009 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m02:01:29.757425 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 02:01:28.121692 => 02:01:29.757173
[0m02:01:29.757954 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m02:01:29.878702 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da0877c3-55a4-4f5f-8e11-2518f2a62492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff654792b0>]}
[0m02:01:29.879960 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.86s]
[0m02:01:29.880652 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m02:01:29.885001 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:29.885284 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m02:01:29.885727 [info ] [MainThread]: 
[0m02:01:29.886117 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.78 seconds (3.78s).
[0m02:01:29.886835 [debug] [MainThread]: Command end result
[0m02:01:29.894906 [info ] [MainThread]: 
[0m02:01:29.895191 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:29.895503 [info ] [MainThread]: 
[0m02:01:29.895831 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:01:29.897324 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3632803, "process_user_time": 2.564406, "process_kernel_time": 0.173977, "process_mem_max_rss": "212648", "process_in_blocks": "17520", "process_out_blocks": "1852"}
[0m02:01:29.897740 [debug] [MainThread]: Command `dbt run` succeeded at 02:01:29.897677 after 4.36 seconds
[0m02:01:29.898080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86c83530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6534a720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65589a60>]}
[0m02:01:29.898260 [debug] [MainThread]: Flushing usage events
[0m02:01:32.527025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91f9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91f8b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91fa720>]}


============================== 02:01:32.530526 | be9f916f-bee3-426d-9be1-fe5f198475db ==============================
[0m02:01:32.530526 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:32.531124 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:01:32.928235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e25b1a0>]}
[0m02:01:32.960676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885180b0>]}
[0m02:01:32.961026 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:32.964465 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:32.978907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:32.979093 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:32.981353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88243950>]}
[0m02:01:32.989070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d109e0>]}
[0m02:01:32.989275 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:32.989607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91ff8f0>]}
[0m02:01:32.990326 [info ] [MainThread]: 
[0m02:01:32.990718 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:32.991301 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB_snapshot'
[0m02:01:32.996999 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m02:01:32.997143 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m02:01:32.997259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:33.451220 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:01:33.453170 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m02:01:33.738682 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now list_CAR_SALES_DBB_analytics)
[0m02:01:33.741618 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m02:01:33.741999 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m02:01:33.742276 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:34.086827 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m02:01:34.090167 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m02:01:34.203650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be9f916f-bee3-426d-9be1-fe5f198475db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83e03aa0>]}
[0m02:01:34.205407 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:34.207025 [info ] [MainThread]: 
[0m02:01:34.221850 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:34.222746 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m02:01:34.224622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m02:01:34.225204 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:34.237452 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:34.239242 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 02:01:34.225471 => 02:01:34.239098
[0m02:01:34.239557 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:34.249988 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:34.251456 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:34.251736 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m02:01:34.251981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:34.711865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:34.724182 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 02:01:34.239720 => 02:01:34.723733
[0m02:01:34.725019 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m02:01:34.834139 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.61s]
[0m02:01:34.836062 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:34.837011 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:34.837680 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m02:01:34.838973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m02:01:34.839462 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:34.844527 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:34.846168 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 02:01:34.839757 => 02:01:34.845980
[0m02:01:34.846491 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:34.848693 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:34.849926 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:34.850244 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from CAR_SALES_DBB.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m02:01:34.850594 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:35.617868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:35.621402 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 02:01:34.846723 => 02:01:35.620992
[0m02:01:35.621909 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m02:01:35.773439 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.93s]
[0m02:01:35.775810 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:35.776686 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:35.777251 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m02:01:35.778628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m02:01:35.779472 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:35.790141 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:35.791916 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 02:01:35.779993 => 02:01:35.791740
[0m02:01:35.792224 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:35.794389 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:35.795899 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:35.796249 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from CAR_SALES_DBB.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m02:01:35.796625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:36.228759 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:36.232090 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 02:01:35.792448 => 02:01:36.231845
[0m02:01:36.232471 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m02:01:36.349670 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.57s]
[0m02:01:36.350640 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:36.352347 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:36.352647 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m02:01:36.352947 [info ] [MainThread]: 
[0m02:01:36.353375 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.36 seconds (3.36s).
[0m02:01:36.354032 [debug] [MainThread]: Command end result
[0m02:01:36.361219 [info ] [MainThread]: 
[0m02:01:36.361603 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:36.361840 [info ] [MainThread]: 
[0m02:01:36.362053 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m02:01:36.362819 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.8573835, "process_user_time": 2.470571, "process_kernel_time": 0.202739, "process_mem_max_rss": "212476", "process_in_blocks": "16", "process_out_blocks": "1799"}
[0m02:01:36.363223 [debug] [MainThread]: Command `dbt test` succeeded at 02:01:36.363125 after 3.86 seconds
[0m02:01:36.363508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91fc2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887eb230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa95e70e0>]}
[0m02:01:36.363768 [debug] [MainThread]: Flushing usage events
[0m02:01:38.459064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6344290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa449e2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa449f350>]}


============================== 02:01:38.462395 | b98f3813-70eb-4661-84e8-47f38be04cc9 ==============================
[0m02:01:38.462395 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:38.462922 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m02:01:38.837680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f6b9f40>]}
[0m02:01:38.868799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f4d69f0>]}
[0m02:01:38.869142 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:38.872474 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:38.887074 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:38.887264 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:38.889511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f3a9dc0>]}
[0m02:01:38.894854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f0b4e30>]}
[0m02:01:38.895056 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:38.895368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff895901a0>]}
[0m02:01:38.896105 [info ] [MainThread]: 
[0m02:01:38.896496 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:38.897044 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_CAR_SALES_DBB'
[0m02:01:38.902176 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB"
[0m02:01:38.902328 [debug] [ThreadPool]: On list_CAR_SALES_DBB: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB"} */
show terse schemas in database CAR_SALES_DBB
    limit 10000
[0m02:01:38.902447 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:39.337213 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m02:01:39.338636 [debug] [ThreadPool]: On list_CAR_SALES_DBB: Close
[0m02:01:39.453209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB, now list_CAR_SALES_DBB_analytics)
[0m02:01:39.465137 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_analytics"
[0m02:01:39.465635 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_analytics"} */
show terse objects in CAR_SALES_DBB.analytics limit 10000
[0m02:01:39.465999 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:39.872345 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m02:01:39.874385 [debug] [ThreadPool]: On list_CAR_SALES_DBB_analytics: Close
[0m02:01:40.019687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_analytics, now list_CAR_SALES_DBB_snapshot)
[0m02:01:40.024549 [debug] [ThreadPool]: Using snowflake connection "list_CAR_SALES_DBB_snapshot"
[0m02:01:40.025079 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_CAR_SALES_DBB_snapshot"} */
show terse objects in CAR_SALES_DBB.snapshot limit 10000
[0m02:01:40.025497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:40.363790 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:01:40.365673 [debug] [ThreadPool]: On list_CAR_SALES_DBB_snapshot: Close
[0m02:01:40.509003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f539850>]}
[0m02:01:40.510693 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:40.512803 [info ] [MainThread]: 
[0m02:01:40.523600 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m02:01:40.524214 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m02:01:40.526697 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_CAR_SALES_DBB_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m02:01:40.528418 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m02:01:40.548059 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 02:01:40.530377 => 02:01:40.547418
[0m02:01:40.550558 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m02:01:40.637915 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.639054 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:40.640486 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:41.309974 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:41.317483 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:41.317886 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:41.428285 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:41.441513 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:41.442022 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:41.576931 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:41.607844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:41.608358 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:43.057635 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:43.063971 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.065053 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:43.176883 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:43.184199 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.185087 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:43.283434 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:43.289568 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.290214 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:43.401591 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:43.405545 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.406028 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:43.538092 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:43.550824 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.551977 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:43.700594 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:43.708650 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.711424 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.711757 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m02:01:43.850307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:43.851411 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:43.851655 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:01:44.528444 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 1.0 seconds
[0m02:01:44.529860 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:44.530767 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m02:01:44.880414 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:44.905509 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 02:01:40.551526 => 02:01:44.905258
[0m02:01:44.906037 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m02:01:45.013773 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e58af90>]}
[0m02:01:45.014904 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 4[0m in 4.49s]
[0m02:01:45.016740 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m02:01:45.017232 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:45.017810 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m02:01:45.018693 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m02:01:45.019079 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:45.022673 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 02:01:45.019311 => 02:01:45.022489
[0m02:01:45.023024 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:45.026328 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.026610 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:45.026998 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:45.731540 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:45.737164 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.738033 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:45.856656 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:45.860607 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.861036 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:45.985178 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:45.995729 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.997066 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from CAR_SALES_DBB.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:47.640941 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m02:01:47.647590 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:47.648559 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:47.789015 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:47.793180 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:47.793607 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:47.879187 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:47.881248 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:47.881442 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:47.964783 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:47.967013 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:47.967259 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:48.073468 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:48.077445 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:48.077819 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:48.162148 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:48.167034 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:48.171291 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:48.171838 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m02:01:48.319820 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:48.320478 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:48.320849 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "CAR_SALES_DBB"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:01:49.059656 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 1.0 seconds
[0m02:01:49.060721 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:49.061212 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m02:01:49.430135 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:49.433528 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 02:01:45.023240 => 02:01:49.433320
[0m02:01:49.434016 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m02:01:49.578756 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b98f3813-70eb-4661-84e8-47f38be04cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e52fce0>]}
[0m02:01:49.579451 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 4[0m in 4.56s]
[0m02:01:49.580198 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:49.581627 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:49.581837 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m02:01:49.582059 [info ] [MainThread]: 
[0m02:01:49.582393 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.69 seconds (10.69s).
[0m02:01:49.582885 [debug] [MainThread]: Command end result
[0m02:01:49.589021 [info ] [MainThread]: 
[0m02:01:49.589477 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:49.589657 [info ] [MainThread]: 
[0m02:01:49.589894 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m02:01:49.590656 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.1520605, "process_user_time": 2.775199, "process_kernel_time": 0.170924, "process_mem_max_rss": "214076", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m02:01:49.590969 [debug] [MainThread]: Command `dbt snapshot` succeeded at 02:01:49.590899 after 11.15 seconds
[0m02:01:49.591209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa449e2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6e51790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6f82030>]}
[0m02:01:49.591418 [debug] [MainThread]: Flushing usage events
